/*!
 * FileBrowser - v1.3.0
 * ${description}
 * ${homepage}
 * Built: Mon Aug 14 2017 09:28:04 GMT-0300 (-03)
 */
var FileBrowser=function(e,t,s,n,o){"use strict";function i(e){if(0===e)return"0 Byte";const t=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],s=Math.floor(Math.log(e)/Math.log(1e3));return(e/Math.pow(1e3,s)).toPrecision(3)+" "+t[s]}function a(e){return e.ok?e.json():e.json().then(function(e){throw e})}function r(e){throw{message:e.message}}e=e&&e.hasOwnProperty("default")?e.default:e,o=o&&o.hasOwnProperty("default")?o.default:o;var l={render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("button",{staticClass:"mdc-button mdc-button--raised mdc-button--primary mdc-button--dense",class:e.classes,attrs:{type:e.type,disabled:e.disabled}},[e._t("default")],2)},staticRenderFns:[],name:"Button",props:{text:String,classes:String,type:{type:String,default:"button"},disabled:{type:Boolean,default:!1}},mounted:function(){new t.MDCRipple(this.$el)}},c={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"fb-upload-button-container"},[s("my-button",{nativeOn:{click:function(t){e.attach(t)}}},[s("i",{staticClass:"material-icons"},[e._v("attach_file")]),e._v(" "),s("span",[e._v(e._s(e.text.BUTTON.CHOOSE))])]),s("input",{ref:"input",attrs:{type:"file",accept:"image/*",multiple:"multiple",name:"testsss",disabled:e.isSaving},on:{change:e.filesChange}})],1)},staticRenderFns:[],name:"UploadButton",components:{MyButton:l},data:function(){return{isSaving:!1,text:this.$store.state.text}},methods:{filesChange:function(e){console.log("filesChange",e.target.files)},attach:function(){this.$refs.input.click(),console.log("attach")}}},d={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("aside",{staticClass:"mdc-dialog",attrs:{role:"alertdialog","aria-labelledby":"mdc-dialog-with-list-label","aria-describedby":"mdc-dialog-with-list-description"}},[s("div",{staticClass:"mdc-dialog__surface"},[s("header",{staticClass:"mdc-dialog__header"},[s("h2",{staticClass:"mdc-dialog__header__title",attrs:{id:"mdc-dialog-with-list-label"}},[e._v(e._s(e.title))])]),s("section",{staticClass:"mdc-dialog__body mdc-dialog__body--scrollable",attrs:{id:"mdc-dialog-with-list-description"}},[e._t("body")],2),s("footer",{staticClass:"fb-dialog-footer mdc-dialog__footer"},[e._t("footer")],2)]),s("div",{staticClass:"mdc-dialog__backdrop"})])},staticRenderFns:[],name:"Modal",props:{title:String,active:{type:Boolean,default:!1}},watch:{active:function(e){e?(this.$emit("open"),this.dialog.show()):(this.$emit("close"),this.dialog.close())}},data:function(){return{dialog:null}},mounted:function(){var e=this;this.dialog=new s.MDCDialog(this.$el),this.dialog.listen("MDCDialog:cancel",function(){return e.$emit("close")})}},u={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("modal",{attrs:{active:e.modalActive,title:e.text.FOLDER.NEW},on:{open:e.onOpenModal,close:e.closeModal}},[s("div",{slot:"body"},[s("h5",[e._v(e._s(e.text.FOLDER.CREATION))]),s("p",{staticClass:"fb-folder-path",domProps:{innerHTML:e._s(e.hierarchy)}}),s("input-text",{attrs:{label:e.text.FOLDER.NEW,required:!0,minlength:1,maxlength:20,hasError:e.creatingHasError,errorMsg:e.creatingError},on:{input:e.onInputNew}})],1),s("div",{slot:"footer"},[s("my-button",{attrs:{classes:"is-dark",type:"submit"},nativeOn:{click:function(t){e.onSubmit(t)}}},[e._v("Submit")]),s("my-button",{nativeOn:{click:function(t){e.closeModal(t)}}},[e._v("Cancel")])],1)])},staticRenderFns:[],name:"Folder",props:["openFolder"],components:{MyButton:l,Modal:d,InputText:{render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"fl-input-container"},[s("div",{ref:"textfield",staticClass:"mdc-textfield"},[s("input",{staticClass:"mdc-textfield__input",class:e.inputClasses,attrs:{type:e.type,id:e.id,disabled:e.disabled,required:e.required,minlength:e.minlength,maxlength:e.maxlength},domProps:{value:e.inputValue},on:{blur:function(t){e.$emit("blur")},input:e.onInput}}),s("label",{staticClass:"mdc-textfield__label",attrs:{for:e.id}},[e._v(e._s(e.label))])]),s("p",{class:e.errMsgClasses,domProps:{innerHTML:e._s(e.errorMsg)}})])},staticRenderFns:[],name:"InputText",props:{type:{type:String,default:"text"},id:{type:String,default:"i-"+function(){const e=function(e){const t=(Math.random().toString(16)+"000000000").substr(2,8);return e?"-"+t.substr(0,4)+"-"+t.substr(4,4):t};return e()+e(!0)+e(!0)+e()}()},value:{type:String,default:""},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},minlength:Number,maxlength:Number,label:String,errorMsg:String,hasError:{type:Boolean,default:!1}},data:function(){return{hasValue:!1,inputValue:this.value}},computed:{inputClasses:function(){return{"fb-input":!0,"fb-valid":this.hasValue&&!this.hasError,"fb-invalid":this.hasError}},errMsgClasses:function(){return{"fb-error-msg":!0,"mdc-textfield-helptext":!0,"mdc-textfield-helptext--validation-msg":!0,"mdc-textfield-helptext--persistent":this.hasError}}},mounted:function(){new n.MDCTextfield(this.$refs.textfield)},methods:{onInput:function(e){this.hasValue=Boolean(e.target.value),this.inputValue=e.target.value,this.$emit("input",e.target.value)}}}},computed:{hierarchy:function(){return this.$store.state.tree.hierarchy.map(function(e){return"<span>"+e+"</span>"}).join("→")}},data:function(){return{text:this.$store.state.text,modalActive:!1,creatingHasError:!1,creatingError:"",creatingName:""}},watch:{openFolder:function(e,t){e&&(this.modalActive=!0)}},methods:{onInputNew:function(e){this.creatingName=e,e?(this.creatingHasError=!/^[a-zA-Z0-9\-_]{1,20}$/.test(e),this.creatingError=this.text.FOLDER.VALIDATION):(this.creatingHasError=!0,this.creatingError=this.text.REQUIRED),console.log("onInputNew",e,this.creatingHasError)},onOpenModal:function(){this.creatingName=""},closeModal:function(){this.modalActive=!1,this.$emit("closeModal")},onSubmit:function(){var e=this;console.log("onSubmit",this.creatingName),this.$store.dispatch("folder/create",this.creatingName).then(function(t){e.closeModal(),e.$store.dispatch("message/show",{message:t,type:"success"})}).catch(function(t){e.closeModal(),e.$store.dispatch("message/show",{message:t,type:"alert"})})}}},f={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("modal",{attrs:{active:e.modalActive,title:e.text.FILE.DEL},on:{open:e.onOpenModal,close:e.closeModal}},[s("div",{slot:"body"},[s("h5",[e._v(e._s(e.text.FILE.DEL))]),s("p",{staticClass:"fb-folder-path",domProps:{innerHTML:e._s(e.hierarchy)}}),s("ul",e._l(e.$store.state.file.selected,function(t){return s("li",[e._v(e._s(e.$store.state.tree.selected.files[t].name))])}))]),s("div",{slot:"footer"},[s("my-button",{attrs:{classes:"is-dark",type:"submit"},nativeOn:{click:function(t){e.onSubmit(t)}}},[e._v(e._s(e.text.BUTTON.CONFIRM))]),s("my-button",{nativeOn:{click:function(t){e.closeModal(t)}}},[e._v(e._s(e.text.BUTTON.CANCEL))])],1)])},staticRenderFns:[],name:"Folder",props:["openFile"],components:{MyButton:l,Modal:d},computed:{hierarchy:function(){return this.$store.state.tree.hierarchy.map(function(e){return"<span>"+e+"</span>"}).join("→")}},data:function(){return{text:this.$store.state.text,modalActive:!1}},watch:{openFile:function(e,t){e&&(this.modalActive=!0)}},methods:{onOpenModal:function(){},closeModal:function(){this.modalActive=!1,this.$emit("closeModal")},onSubmit:function(){var e=this;this.$store.dispatch("file/remove").then(function(t){e.closeModal(),e.$store.dispatch("message/show",{message:t,type:"success"})}).catch(function(t){e.closeModal(),e.$store.dispatch("message/show",{message:t,type:"alert"})})}}};const m={EN:"en",BR:"pt-br"},h={lang:"en"},p={TITLE:"Image Browser",ROOT_FOLDER:"Root Folder",PREVIEW:"Sending Preview",SEND_TO_EDITOR:"Send to Editor",REQUIRED:"Field is required",BUTTON:{CHOOSE:"Choose",SEND:"Send",DELETE_FILE:"Delete File",DELETE_FOLDER:"Delete Folder",NEW_FOLDER:"New Folder",SEND_EDITOR:"Send to Editor",SUBMIT:"Submit",CONFIRM:"Confirm",CANCEL:"Cancel"},FILE:{TOTAL:"Total Files:",DEL:"Delete File",DELS:"Delete Files"},FOLDER:{NEW:"New Folder",DEL:"Delete Folder",CREATION:"This folder will be created inside:",VALIDATION:["Only <strong>letters, numbers</strong>",' and the following characters: <span class="highlight">- _</span>'].join(""),DELETION:['<p class="folder-path">This folder <span>%1</span>'," will be removed with all its contents: </p>",'<p>Total Files: <span class="destaque">%2</span>',' &mdash; Total Subfolders: <span class="destaque">%3</span></p>'].join("")},ALERT:{IMAGE:{NOT_MIN_SIZE:"Only images with minimum %1 x %2!"},UPLOAD:{SENDING:"An upload is already in progress!",NONE:"No file!",SENT:"All done!"}},API:{MESSAGES:{FOLDER:{CREATED:"Folder created!",RENAMED:"Folder renamed!",EXISTS:"This folder already exists!"},FILE:{REMOVED:"File(s) removed!"}}}},g={FILES:{ALL:"/files",CREATE:"/files",REMOVE:"/files"},FOLDER:{CREATE:"/folder",EDIT:"/folder/:id",REMOVE:"/folder/:id"}};var v={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"filebrowser-container"}},[s("div",{staticClass:"filebrowser-wrapper"},[s("app-header"),s("app-body"),s("app-footer")],1)])},staticRenderFns:[],name:"App",components:{AppHeader:{render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("header",{staticClass:"fb-header"},[s("div",{staticClass:"fb-header-title"},[s("span",[e._v(e._s(e.text.TITLE))]),e._v(" "),s("span",{staticClass:"close"})]),s("div",{class:e.messageClasses},[e._v(e._s(e.$store.state.message.message))]),s("div",{staticClass:"fb-toolbar"},[s("div",{staticClass:"fb-toolbar-items"},[s("upload-button"),s("my-button",[s("i",{staticClass:"material-icons"},[e._v("send")]),e._v(" "),s("span",[e._v(e._s(e.text.BUTTON.SEND))])]),s("my-button",{nativeOn:{click:function(t){e.openFolder=!0}}},[s("i",{staticClass:"material-icons"},[e._v("create_new_folder")]),e._v(" "),s("span",[e._v(e._s(e.text.BUTTON.NEW_FOLDER))])]),e.$store.state.tree.selected.id!==e.rootFolder?s("my-button",[s("i",{staticClass:"material-icons"},[e._v("delete_forever")]),e._v(" "),s("span",[e._v(e._s(e.text.BUTTON.DELETE_FOLDER))])]):e._e(),e.$store.state.file.selected.length?s("my-button",{nativeOn:{click:function(t){e.openFile=!0}}},[s("i",{staticClass:"material-icons"},[e._v("delete_forever")]),e._v(" "),s("span",[e._v(e._s(e.text.BUTTON.DELETE_FILE)+" ("+e._s(e.$store.state.file.selected.length)+")")])]):e._e(),e.$store.state.file.selected.length?s("my-button",[s("i",{staticClass:"material-icons"},[e._v("publish")]),e._v(" "),s("span",[e._v(e._s(e.text.BUTTON.SEND_EDITOR))])]):e._e()],1)]),s("folder",{attrs:{"open-folder":e.openFolder},on:{closeModal:function(t){e.openFolder=!1}}}),s("file",{attrs:{"open-file":e.openFile},on:{closeModal:function(t){e.openFile=!1}}})],1)},staticRenderFns:[],name:"Header",components:{MyButton:l,UploadButton:c,Folder:u,File:f},computed:{messageClasses:function(){return{"fb-message":!0,show:this.$store.state.message.show,alert:"alert"===this.$store.state.message.class,success:"success"===this.$store.state.message.class}}},data:function(){return{openFolder:!1,openFile:!1,rootFolder:"root",text:this.$store.state.text}},methods:{removeFile:function(){this.$store.dispatch("file/remove")}}},AppBody:{render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"fb-body"},[s("div",{staticClass:"fb-tree-container"},[s("tree")],1),s("div",{staticClass:"fb-thumb-container"},[s(e.$store.state.upload.pending?"upload":"thumb")],1)])},staticRenderFns:[],name:"Body",components:{MyButton:l,Tree:{render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ol",[e.$store.state.tree.ready?s("folder",{attrs:{id:e.root,collapsed:!1,tree:e.$store.state.tree.tree}}):e._e()],1)},staticRenderFns:[],name:"Tree",components:{Folder:{render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("li",{class:e.classObj,style:e.folderStyle},[s("a",{on:{click:e.select}},[s("i",{staticClass:"material-icons"},[e._v("folder")]),e._v(" "),s("span",[e._v(e._s(e.tree.name))])]),Object.keys(e.tree.folders)?s("ol",e._l(e.tree.folders,function(e,t){return s("folder",{key:t,attrs:{id:t,tree:e}})})):e._e()])},staticRenderFns:[],name:"Folder",props:{tree:Object,id:String,collapsed:{type:Boolean,default:!0}},computed:{classObj:function(){return{collapse:this.open,active:this.id===this.$store.state.tree.selected.id}}},data:function(){return{isRoot:"root"===this.id,open:this.collapsed,folderStyle:{height:28*(Object.keys(this.tree.folders).length+1)+"px"}}},methods:{select:function(){this.isRoot||(this.open=!this.open),this.$store.dispatch("tree/select",{id:this.id,parents:this.tree.parents})}}}},data:function(){return{text:this.$store.state.text,root:"root"}}},Thumb:{render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"fb-thumb"},e._l(e.$store.state.tree.selected.files,function(t,n){return s("figure",{class:{"fb-selected":e.isSelected(n)},on:{click:function(t){e.toggleSelect(n)}}},[s("i",{directives:[{name:"show",rawName:"v-show",value:e.isSelected(n),expression:"isSelected(key)"}],staticClass:"material-icons fb-thumb-checked"},[e._v("check_box")]),e._v(" "),s("img",{attrs:{src:t.path+"/"+t.name}}),s("figcaption",{staticClass:"fb-thumb-info"},[s("h5",[e._v(e._s(t.name))]),s("h5",[e._v(e._s(e.fileSize(t.size)))])])])}))},staticRenderFns:[],name:"Thumb",computed:{},methods:{toggleSelect:function(e){this.$store.commit("file/toggleSelect",e)},isSelected:function(e){return this.$store.state.file.selected.includes(e)},fileSize:function(e){return i(e)}}},Upload:{render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("h2",[e._v("asdf")])},staticRenderFns:[],name:"Upload"}}},AppFooter:{render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("footer",{staticClass:"fb-footer"})},staticRenderFns:[],name:"Footer"}}};const _=Object.assign({},p);_.TITLE="Image Browser",_.ROOT_FOLDER="Root Folder",_.PREVIEW="Sending Preview",_.BUTTON.SEND_EDITOR="Send to Editor",_.BUTTON.CHOOSE="Escolha",_.BUTTON.SEND="Envie";var E=function(e,t){void 0===t&&(t={});const s={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}};return(t=Object.assign(s,t)).body&&(t.body=JSON.stringify(t.body)),console.log("fetch",t),fetch(e,t).then(a,r)},b={namespaced:!0,state:{selected:"/"},actions:{create:function(e,t){var s=e.commit,n=e.state;e.dispatch;const o=n.selected+t,i={method:"POST",body:{path:o}};return console.log("store folder/create",o),new Promise(function(e,t){E(g.FOLDER.CREATE,i).then(function(t){console.log("store folder/create res",t),s("tree/update",t.tree,{root:!0}),e(t.message)}).catch(function(e){return t(e.message)})})}},mutations:{}},y={namespaced:!0,state:{ready:!1,hierarchy:[],selected:{id:"",parents:[],files:[]},tree:{name:"",files:[],folders:[]}},actions:{get:function(e){var t=e.dispatch,s=e.rootState;E(s.options.server+g.FILES.ALL).then(function(e){return t("load",e)}).catch(console.error)},load:function(e,t){var s=e.commit,n=e.dispatch,o=e.state,i=e.rootState;t.name=i.text.ROOT_FOLDER,console.log("load",t),s("update",t),o.selected.id||n("select",{id:"root"})},select:function(e,t){var s=e.commit,n=e.state,o=t.id,i=t.parents;void 0===i&&(i=[]);let a,r=[];"root"===o?(a=n.tree.files,r=[n.tree.name]):0===i.length?(a=n.tree.folders[o].files,r=[n.tree.name,n.tree.folders[o].name]):(r=[n.tree.name],a=i.reduce(function(e,t,s){return r.push(e[t].name),s===i.length-1?(r.push(e[t].folders[o].name),e=e[t].folders[o].files):e=e[t].folders,e},n.tree.folders)),s("select",{id:o,parents:i,files:a,hierarchy:r}),s("file/removeSelected",null,{root:!0})}},mutations:{update:function(e,t){console.log("tree/update mutations",t),e.tree=t,e.ready=!0},select:function(e,t){var s=t.id,n=t.parents,o=t.files,i=t.hierarchy;e.hierarchy=i,e.selected={id:s,parents:n,files:o}},removeSelectedFiles:function(e,t){e.selected.files=e.selected.files.filter(function(e,s){return!t.includes(s)})}}},O={namespaced:!0,state:{selected:[]},actions:{remove:function(e){var t=e.state,s=e.rootState,n=(e.commit,e.dispatch);console.log("remove",s.tree,s.tree.selected);const o=t.selected.map(function(e){return s.tree.selected.files[e].name}),i={method:"PATCH",body:{files:o,folder:s.tree.hierarchy.slice(1,s.tree.hierarchy.length).join("/")}};return console.log("store file/remove",o),new Promise(function(e,t){E(g.FILES.REMOVE,i).then(function(t){console.log("store folder/create res",t),n("reset",null,{root:!0}),n("tree/load",t.tree,{root:!0}),e(t.message)}).catch(function(e){return t(e.message)})})}},mutations:{removeSelected:function(e){e.selected=[]},toggleSelect:function(e,t){e.selected.includes(t)?e.selected.splice(e.selected.indexOf(t),1):e.selected.push(t)}}},F={namespaced:!0,state:{pending:!1},mutations:{selected:function(e){e.pending=!0}}},T={namespaced:!0,state:{show:!1,class:"",message:""},actions:{show:function(e,t){var s=e.commit,n=(e.state,e.rootState,t.message),o=t.type;s("show",{message:n,type:o}),setTimeout(function(){s("hide")},5e3)}},mutations:{show:function(e,t){var s=t.message,n=t.type;e.show=!0,e.message=s,e.class=n},hide:function(e,t){e.show=!1}}},S=new o.Store({modules:{folder:b,tree:y,file:O,message:T,upload:F},state:{text:{},options:h},actions:{reset:function(e){var t=e.state,s=e.commit;s("tree/removeSelectedFiles",t.file.selected),s("file/removeSelected")}},mutations:{mergeOptions:function(e,t){switch(e.options=Object.assign(e.options,t),e.options.lang){case m.BR:e.text=_;break;default:e.text=p}}}});const C=new e({store:S,render:function(e){return e(v)}});return function(e,t){void 0===t&&(t={}),S.commit("mergeOptions",t),S.dispatch("tree/get"),C.$mount(e)}}(Vue,mdc.ripple,mdc.dialog,mdc.textfield,Vuex);
