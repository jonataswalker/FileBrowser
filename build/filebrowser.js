// A multi-purpose filebrowser.
// https://github.com/jonataswalker/FileBrowser
// Version: v1.0.0
// Built: 2015-12-07T14:08:37-0200

(function(e,t){"use strict";var s=function(){var s=function(e){var t=n.deepExtend({},s.defaultOptions);this.options=n.deepExtend(t,e);var r=new s.Html(this),i=r.createBrowser(),o=new s.Drag(this);r.createAlert(),this.$tree=new s.Tree(this),this.$alert=new s.Alert(this),this.$upload=new s.Upload(this),this.current_active=s.elements.folder_tree_root,this.root_event_added=!1,this.thumbs_root=[],this.thumbs_selected=[],this.path=n.getPath(),this.$tree.build(),this.setListeners(),o.when({start:function(){n.addClass(i,"dragging")},move:function(){i.style.left=this.x+"px",i.style.top=this.y+"px"},end:function(){n.removeClass(i,"dragging"),this.y<0&&(i.style.top=0)}})};return s.prototype={show:function(){s.elements.container.style.zIndex=n.getMaxZIndex()+10,s.elements.container.style.display="block",n.setCenter(s.elements.container)},setEditor:function(e){this.options.editor=e},setListeners:function(){var e=this.$tree,t=this.$upload,r=s.elements,n=function(){this.blur(),e.newFolder()},i=function(){this.blur(),e.removeFolder()},o=function(){this.blur(),e.removeFile()},l=function(){this.blur(),e.sendEditor()},a=function(){this.blur(),e.closeBrowser()},d=function(){this.blur(),t.choose()},c=function(){this.blur(),t.start()};r.btn_new_folder.addEventListener("click",n,!1),r.btn_del_folder.addEventListener("click",i,!1),r.btn_upload_choose.addEventListener("click",d,!1),r.btn_upload_file.addEventListener("click",c,!1),r.btn_del_file.addEventListener("click",o,!1),r.btn_editor.addEventListener("click",l,!1),r.btn_close_grd.addEventListener("click",a,!1)}},s.defaultOptions={mode:"plugin",root_http:"http://localhost/testes/wrap2",server_http:"/gerenciador/gerenciador.php",regex_folder:/^[a-zA-Z0-9-_.]{1,10}$/,container_class:"filebrowser-fb fb-container",alert_overlay_class:"filebrowser-fb fb-alert-overlay",alert_container_class:"filebrowser-fb fb-alert"},s.constants={"suffix-small":"small","suffix-medium":"medium","thumb-path":"data-path","thumb-sel":"selected","li-key":"data-key"},s.elements={},function(e){e.Tree=function(t){this.browser=t,this.els=e.elements,this.options=t.options},e.Tree.prototype={get:function(){n.addClass(this.els.grd_preview,"mapeando-spinner");var e={},t=this;return n.json(this.options.server_http,{action:"thumbs"}).when({ready:function(s){n.removeClass(t.els.grd_preview,"mapeando-spinner"),"files"in s.tree&&(t.browser.thumbs_root=s.tree.files,t.loadThumbs(t.browser.thumbs_root)),"dirs"in s.tree&&e.ready.call(void 0,{dirs:s.tree.dirs}),t.updateCountFolder()}}),{when:function(t){e.ready=t.ready}}},build:function(){var e=this;this.get().when({ready:function(t){e.buildTree(t.dirs),e.treeEvents(t.dirs)}})},buildTree:function(e){for(var t,s,r,i,o=this,l=function(e,t,s,r){var i={folder:e,"n-files":t.files,"n-files-all":t["files-all"],"n-folders":t.folders,last:r},l=o.folderTemplate(i),a=n.createElement(["ol",{classname:"collapse"}],l),d=s.appendChild(a);return d},a=function(e,t){for(var s,r,n,i,o=Object.keys(e),d=o.length,c=-1,u={};++c<d;)s=o[c],r=e[s],i=r.last===!0?1:0,u={files:r.files?r.files.length:0,"files-all":r["c-files"],folders:r["c-folders"]},n=l(s,u,t,i),r.dirs&&a(r.dirs,n.firstChild)},d=Object.keys(e),c=d.length,u=-1,f={};++u<c;)t=d[u],s=e[t],i=s.last===!0?1:0,f={files:s.files?s.files.length:0,"files-all":s["c-files"],folders:s["c-folders"]},r=l(t,f,this.els.folder_tree_root,i),s.dirs&&a(s.dirs,r.firstChild)},showHeaderMessage:function(e){var t=this;this.els.grd_msg.textContent=e.msg,n.addClass(this.els.grd_msg,["show",e.type]),window.setTimeout(function(){n.removeClass(t.els.grd_msg,["show",e.type])},e.duration)},renewTree:function(e){return this.removeTree(),this.emptyThumbSelected(),this.removeThumbs(),n.emptyArray(this.browser.thumbs_root),this.browser.current_active=!1,Array.isArray(e)&&0===e.length?(this.updateCountFolder(),void n.fireClick(this.els.folder_tree_root)):("files"in e&&(this.browser.thumbs_root=e.files,this.loadThumbs(this.browser.thumbs_root)),"dirs"in e&&(this.buildTree(e.dirs),this.treeEvents(e.dirs)),this.updateCountFolder(),void this.setFolderActive())},newFolder:function(){var e=this,t=this.browser.$alert,s=this.options.regex_folder,r='<p>Preenchimento mínimo: 1 - máximo: 10;<br>Apenas <strong>letras</strong>, <strong>números</strong> e os seguintes caracteres: <span class="destaque">. - _</span></p>',n=function(){s.test(this)?t.hideInputError():t.showInputError(r)},i=function(){return s.test(this)?void e.submitFolder(this,"nova-pasta").when({ready:function(s){s.erro===!1?(e.renewTree(s.tree),t.close()):t.showInputError(s.msg)}}):void t.showInputError(r)},o=this.getFolderPath(this.browser.current_active),l=o.length,a="<span>Pasta Principal</span>";for(o.reverse();l--;)a+="&nbsp;&rarr;&nbsp;<span>"+o[l]+"</span>";var d='<p>Esta pasta será criada em: </p><p class="folder-path">'+a+"</p>",c={title:"Nova Pasta",text:d};t.prompt({placeholder:"Nova Pasta",html:c,checkInput:n,submit:i})},submitFolder:function(e,t){var s="del-pasta"==t?this.getFolderPath(this.browser.current_active,!0):this.getFolderPath(this.browser.current_active),r={};return n.post(this.options.server_http,{action:t,folder:e,parents:s.join()}).when({ready:function(e){r.ready.call(void 0,e)}}),{when:function(e){r.ready=e.ready}}},removeFolder:function(){var e=this,t=this.browser.$alert,s=this.browser.current_active,r=(this.getFolderParent(s),s.getAttribute("data-key")),n=s.getAttribute("data-files-all"),i=s.getAttribute("data-folders"),o=function(){e.submitFolder(r,"del-pasta").when({ready:function(s){s.erro===!1?(e.renewTree(s.tree),t.close()):t.showInputError(s.msg)}})},l=['<p class="folder-path">Esta pasta <span>'+r+"</span>","será removida e também todo seu conteúdo: </p>",'<p>Total de Arquivos: <span class="destaque">'+n+"</span>",' &mdash; Total de Subpastas: <span class="destaque">',i+"</span></p>"].join(""),a={title:"Remover Pasta",text:l};t.confirm({html:a,submit:o})},removeFile:function(){var e=this,t=this.browser.$alert,s=(this.getFolderParent(this.browser.current_active),function(){n.post(e.options.server_http,{action:"del-file",files:e.browser.thumbs_selected.join()}).when({ready:function(s){e.renewTree(s.tree),t.close()}})}),r='<p>Total de Arquivos: <span class="destaque">'+this.browser.thumbs_selected.length+"</span></p>",i={title:"Remover Arquivo(s)",text:r};t.confirm({html:i,submit:s})},setFolderActive:function(){for(var e,t,s=this,r=n.find("li",this.els.folder_tree_root,!0),i=r.length,o=!1,l=-1,a=function(e){for(var t,r=e.parentNode,i=!0;i;)r?r==s.els.folder_tree_root?i=!1:"OL"==r.tagName&&(t=n.getSiblings(r,"ol"),n.removeClass(t,"collapse"),n.removeClass(r,"collapse")):i=!1,r=r.parentNode;n.fireClick(e)};++l<i;)if(e=r[l],t=e.getAttribute("data-last"),1==t){o=!0,a(e);break}o&&0!==i||n.fireClick(this.els.folder_tree_root)},getFolderPath:function(e,t){var s=[];for(t&&(e=e.parentNode);e&&e!==this.els.folder_tree_root;)"LI"==e.tagName&&s.unshift(e.getAttribute("data-key")),e=e.parentNode;return s},getFolderParent:function(e){e=e.parentNode;for(var t,s=!0;e&&s;)"LI"==e.tagName&&(t=e,s=!1),e=e.parentNode;return t},treeEvents:function(e){var t=this,s=this.browser.$upload,r=n.find("li",this.els.folder_tree,!0),i=r.length;if(0!==i)for(var o=function(e){var s=!0;for(e=e.parentNode;e&&s;)"LI"==e.tagName&&(n.addClass(e,"open"),e==t.els.folder_tree_root&&(s=!1)),e=e.parentNode},l=function(e){var s=n.hasClass(e,"open"),r=n.hasClass(e,"active"),i=n.getChildren(e,"ol"),o=n.getAllChildren(e,"ol"),l=n.getAllChildren(e,"li");s&&r?(n.addClass(o,"collapse"),n.removeClass(l,"open"),n.removeClass(e,"open")):s?(n.addClass(o,"collapse"),n.removeClass(l,"open"),n.removeClass(e,"open")):(n.removeClass(i,"collapse"),n.addClass(e,"open")),t.browser.current_active=e,n.addClass(e,"active")},a=(function(e,s,r){var n,i,o=(Object.keys(s).length,e.length);r=r||1;for(n in s)if(n==e[r-1])if(r==o){if(i=s[n],i&&"files"in i){t.loadThumbs(i.files);break}}else++r,a(e,s[n].dirs,r);return!1}),d=function(e,s){if(e==t.els.folder_tree_root)return void t.loadThumbs(t.browser.thumbs_root);for(var r=[];e&&e!==t.els.folder_tree_root;)"LI"==e.tagName&&r.unshift(e.getAttribute("data-key")),e=e.parentNode;a(r,s)},c=function(r){r.stopPropagation(),s.showTree(),this!=t.browser.current_active&&(t.removeThumbs(),d(this,e)),t.browser.current_active=t.browser.current_active||t.els.folder_tree_root,n.removeClass(t.browser.current_active,"active"),o(this),l(this),this==t.els.folder_tree_root?t.els.btn_del_folder.style.display="none":t.els.btn_del_folder.style.display=""},u=-1;++u<i;)!function(e){var s=r[e];if(0===e){var i=n.getChildren(s,"ol");i.length>0&&n.removeClass(i,"collapse")}s==t.els.folder_tree_root?t.browser.root_event_added||(s.addEventListener("click",c,!1),t.browser.root_event_added=!0):s.addEventListener("click",c,!1)}(u)},emptyThumbSelected:function(){var t=n.find("li",this.els.grd_preview,!0);n.emptyArray(this.browser.thumbs_selected),n.removeClass(t,e.constants["thumb-sel"]),this.buttonThumbRemoveHandler()},buttonThumbRemoveHandler:function(){var e=this.browser.thumbs_selected.length,t=e>1?"Remover Arquivos":"Remover Arquivo";e>0?(n.removeClass(this.els.btn_editor,"hidden"),n.removeClass(this.els.btn_del_file,"hidden"),this.els.desc_btn_del_file.textContent=t+" ("+e+")",this.els.desc_btn_editor.textContent="Enviar para o Editor ("+e+")"):(n.addClass(this.els.btn_editor,"hidden"),n.addClass(this.els.btn_del_file,"hidden"))},updateCountFolder:function(){this.els.folder_root_desc.textContent="Pasta Principal ("+this.browser.thumbs_root.length+")"},removeThumbs:function(){n.removeAllChildren(this.els.grd_preview)},loadThumbs:function(t,s){for(var r,i,o,l,a,d,c=this,u=this.options.root_http,f=t.length,h=-1,p=function(){n.toggleClass(this,e.constants["thumb-sel"]);var t=n.hasClass(this,e.constants["thumb-sel"]),s=this.getAttribute(e.constants["thumb-path"]);t?c.browser.thumbs_selected.push(s):n.removeArrayEntry(c.browser.thumbs_selected,s),c.buttonThumbRemoveHandler()};++h<f;)l=t[h],a=l.relative_path+l.filename,d=this.browser.thumbs_selected.indexOf(a)>-1?!0:!1,r={filename:l.filename,date:l.date,filesize:l.filesize,url:u+a},i=this.thumbTemplate(r),o=n.createElement(["li",{classname:d?e.constants["thumb-sel"]:"",attr:[{name:e.constants["thumb-path"],value:a}]}],i),this.els.grd_preview.appendChild(o),o.addEventListener("click",p,!1)},sendEditor:function(){for(var t,s=this.options.editor,r=this.browser.thumbs_selected.length,n=-1;++n<r;)t=this.browser.thumbs_selected[n].replace(e.constants["suffix-small"],e.constants["suffix-medium"]),s.insertHtml('<img src="'+this.options.root_http+t+'">');this.emptyThumbSelected(),this.closeBrowser()},closeBrowser:function(){this.els.container.style.display="none"},removeTree:function(){var e=this.els.folder_tree_root.getElementsByTagName("ol");n.removeAll(e)},thumbTemplate:function(e){var t=['<a class="brankic-checked" style="background-image:url({url})">','<span class="fb-fileinfo">','<span class="fb-fileinfo-center">',"<span>{filename}</span>","<span>{date}<br>{filesize}</span>","</span>","</span>","</a>"].join("");return n.template(t,e)},folderTemplate:function(e){var t=['<li data-key="{folder}" data-last="{last}" ','data-files-all="{n-files-all}" data-folders="{n-folders}"><a>','<i class="icomoon-folder"></i>',"<span>{folder} ({n-files})</span>","</a></li>"].join("");return n.template(t,e)}}}(s),function(e,t,s){e.Html=function(e){this.browser=e},e.Html.prototype={createBrowser:function(){var t=this.browser.options,r=n.createElement(["div",{classname:t.container_class}],e.Html.browser),i={container:r,drag_handle:r.querySelector(".fb-header"),grd_preview:r.querySelector("#fb-thumb"),folder_tree:r.querySelector("#fb-tree"),folder_tree_root:r.querySelector("#fb-tree-folder-root"),folder_root_desc:r.querySelector("#folder-root-desc"),upload_input:r.querySelector("#upload-input"),btn_upload_choose:r.querySelector("#btn-upload-choose"),btn_new_folder:r.querySelector("#btn-new-folder"),btn_del_folder:r.querySelector("#btn-del-folder"),btn_del_file:r.querySelector("#btn-del-file"),btn_upload_file:r.querySelector("#btn-upload-send"),btn_editor:r.querySelector("#btn-editor"),images_list:r.querySelector("#upload-thumb"),grd_msg:r.querySelector(".fb-message"),grd_drag:r.querySelector(".fb-header"),grd_resize:r.querySelector(".fb-footer"),desc_btn_del_file:r.querySelector("#btn-del-file span"),desc_btn_editor:r.querySelector("#btn-editor span"),btn_close_grd:r.querySelector(".fb-header button")};for(var o in i)e.elements[o]=i[o];return r.style.zIndex=this.browser.maxZIndex+10,r.style.display="none",s.body.appendChild(r),r},createAlert:function(){var t=this.browser.options,r=s.createElement("div"),i=n.createElement(["div",{classname:t.alert_container_class}],e.Html.alert),o={alert_overlay:r,alert_container:i,alert_title:i.querySelector(".fb-title"),alert_text:i.querySelector(".fb-text"),alert_input:i.querySelector('input[type="text"]'),alert_icon_error:i.querySelector(".fb-icon.fb-error"),alert_icon_warning:i.querySelector(".fb-icon.fb-warning"),alert_icon_info:i.querySelector(".fb-icon.fb-info"),alert_icon_success:i.querySelector(".fb-icon.fb-success"),alert_elem_error:i.querySelector(".fb-error-container"),alert_error_text:i.querySelector(".fb-error-text"),alert_ok:i.querySelector("button.ok"),alert_cancel:i.querySelector("button.cancel")};for(var l in o)e.elements[l]=o[l];return r.className=t.alert_overlay_class,r.style.zIndex=this.browser.maxZIndex+11,i.style.zIndex=this.browser.maxZIndex+12,i.style.display="none",s.body.appendChild(r),s.body.appendChild(i),i}},e.Html.browser=['<div class="fb-header unselectable">',"<span>Gerenciador de Imagens</span>","<button>&times;</button>","</div>",'<h5 class="fb-message"></h5>','<div class="fb-toolbar">','<div class="fb-toolbar-items">','<button id="btn-upload-choose" class="button-filebrowser">','<i class="brankic-attachment"></i>',"<span>Escolha</span>","</button>",'<button class="button-filebrowser hidden" id="btn-upload-send">','<i class="brankic-upload"></i>',"<span>Envie</span>","</button>",'<button class="button-filebrowser hidden" id="btn-del-file">','<i class="brankic-trashcan"></i>',"<span>Remover Arquivo</span>","</button>",'<button class="button-filebrowser" id="btn-new-folder">','<i class="icomoon-folder-plus"></i>',"<span>Nova Pasta</span>","</button>",'<button class="button-filebrowser" id="btn-del-folder" ','style="display:none">','<i class="icomoon-folder-minus"></i>',"<span>Remover Pasta</span>","</button>",'<button class="button-filebrowser hidden" id="btn-editor">','<i class="brankic-edit"></i>',"<span>Enviar para o Editor</span>","</button>","</div>","</div>",'<div class="fb-body clearfix">','<div class="fb-tree-container">','<ol id="fb-tree">','<li id="fb-tree-folder-root" class="active open">',"<a>",'<i class="icomoon-folder"></i>','<span id="folder-root-desc">Pasta Principal</span>',"</a>","</li>","</ol>","</div>",'<div id="" class="fb-thumb-container">','<ul id="fb-thumb" class="fb-thumb"></ul>','<div class="js-fileapi-wrapper">','<input id="upload-input" class="input-file" name="files" ','type="file" multiple />',"</div>",'<ul id="upload-thumb" class="fb-upload-thumb" ','data-label="Prévia do Envio"></ul>',"</div>","</div>",'<div class="fb-footer">',"<span></span><span></span>","</div>"].join(""),e.Html.alert=['<div class="fb-icon fb-error" style="display:none;">','<span class="fb-x-mark">','<span class="fb-line fb-left"></span>','<span class="fb-line fb-right"></span>',"</span>","</div>",'<div class="fb-icon fb-warning" style="display:none;">','<span class="fb-body"></span>','<span class="fb-dot"></span>',"</div>",'<div class="fb-icon fb-info" style="display:none;"></div>','<h2 class="fb-title"></h2>','<div class="fb-text"></div>','<fieldset><input type="text" style="display:none;"></fieldset>','<div class="fb-error-container">','<div class="icon">!</div>','<div class="fb-error-text"></div>',"</div>",'<div class="fb-button-container">','<button class="button-filebrowser cancel">Cancelar</button>','<button class="button-filebrowser ok">OK</button>',"</div>"].join("")}(s,e,t),function(e,t,s){e.Drag=function(t,r){this.browser=t;var n,i,o,l,a,d,c=e.elements.container,u=e.elements.drag_handle||c,f={},h=function(e){0===e.button&&(n=e.clientX,i=e.clientY,f.start.call({target:c}),s.addEventListener("mousemove",p,!1),s.addEventListener("mouseup",b,!1))},p=function(e){e.preventDefault&&e.preventDefault(),o=parseInt(c.style.left,10)||0,l=parseInt(c.style.top,10)||0,a=o+(e.clientX-n),d=l+(e.clientY-i),f.move.call({target:c,x:a,y:d}),n=e.clientX,i=e.clientY},b=function(e){s.removeEventListener("mousemove",p,!1),s.removeEventListener("mouseup",b,!1),f.end.call({target:c,x:a,y:d})};return u.addEventListener("mousedown",h,!1),{when:function(e){f.start=e.start,f.move=e.move,f.end=e.end}}}}(s,e,t),function(e,t,s){e.Upload=function(t,s){this.browser=t,this.els=e.elements,this.options=t.options,this.files=[],this.index=0,this.active=!1,this.path_parents="",this.setListeners()},e.Upload.prototype={setListeners:function(){var e=this,t=this.browser.$tree;FileAPI.event.on(this.els.upload_input,"change",function(s){var r=FileAPI.getFiles(s);FileAPI.filterFiles(r,function(e,t){return/^image/.test(e.type)?t.width>=120&&t.height>=120:!1},function(s,r){r&&r.length>0&&t.showHeaderMessage({msg:"Apenas imagens com no mínimo 120x120!",duration:3500,type:"alert"}),s.length&&e.add(s)})})},choose:function(){n.fireClick(this.els.upload_input)},showPreview:function(){this.els.grd_preview.style.display="none",this.els.images_list.style.display="",n.removeClass(this.els.btn_upload_file,"hidden")},showTree:function(){this.els.grd_preview.style.display="",this.els.images_list.style.display="none",n.addClass(this.els.btn_upload_file,"hidden")},add:function(e){var t,s,r,i,o=this,l=this.browser.$tree;this.showPreview(),l.emptyThumbSelected(),FileAPI.each(e,function(e){o.files.push(e),FileAPI.Image(e).preview(70).get(function(l,a){t={name:e.name,size:n.bytesToSize(e.size)},s=o.thumbTemplate(t),r=n.createElement("li",s),r.id="file-"+FileAPI.uid(e),o.els.images_list.appendChild(r),i=n.find(".fb-preview-left",r),i.appendChild(a)})}),window.setTimeout(function(){n.fireClick(o.els.btn_upload_file)},300)},thumbTemplate:function(e){var t=['<div class="fb-preview-left"></div>','<div class="fb-preview-right">','<div class="fb-preview-filename">',"<span>{name}</span><br/>","<span>tamanho: {size}</span>","</div>",'<div class="fb-preview-progress">','<div class="fb-progress-bar"></div>',"</div>","</div>"].join("");return n.template(t,e)},getFileById:function(e){for(var t=this.files.length;t--;)if(FileAPI.uid(this.files[t])==e)return this.files[t]},start:function(){var e=this.browser.$tree,t=this.files.length;return this.path_parents=e.getFolderPath(this.browser.current_active),this.active?void e.showHeaderMessage({msg:"Um envio já está em andamento!",duration:1500,type:"alert"}):0===t?void e.showHeaderMessage({msg:"Nenhum arquivo foi selecionado!",duration:1500,type:"alert"}):t==this.index?void e.showHeaderMessage({msg:"Todos os arquivos já foram enviados!",duration:1500,type:"alert"}):void this.start_()},start_:function(){!this.active&&(this.active=this.files.length>this.index)&&this.upload_(this.files[this.index])},abort:function(e){var t=this.getFileById(e);t.xhr&&t.xhr.abort()},getEl_:function(e,t){var s=n.$("file-"+FileAPI.uid(e));return t?n.find(t,s):s},upload_:function(e){var t=this,s=this.browser.$tree,n=(this.getEl_(e),this.getEl_(e,".fb-progress-bar"));e&&(e.xhr=FileAPI.upload({url:this.options.server_http,files:{file:e},data:{action:"upload",parents:this.path_parents.join()},imageOriginal:!1,imageTransform:{big:{maxWidth:800,maxHeight:600},medium:{maxWidth:320,maxHeight:240},small:{maxWidth:100,maxHeight:100}},filecomplete:function(e,t){e&&r(e)},progress:function(e){n.style.width=e.loaded/e.total*100+"%"},complete:function(e,r){if(t.index++,t.active=!1,t.start_(),t.files.length==t.index){var n=FileAPI.parseJSON(r.responseText);n.erro===!1&&(s.showHeaderMessage({msg:"Todos os arquivos foram enviados!",duration:2500,type:"success"}),window.setTimeout(function(){t.showTree(),s.renewTree(n.tree)},1500))}}}))}}}(s,e,t),function(e,t,s){e.Alert=function(t){this.browser=t,this.els=e.elements,this.setListeners(),this.opened=!1,this.options={}},e.Alert.prototype={show:function(){var e=this.els.alert_container,r=parseInt(this.els.container.style.zIndex);this.els.alert_title.textContent=this.options.html.title,this.els.alert_text.innerHTML=this.options.html.text,n.addClass(s.body,"filebrowser-fb-stop-scrolling"),n.fadeIn(this.els.alert_overlay),this.els.alert_overlay.style.zIndex=r+1,e.style.marginTop=n.getTopMargin(e),e.style.opacity="",e.style.zIndex=r+2,e.style.display="block",n.addClass(e,"fb-alert-show"),n.removeClass(e,"fb-alert-hide"),t.previousActiveElement=s.activeElement,this.opened=!0,this.hideInputError()},close:function(){this.opened=!1,n.fadeOut(this.els.alert_overlay),n.fadeOut(this.els.alert_container),n.addClass(this.els.alert_container,"fb-alert-hide"),n.removeClass(this.els.alert_container,"fb-alert-show"),n.removeClass(s.body,"filebrowser-fb-stop-scrolling"),t.previousActiveElement},checkInput:function(e,t){13===e?this.options.submit.call(t):this.options.checkInput.call(t)},submit:function(){this.options.submit.call(this.els.alert_input.value)},prompt:function(e){this.options=e,this.show(),this.els.alert_icon_warning.style.display="none",this.els.alert_input.style.display="",this.els.alert_input.setAttribute("placeholder",e.placeholder),this.els.alert_input.focus()},confirm:function(e){this.options=e,this.show(),this.els.alert_icon_warning.style.display="",this.els.alert_input.style.display="none",this.els.alert_input.focus()},showInputError:function(e){n.addClass(this.els.alert_input,"invalid"),n.addClass(this.els.alert_elem_error,"show"),this.els.alert_error_text.innerHTML=e},hideInputError:function(){n.removeClass(this.els.alert_input,"invalid"),n.removeClass(this.els.alert_elem_error,"show")},setListeners:function(){var e=this,t=function(){this.blur(),e.submit()},r=function(t){this.blur(),e.close()},n=function(t){e.checkInput(t.keyCode,this.value)},i=function(t){27===t.keyCode&&e.opened&&e.close()};this.els.alert_ok.addEventListener("click",t,!1),this.els.alert_cancel.addEventListener("click",r,!1),this.els.alert_input.addEventListener("keyup",n,!1),s.addEventListener("keydown",i,!1)}}}(s,e,t),function(e,t,s){var i=function(){var e=!1;if(t.XMLHttpRequest)e=new XMLHttpRequest;else if(t.ActiveXObject)try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){e=!1}}return e},o=function(e,t){if(t&&"object"==typeof t){var s=n.toQueryString(t);e+=(/\?/.test(e)?"&":"?")+s}return e};e.Utils={whiteSpaceRegex:/\s+/,toQueryString:function(e){return Object.keys(e).reduce(function(t,s){return t.push("object"==typeof e[s]?n.toQueryString(e[s]):encodeURIComponent(s)+"="+encodeURIComponent(e[s])),t},[]).join("&")},json:function(e,t){var s=i(),n={},l=function(){200===s.status?n.ready.call(void 0,JSON.parse(s.response)):r("Status code was "+s.status)},a=function(){r("Can't XHR "+JSON.stringify(e))},d=function(e){};return e=o(e,t),s.open("GET",e,!0),s.setRequestHeader("Accept","application/json"),s.onload=l,s.onerror=a,s.onprogress=d,s.send(null),{when:function(e){n.ready=e.ready}}},post:function(e,t){var s=i(),o={},l=function(){200===s.status?o.ready.call(void 0,JSON.parse(s.response)):r("Status code was "+s.status)},a=function(){r("Can't XHR "+JSON.stringify(e))},d=function(){};return t=n.toQueryString(t),s.open("POST",e,!0),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.onload=l,s.onerror=a,s.onprogress=d,s.send(t),{when:function(e){o.ready=e.ready}}},getPath:function(){var e=t.location.pathname.split("/");return e.shift(),e.pop(),"/"+e.join("/")+"/"},stopEventPropagation:function(e){"function"==typeof e.stopPropagation?(e.stopPropagation(),e.preventDefault()):t.event&&t.event.hasOwnProperty("cancelBubble")&&(t.event.cancelBubble=!0)},fireClick:function(e){if("function"==typeof MouseEvent){var r=new MouseEvent("click",{view:t,bubbles:!1,cancelable:!0});e.dispatchEvent(r)}else if(s.createEvent){var n=s.createEvent("MouseEvents");n.initEvent("click",!1,!1),e.dispatchEvent(n)}else s.createEventObject?e.fireEvent("onclick"):"function"==typeof e.onclick&&e.onclick()},classRegex:function(e){return new RegExp("(^|\\s+)"+e+"(\\s+|$)")},_addClass:function(e,s,r){e.classList?e.classList.add(s):e.className=(e.className+" "+s).trim(),r&&n.isNumeric(r)&&t.setTimeout(function(){n._removeClass(e,s)},r)},addClass:function(e,t,s){if(Array.isArray(e))return void e.forEach(function(e){n.addClass(e,t)});for(var r=Array.isArray(t)?t:t.split(n.whiteSpaceRegex),i=r.length;i--;)n.hasClass(e,r[i])||n._addClass(e,r[i],s)},_removeClass:function(e,t){e.classList?e.classList.remove(t):e.className=e.className.replace(n.classReg(t)," ").trim()},removeClass:function(e,t){if(Array.isArray(e))return void e.forEach(function(e){n.removeClass(e,t)});for(var s=Array.isArray(t)?t:t.split(n.whiteSpaceRegex),r=s.length;r--;)n.hasClass(e,s[r])&&n._removeClass(e,s[r])},hasClass:function(e,t){return e.classList?e.classList.contains(t):n.classReg(t).test(e.className)},toggleClass:function(e,t){return Array.isArray(e)?void e.forEach(function(e){n.toggleClass(e,t)}):void(e.classList?e.classList.toggle(t):n.hasClass(e,t)?n._removeClass(e,t):n._addClass(e,t))},$:function(e){return e="#"===e[0]?e.substr(1,e.length):e,s.getElementById(e)},isElement:function(e){return"HTMLElement"in t?!!e&&e instanceof HTMLElement:!!e&&"object"==typeof e&&1===e.nodeType&&!!e.nodeName},find:function(e,t,s){var r=/^(#?[\w-]+|\.[\w-.]+)$/,i=/\./g,o=[].slice,l=[];if(r.test(e))switch(e[0]){case"#":l=[n.$(e.substr(1))];break;case".":l=o.call(t.getElementsByClassName(e.substr(1).replace(i," ")));break;default:l=o.call(t.getElementsByTagName(e))}else l=o.call(t.querySelectorAll(e));return s?l:l[0]},getAllChildren:function(e,t){return[].slice.call(e.getElementsByTagName(t))},getSiblings:function(e,t){return Array.prototype.filter.call(e.parentNode.children,function(s){return t?t.toUpperCase()==s.tagName?s!==e:void 0:s!==e})},emptyArray:function(e){for(;e.length;)e.pop()},removeAllChildren:function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},removeAll:function(e){for(var t;t=e[0];)t.parentNode.removeChild(t)},getChildren:function(e,t){return[].filter.call(e.childNodes,function(e){return t?1==e.nodeType&&e.tagName.toLowerCase()==t:1==e.nodeType})},template:function(e,t){var s=this;return e.replace(/\{ *([\w_-]+) *\}/g,function(e,r){var n=void 0===t[r]?"":t[r];return s.htmlEscape(n)})},htmlEscape:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},getMaxZIndex:function(){for(var e,r=0,i=n.find("*",s,!0),o=i.length,l=-1;++l<o;)e=parseInt(t.getComputedStyle(i[l]).zIndex,10),r=e?Math.max(r,e):r;return r},deepExtend:function(e,t){var s,r;for(s in t)t.hasOwnProperty(s)&&(r=t[s],void 0!==r&&null!==r&&void 0!==r.constructor&&r.constructor===Object?(e[s]=e[s]||{},n.deepExtend(e[s],r)):e[s]=r);return e},createElement:function(e,t){var r;if(Array.isArray(e)){if(r=s.createElement(e[0]),e[1].id&&(r.id=e[1].id),e[1].classname&&(r.className=e[1].classname),e[1].attr){var n=e[1].attr;if(Array.isArray(n))for(var i=-1;++i<n.length;)r.setAttribute(n[i].name,n[i].value);else r.setAttribute(n.name,n.value)}}else r=s.createElement(e);r.innerHTML=t;for(var o=s.createDocumentFragment();r.childNodes[0];)o.appendChild(r.childNodes[0]);return r.appendChild(o),r},setCenter:function(e,s){s=s||t;var r=n.getSize(s),i=n.getSize(e),o=s==t?t.pageXOffset:s.scrollLeft,l=s==t?t.pageYOffset:s.scrollTop,a=Math.max(0,(r.height-i.height)/2+l),d=Math.max(0,(r.width-i.width)/2+o);e.style.position="absolute",e.style.top=a+"px",e.style.left=d+"px"},getSize:function(e){return e==t||e==s?n.getWindowSize():{width:e.offsetWidth,height:e.offsetHeight}},getWindowSize:function(){return{width:t.innerWidth||s.documentElement.clientWidth||s.body.clientWidth,height:t.innerHeight||s.documentElement.clientHeight||s.body.clientHeight}},fadeIn:function(e,t){if(+e.style.opacity<1){t=t||16,e.style.opacity=0,e.style.display="block";var s=+new Date,r=function(){e.style.opacity=+e.style.opacity+(new Date-s)/100,s=+new Date,+e.style.opacity<1&&setTimeout(r,t)};r()}e.style.display="block"},fadeOut:function(e,t){t=t||16,e.style.opacity=1;var s=+new Date,r=function(){e.style.opacity=+e.style.opacity-(new Date-s)/100,s=+new Date,+e.style.opacity>0?setTimeout(r,t):e.style.display="none"};r()},getTopMargin:function(e){e.style.left="-9999px",e.style.display="block";var t,s=e.clientHeight;return t="undefined"!=typeof getComputedStyle?parseInt(getComputedStyle(e).paddingTop,10):parseInt(e.currentStyle.padding),e.style.left="",e.style.display="none","-"+parseInt((s+t)/2)+"px"},toType:function(e){return e==t&&e.doc&&e.location?"window":e==s?"htmldocument":"string"==typeof e?"string":n.isElement(e)?"element":void 0},typeOf:function(e){return{}.toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},removeArrayEntry:function(e,t){var s=e.indexOf(t);s>-1&&e.splice(s,1)},bytesToSize:function(e){if(0===e)return"0 Byte";var t=1e3,s=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],r=Math.floor(Math.log(e)/Math.log(t));return(e/Math.pow(t,r)).toPrecision(3)+" "+s[r]}}}(s,e,t),s}(),r=function(e){console.info(e)},n=s.Utils;"function"==typeof define&&define.amd?define(function(){return s}):"undefined"!=typeof module&&module.exports?module.exports=s:"undefined"!=typeof this&&(this.FileBrowser=s)}).call(this,window,document);
