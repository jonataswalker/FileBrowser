// A multi-purpose filebrowser.
// https://github.com/jonataswalker/FileBrowser
// Version: v1.3.0
// Built: 2016-04-07T17:07:12-0300

"use strict";!function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define([],t):e.FileBrowser=t()}(this,function(){var e={},t={whiteSpaceRegex:/\s+/,toQueryString:function(e){return Object.keys(e).reduce(function(n,i){return n.push("object"==typeof e[i]?t.toQueryString(e[i]):encodeURIComponent(i)+"="+encodeURIComponent(e[i])),n},[]).join("&")},encodeUrlXhr:function(e,n){if(n&&"object"==typeof n){var i=t.toQueryString(n);e+=(/\?/.test(e)?"&":"?")+i}return e},json:function(e,n){var i=new XMLHttpRequest,r={},o=function(){200===i.status?r.ready.call(void 0,JSON.parse(i.response)):console.info("Status code was "+i.status)},a=function(){console.info("Can't XHR "+JSON.stringify(e))},s=function(){};return e=t.encodeUrlXhr(e,n),i.open("GET",e,!0),i.setRequestHeader("Accept","application/json"),i.onload=o,i.onerror=a,i.onprogress=s,i.send(null),{when:function(e){r.ready=e.ready}}},post:function(e,n){var i=new XMLHttpRequest,r={},o=function(){200===i.status?r.ready.call(void 0,JSON.parse(i.response)):console.info("Status code was "+i.status)},a=function(){console.info("Can't XHR "+JSON.stringify(e))},s=function(){};return n=t.toQueryString(n),i.open("POST",e,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.onload=o,i.onerror=a,i.onprogress=s,i.send(n),{when:function(e){r.ready=e.ready}}},getPath:function(){var e=window.location.pathname.split("/");return e.shift(),e.pop(),"/"+e.join("/")+"/"},stopEventPropagation:function(e){"function"==typeof e.stopPropagation?(e.stopPropagation(),e.preventDefault()):window.event&&window.event.hasOwnProperty("cancelBubble")&&(window.event.cancelBubble=!0)},fireClick:function(e){if("function"==typeof MouseEvent){var t=new MouseEvent("click",{view:window,bubbles:!1,cancelable:!0});e.dispatchEvent(t)}else if(document.createEvent){var n=document.createEvent("MouseEvents");n.initEvent("click",!1,!1),e.dispatchEvent(n)}else document.createEventObject?e.fireEvent("onclick"):"function"==typeof e.onclick&&e.onclick()},classRegex:function(e){return new RegExp("(^|\\s+)"+e+"(\\s+|$)")},_addClass:function(e,n,i){e.classList?e.classList.add(n):e.className=(e.className+" "+n).trim(),i&&t.isNumeric(i)&&window.setTimeout(function(){t._removeClass(e,n)},i)},addClass:function(e,n,i){if(Array.isArray(e))return void e.forEach(function(e){t.addClass(e,n)});for(var r=Array.isArray(n)?n:n.split(t.whiteSpaceRegex),o=r.length;o--;)t.hasClass(e,r[o])||t._addClass(e,r[o],i)},_removeClass:function(e,n){e.classList?e.classList.remove(n):e.className=e.className.replace(t.classReg(n)," ").trim()},removeClass:function(e,n){if(Array.isArray(e))return void e.forEach(function(e){t.removeClass(e,n)});for(var i=Array.isArray(n)?n:n.split(t.whiteSpaceRegex),r=i.length;r--;)t.hasClass(e,i[r])&&t._removeClass(e,i[r])},hasClass:function(e,n){return e.classList?e.classList.contains(n):t.classReg(n).test(e.className)},toggleClass:function(e,n){return Array.isArray(e)?void e.forEach(function(e){t.toggleClass(e,n)}):void(e.classList?e.classList.toggle(n):t.hasClass(e,n)?t._removeClass(e,n):t._addClass(e,n))},$:function(e){return e="#"===e[0]?e.substr(1,e.length):e,document.getElementById(e)},isElement:function(e){return"HTMLElement"in window?!!e&&e instanceof HTMLElement:!!e&&"object"==typeof e&&1===e.nodeType&&!!e.nodeName},find:function(e,n,i){var r=/^(#?[\w-]+|\.[\w-.]+)$/,o=/\./g,a=[].slice,s=[];if(r.test(e))switch(e[0]){case"#":s=[t.$(e.substr(1))];break;case".":s=a.call(n.getElementsByClassName(e.substr(1).replace(o," ")));break;default:s=a.call(n.getElementsByTagName(e))}else s=a.call(n.querySelectorAll(e));return i?s:s[0]},getAllChildren:function(e,t){return[].slice.call(e.getElementsByTagName(t))},getSiblings:function(e,t){return Array.prototype.filter.call(e.parentNode.children,function(n){return t?t.toUpperCase()==n.tagName?n!==e:void 0:n!==e})},emptyArray:function(e){for(;e.length;)e.pop()},removeAllChildren:function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},removeAll:function(e){for(var t;t=e[0];)t.parentNode.removeChild(t)},getChildren:function(e,t){return[].filter.call(e.childNodes,function(e){return t?1==e.nodeType&&e.tagName.toLowerCase()==t:1==e.nodeType})},templateLang:function(e,t){return e.replace(/(%\d)/g,function(e,n){var i=n.match(/\d+$/)[0];return t[i-1]})},template:function(e,t){var n=this;return e.replace(/\{ *([\w_-]+) *\}/g,function(e,i){var r=void 0===t[i]?"":t[i];return n.htmlEscape(r)})},htmlEscape:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},getMaxZIndex:function(){for(var e,n=0,i=t.find("*",document,!0),r=i.length,o=-1;++o<r;)e=parseInt(window.getComputedStyle(i[o]).zIndex,10),n=e?Math.max(n,e):n;return n},deepExtend:function(e,n){var i,r;for(i in n)n.hasOwnProperty(i)&&(r=n[i],void 0!==r&&null!==r&&void 0!==r.constructor&&r.constructor===Object?(e[i]=e[i]||{},t.deepExtend(e[i],r)):e[i]=r);return e},createElement:function(e,t){var n;if(Array.isArray(e)){if(n=document.createElement(e[0]),e[1].id&&(n.id=e[1].id),e[1].classname&&(n.className=e[1].classname),e[1].attr){var i=e[1].attr;if(Array.isArray(i))for(var r=-1;++r<i.length;)n.setAttribute(i[r].name,i[r].value);else n.setAttribute(i.name,i.value)}}else n=document.createElement(e);n.innerHTML=t;for(var o=document.createDocumentFragment();n.childNodes[0];)o.appendChild(n.childNodes[0]);return n.appendChild(o),n},setCenter:function(e,n){n=n||window;var i=t.getSize(n),r=t.getSize(e),o=n==window?window.pageXOffset:n.scrollLeft,a=n==window?window.pageYOffset:n.scrollTop,s=Math.max(0,(i.height-r.height)/2+a),l=Math.max(0,(i.width-r.width)/2+o);e.style.position="absolute",e.style.top=s+"px",e.style.left=l+"px"},getSize:function(e){return e==window||e==document?t.getWindowSize():{width:e.offsetWidth,height:e.offsetHeight}},offset:function(e){var t=e.getBoundingClientRect();return{left:t.left+window.pageXOffset-document.documentElement.clientLeft,top:t.top+window.pageYOffset-document.documentElement.clientTop,width:e.offsetWidth,height:e.offsetHeight}},getWindowSize:function(){return{width:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,height:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}},fadeIn:function(e,t){if(+e.style.opacity<1){t=t||16,e.style.opacity=0,e.style.display="block";var n=+new Date,i=function(){e.style.opacity=+e.style.opacity+(new Date-n)/100,n=+new Date,+e.style.opacity<1&&setTimeout(i,t)};i()}e.style.display="block"},fadeOut:function(e,t){t=t||16,e.style.opacity=1;var n=+new Date,i=function(){e.style.opacity=+e.style.opacity-(new Date-n)/100,n=+new Date,+e.style.opacity>0?setTimeout(i,t):e.style.display="none"};i()},getTopMargin:function(e){e.style.left="-9999px",e.style.display="block";var t,n=e.clientHeight;return t="undefined"!=typeof getComputedStyle?parseInt(getComputedStyle(e).paddingTop,10):parseInt(e.currentStyle.padding),e.style.left="",e.style.display="none","-"+parseInt((n+t)/2)+"px"},toType:function(e){return e==window&&e.document&&e.location?"window":e==document?"htmldocument":"string"==typeof e?"string":t.isElement(e)?"element":void 0},typeOf:function(e){return{}.toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},removeArrayEntry:function(e,t){var n=e.indexOf(t);n>-1&&e.splice(n,1)},bytesToSize:function(e){if(0===e)return"0 Byte";var t=1e3,n=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],i=Math.floor(Math.log(e)/Math.log(t));return(e/Math.pow(t,i)).toPrecision(3)+" "+n[i]},easing:{bounce:function(e){return 1/2.75>e?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},swingTo:function(e){var t=1.70158;return(e-=1)*e*((t+1)*e+t)+1},easeIn:function(e){return Math.pow(e,3)},easeOut:function(e){return 1-t.easing.easeIn(1-e)},easeInOutBack:function(e){var t=1.70158;return(e/=.5)<1?.5*(e*e*(((t*=1.525)+1)*e-t)):.5*((e-=2)*e*(((t*=1.525)+1)*e+t)+2)},easeFromTo:function(e){return(e/=.5)<1?.5*Math.pow(e,4):-.5*((e-=2)*Math.pow(e,3)-2)},inAndOut:function(e){return 3*e*e-2*e*e*e}}};return e.Base=function(n){var i=t.deepExtend({},e.defaultOptions);e.options=t.deepExtend(i,n),e.$base=this,e.$html=new e.Html,e.$html.createBrowser(),e.$html.createAlert(),e.$drag=new e.DragAndResize,e.$tree=new e.Tree,e.$alert=new e.Alert,e.$upload=new e.Upload,this.current_active=e.elements.folder_tree_root,this.root_event_added=!1,this.thumbs_root=[],this.thumbs_selected=[],this.path=t.getPath(),e.$tree.build(),this.setListeners(),e.$drag.when({startDragging:function(){t.addClass(e.container,"dragging")},dragging:function(){e.container.style.left=this.x+"px",e.container.style.top=this.y+"px"},endDragging:function(){t.removeClass(e.container,"dragging"),this.y<0&&(e.container.style.top=0)},resizing:function(){e.container.style.width=this.w+"px",e.container.style.height=this.h+"px"},endResizing:function(){var t=400,n=300;this.w<t&&(e.container.style.width=t+"px"),this.h<n&&(e.container.style.height=n+"px")}})},e.Base.prototype={show:function(){e.container.style.zIndex=t.getMaxZIndex()+10,e.container.style.display="block",t.setCenter(e.container)},setEditor:function(t){e.options.editor=t},setListeners:function(){var t=e.elements,n=function(){this.blur(),e.$tree.newFolder()},i=function(){this.blur(),e.$tree.removeFolder()},r=function(){this.blur(),e.$tree.removeFile()},o=function(){this.blur(),e.$tree.sendEditor()},a=function(){this.blur(),e.$tree.closeBrowser()},s=function(){this.blur(),e.$upload.choose()},l=function(){this.blur(),e.$upload.start()};t.btn_new_folder.addEventListener("click",n,!1),t.btn_del_folder.addEventListener("click",i,!1),t.btn_upload_choose.addEventListener("click",s,!1),t.btn_upload_file.addEventListener("click",l,!1),t.btn_del_file.addEventListener("click",r,!1),t.btn_editor.addEventListener("click",o,!1),t.btn_close_grd.addEventListener("click",a,!1)}},e.constants={css:{container:"filebrowser-fb fb-container",alert_overlay:"filebrowser-fb fb-alert-overlay",alert_container:"filebrowser-fb fb-alert"},types:{image:"image"},actions:{upload:"upload",new_folder:"new-folder",delete_folder:"del-folder",delete_file:"del-file",get_thumbs:"get-thumbs"},suffix_small:"small",suffix_medium:"medium",thumb_path:"data-path",thumb_sel:"selected",li_key:"data-key"},e.defaultOptions={mode:"plugin",lang:"en",root_http:"/",server_http:"browser.php",regex_folder:/^[a-zA-Z0-9-_.]{1,10}$/,upload_types:[e.constants.types.image],image:{min_width:120,min_height:120}},e.elements={},e.lang={},e.lang["pt-br"]={title:"Image Browser",root_folder:"Root Folder",preview:"Sending Preview",send_to_editor:"Send to Editor",toolbar:{bt_choose:"Escolha",bt_send:"Envie",bt_del_file:"Remover Arquivo",bt_new_folder:"Nova Pasta",bt_del_folder:"Remover Pasta",bt_send_editor:"Enviar para o Editor"},file:{total:"Total de Arquivos:",del:"Remover Arquivo",dels:"Remover Arquivos"},folder:{new_:"Nova Pasta",del:"Remover Pasta",creation:"Esta pasta será criada em:",minimum:["<p>Preenchimento mínimo: 1 - máximo: 10",'<br>Apenas <span class="strong">letras</span>, ','<span class="strong">números</span>',' e os seguintes caracteres: <span class="highlight">. - _</span></p>'].join(""),deletion:['<p class="folder-path">Esta pasta <span>%1</span>'," será removida juntamente com todo seu conteúdo: </p>",'<p>Total de Arquivos: <span class="destaque">%2</span>',' &mdash; Total de Sub-Pastas: <span class="destaque">%3</span></p>'].join("")},alert:{bt_ok:"OK",bt_cancel:"Cancelar",image:{not_min_size:"Apenas imagens com no mínimo %1 x %2!"},upload:{sending:"Um envio já está em andamento!",none:"Nenhum arquivo foi selecionado!",sent:"Todos os arquivos já foram enviados!"}}},e.lang.en={title:"Image Browser",root_folder:"Root Folder",preview:"Sending Preview",send_to_editor:"Send to Editor",toolbar:{bt_choose:"Choose",bt_send:"Send",bt_del_file:"Delete File",bt_new_folder:"New Folder",bt_del_folder:"Delete Folder",bt_send_editor:"Send to Editor"},file:{total:"Total Files:",del:"Delete File",dels:"Delete Files"},folder:{new_:"New Folder",del:"Delete Folder",creation:"This folder will be created inside:",minimum:["<p>Min-length: 1 - Max-length: 10",'<br>Only <span class="strong">letters</span>, ','<span class="strong">numbers</span> ','and the following characters: <span class="highlight">. - _</span></p>'].join(""),deletion:['<p class="folder-path">This folder <span>%1</span>'," will be removed with all its contents: </p>",'<p>Total Files: <span class="destaque">%2</span>',' &mdash; Total Subfolders: <span class="destaque">%3</span></p>'].join("")},alert:{bt_ok:"OK",bt_cancel:"Cancel",image:{not_min_size:"Only images with minimum %1 x %2!"},upload:{sending:"An upload is already in progress!",none:"No file!",sent:"All done!"}}},e.Tree=function(){this.els=e.elements,this.options=e.options,this.lang=e.lang[e.options.lang]},e.Tree.prototype={get:function(){t.addClass(this.els.grd_preview,"mapeando-spinner");var n={},i=this;return t.json(this.options.server_http,{action:e.constants.actions.get_thumbs,lang:e.options.lang}).when({ready:function(r){t.removeClass(i.els.grd_preview,"mapeando-spinner"),"files"in r.tree&&(e.$base.thumbs_root=r.tree.files,i.loadThumbs(e.$base.thumbs_root)),"dirs"in r.tree&&n.ready.call(void 0,{dirs:r.tree.dirs}),i.updateCountFolder()}}),{when:function(e){n.ready=e.ready}}},build:function(){var e=this;this.get().when({ready:function(t){e.buildTree(t.dirs),e.treeEvents(t.dirs)}})},buildTree:function(e){for(var n,i,r,o,a=this,s=function(e,n,i,r){var o={folder:e,"n-files":n.files,"n-files-all":n["files-all"],"n-folders":n.folders,last:r},s=a.folderTemplate(o),l=t.createElement(["ol",{classname:"collapse"}],s),c=i.appendChild(l);return c},l=function(e,t){for(var n,i,r,o,a=Object.keys(e),c=a.length,d=-1,u={};++d<c;)n=a[d],i=e[n],o=i.last===!0?1:0,u={files:i.files?i.files.length:0,"files-all":i["c-files"],folders:i["c-folders"]},r=s(n,u,t,o),i.dirs&&l(i.dirs,r.firstChild)},c=Object.keys(e),d=c.length,u=-1,f={};++u<d;)n=c[u],i=e[n],o=i.last===!0?1:0,f={files:i.files?i.files.length:0,"files-all":i["c-files"],folders:i["c-folders"]},r=s(n,f,this.els.folder_tree_root,o),i.dirs&&l(i.dirs,r.firstChild)},showHeaderMessage:function(e){var n=this;this.els.grd_msg.textContent=e.msg,t.addClass(this.els.grd_msg,["show",e.type]),window.setTimeout(function(){t.removeClass(n.els.grd_msg,["show",e.type])},e.duration)},renewTree:function(n){return this.removeTree(),this.emptyThumbSelected(),this.removeThumbs(),t.emptyArray(e.$base.thumbs_root),e.$base.current_active=!1,Array.isArray(n)&&0===n.length?(this.updateCountFolder(),void t.fireClick(this.els.folder_tree_root)):("files"in n&&(e.$base.thumbs_root=n.files,this.loadThumbs(e.$base.thumbs_root)),"dirs"in n&&(this.buildTree(n.dirs),this.treeEvents(n.dirs)),this.updateCountFolder(),void this.setFolderActive())},newFolder:function(){var t=this,n=this.options.regex_folder,i=function(){n.test(this)?e.$alert.hideInputError():e.$alert.showInputError(t.lang.folder.minimum)},r=function(){return n.test(this)?void t.submitFolder(this,e.constants.actions.new_folder).when({ready:function(n){n.erro===!1?(t.renewTree(n.tree),e.$alert.close()):e.$alert.showInputError(n.msg)}}):void e.$alert.showInputError(t.lang.folder.minimum)},o=this.getFolderPath(e.$base.current_active),a=o.length,s="<span>"+this.lang.root_folder+"</span>";for(o.reverse();a--;)s+="&nbsp;&rarr;&nbsp;<span>"+o[a]+"</span>";var l="<p>"+this.lang.folder.creation+'</p><p class="folder-path">'+s+"</p>",c={title:this.lang.folder.new_,text:l};e.$alert.prompt({placeholder:this.lang.folder.new_,html:c,checkInput:i,submit:r})},submitFolder:function(n,i){var r=i==e.constants.actions.delete_folder?this.getFolderPath(e.$base.current_active,!0):this.getFolderPath(e.$base.current_active),o={};return t.post(this.options.server_http,{action:i,folder:n,parents:r.join(),lang:e.options.lang}).when({ready:function(e){o.ready.call(void 0,e)}}),{when:function(e){o.ready=e.ready}}},removeFolder:function(){var n=this,i=e.$base.current_active,r=i.getAttribute("data-key"),o=i.getAttribute("data-files-all"),a=i.getAttribute("data-folders"),s=function(){n.submitFolder(r,e.constants.actions.delete_folder).when({ready:function(t){t.erro===!1?(n.renewTree(t.tree),e.$alert.close()):e.$alert.showInputError(t.msg)}})},l=t.templateLang(this.lang.folder.deletion,[r,o,a]),c={title:this.lang.folder.del,text:l};e.$alert.confirm({html:c,submit:s})},removeFile:function(){var n=this,i=function(){t.post(n.options.server_http,{action:e.constants.actions.delete_file,files:e.$base.thumbs_selected.join(),lang:e.options.lang}).when({ready:function(t){n.renewTree(t.tree),e.$alert.close()}})},r=["<p>",this.lang.file.total,'<span class="highlight">',e.$base.thumbs_selected.length,"</span></p>"].join(""),o={title:this.lang.file.del,text:r};e.$alert.confirm({html:o,submit:i})},setFolderActive:function(){for(var e,n,i=this,r=t.find("li",this.els.folder_tree_root,!0),o=r.length,a=!1,s=-1,l=function(e){for(var n,r=e.parentNode,o=!0;o;)r?r==i.els.folder_tree_root?o=!1:"OL"==r.tagName&&(n=t.getSiblings(r,"ol"),t.removeClass(n,"collapse"),t.removeClass(r,"collapse")):o=!1,r=r.parentNode;t.fireClick(e)};++s<o;)if(e=r[s],n=e.getAttribute("data-last"),1==n){a=!0,l(e);break}a&&0!==o||t.fireClick(this.els.folder_tree_root)},getFolderPath:function(e,t){var n=[];for(t&&(e=e.parentNode);e&&e!==this.els.folder_tree_root;)"LI"==e.tagName&&n.unshift(e.getAttribute("data-key")),e=e.parentNode;return n},getFolderParent:function(e){e=e.parentNode;for(var t,n=!0;e&&n;)"LI"==e.tagName&&(t=e,n=!1),e=e.parentNode;return t},treeEvents:function(n){var i=this,r=t.find("li",this.els.folder_tree,!0),o=r.length;if(0!==o)for(var a=function(e){var n=!0;for(e=e.parentNode;e&&n;)"LI"==e.tagName&&(t.addClass(e,"open"),e==i.els.folder_tree_root&&(n=!1)),e=e.parentNode},s=function(n){var i=t.hasClass(n,"open"),r=t.hasClass(n,"active"),o=t.getChildren(n,"ol"),a=t.getAllChildren(n,"ol"),s=t.getAllChildren(n,"li");i&&r?(t.addClass(a,"collapse"),t.removeClass(s,"open"),t.removeClass(n,"open")):i?(t.addClass(a,"collapse"),t.removeClass(s,"open"),t.removeClass(n,"open")):(t.removeClass(o,"collapse"),t.addClass(n,"open")),e.$base.current_active=n,t.addClass(n,"active")},l=(function(e,t,n){var r,o,a=e.length;n=n||1;for(r in t)if(r==e[n-1])if(n==a){if(o=t[r],o&&"files"in o){i.loadThumbs(o.files);break}}else++n,l(e,t[r].dirs,n);return!1}),c=function(t,n){if(t==i.els.folder_tree_root)return void i.loadThumbs(e.$base.thumbs_root);for(var r=[];t&&t!==i.els.folder_tree_root;)"LI"==t.tagName&&r.unshift(t.getAttribute("data-key")),t=t.parentNode;l(r,n)},d=function(r){r.stopPropagation(),e.$upload.showTree(),this!=e.$base.current_active&&(i.removeThumbs(),c(this,n)),e.$base.current_active=e.$base.current_active||i.els.folder_tree_root,t.removeClass(e.$base.current_active,"active"),a(this),s(this),this==i.els.folder_tree_root?i.els.btn_del_folder.style.display="none":i.els.btn_del_folder.style.display=""},u=-1;++u<o;)!function(n){var o=r[n];if(0===n){var a=t.getChildren(o,"ol");a.length>0&&t.removeClass(a,"collapse")}o==i.els.folder_tree_root?e.$base.root_event_added||(o.addEventListener("click",d,!1),e.$base.root_event_added=!0):o.addEventListener("click",d,!1)}(u)},emptyThumbSelected:function(){var n=t.find("li",this.els.grd_preview,!0);t.emptyArray(e.$base.thumbs_selected),t.removeClass(n,e.constants.thumb_sel),this.buttonThumbRemoveHandler()},buttonThumbRemoveHandler:function(){var n=e.$base.thumbs_selected.length,i=n>1?this.lang.file.dels:this.lang.file.del;n>0?(t.removeClass(this.els.btn_editor,"hidden"),t.removeClass(this.els.btn_del_file,"hidden"),this.els.desc_btn_del_file.textContent=i+" ("+n+")",this.els.desc_btn_editor.textContent=this.lang.send_to_editor+" ("+n+")"):(t.addClass(this.els.btn_editor,"hidden"),t.addClass(this.els.btn_del_file,"hidden"))},updateCountFolder:function(){this.els.folder_root_desc.textContent=this.lang.root_folder+" ("+e.$base.thumbs_root.length+")"},removeThumbs:function(){t.removeAllChildren(this.els.grd_preview)},loadThumbs:function(n){for(var i,r,o,a,s,l,c=this,d=-1,u=this.options.root_http,f=n.length,p=function(){t.toggleClass(this,e.constants.thumb_sel);var n=t.hasClass(this,e.constants.thumb_sel),i=this.getAttribute(e.constants.thumb_path);n?e.$base.thumbs_selected.push(i):t.removeArrayEntry(e.$base.thumbs_selected,i),c.buttonThumbRemoveHandler()};++d<f;)a=n[d],s=a.relative_path+a.filename,l=e.$base.thumbs_selected.indexOf(s)>-1,i={filename:a.filename,date:a.date,filesize:a.filesize,url:u+s},r=this.thumbTemplate(i),o=t.createElement(["li",{classname:l?e.constants.thumb_sel:"",attr:[{name:e.constants.thumb_path,value:s}]}],r),this.els.grd_preview.appendChild(o),o.addEventListener("click",p,!1)},sendEditor:function(){for(var t,n=this.options.editor,i=e.$base.thumbs_selected.length,r=-1;++r<i;)t=e.$base.thumbs_selected[r].replace(e.constants.suffix_small,e.constants.suffix_medium),n.insertHtml('<img src="'+this.options.root_http+t+'">');this.emptyThumbSelected(),this.closeBrowser()},closeBrowser:function(){this.els.container.style.display="none"},removeTree:function(){var e=this.els.folder_tree_root.getElementsByTagName("ol");t.removeAll(e)},thumbTemplate:function(e){var n=['<a class="brankic-checked" style="background-image:url({url})">','<span class="fb-fileinfo">','<span class="fb-fileinfo-center">',"<span>{filename}</span>","<span>{date}<br>{filesize}</span>","</span>","</span>","</a>"].join("");return t.template(n,e)},folderTemplate:function(e){var n=['<li data-key="{folder}" data-last="{last}" ','data-files-all="{n-files-all}" data-folders="{n-folders}"><a>','<i class="icomoon-folder"></i>',"<span>{folder} ({n-files})</span>","</a></li>"].join("");return t.template(n,e)}},e.Html=function(){},e.Html.prototype={createBrowser:function(){var n=e.lang[e.options.lang],i=['<div class="fb-wrap">',"<header>",'<div class="fb-header unselectable">',"<span>",n.title,"</span>",'<span class="close"></span>',"</div>",'<h5 class="fb-message"></h5>','<div class="fb-toolbar">','<div class="fb-toolbar-items">','<button id="btn-upload-choose" class="button-filebrowser">','<i class="brankic-attachment"></i>',"<span>",n.toolbar.bt_choose,"</span>","</button>",'<button class="button-filebrowser hidden" id="btn-upload-send">','<i class="brankic-upload"></i>',"<span>",n.toolbar.bt_send,"</span>","</button>",'<button class="button-filebrowser hidden" id="btn-del-file">','<i class="brankic-trashcan"></i>',"<span>",n.toolbar.bt_del_file,"</span>","</button>",'<button class="button-filebrowser" id="btn-new-folder">','<i class="icomoon-folder-plus"></i>',"<span>",n.toolbar.bt_new_folder,"</span>","</button>",'<button class="button-filebrowser" id="btn-del-folder" ','style="display:none">','<i class="icomoon-folder-minus"></i>',"<span>",n.toolbar.bt_del_folder,"</span>","</button>",'<button class="button-filebrowser hidden" id="btn-editor">','<i class="brankic-edit"></i>',"<span>",n.toolbar.bt_send_editor,"</span>","</button>","</div>","</div>","</header>",'<div class="fb-body clearfix">','<div class="fb-tree-container">','<ol id="fb-tree">','<li id="fb-tree-folder-root" class="active open">',"<a>",'<i class="icomoon-folder"></i>','<span id="folder-root-desc">',n.root_folder,"</span>","</a>","</li>","</ol>","</div>",'<div class="fb-thumb-container">','<ul id="fb-thumb" class="fb-thumb clearfix"></ul>','<div class="js-fileapi-wrapper">','<input id="upload-input" class="input-file" name="files" ','type="file" multiple />',"</div>",'<ul id="upload-thumb" class="fb-upload-thumb" data-label="',n.preview,'"></ul>',"</div>","</div>",'<footer class="fb-footer clearfix">',"<span></span>","</footer>","</div>"].join(""),r=t.createElement(["div",{classname:e.constants.css.container}],i),o={container:r,drag_handle:r.querySelector(".fb-header"),resize_handle:r.querySelector(".fb-footer > span"),grd_preview:r.querySelector("#fb-thumb"),folder_tree:r.querySelector("#fb-tree"),folder_tree_root:r.querySelector("#fb-tree-folder-root"),folder_root_desc:r.querySelector("#folder-root-desc"),upload_input:r.querySelector("#upload-input"),btn_upload_choose:r.querySelector("#btn-upload-choose"),btn_new_folder:r.querySelector("#btn-new-folder"),btn_del_folder:r.querySelector("#btn-del-folder"),btn_del_file:r.querySelector("#btn-del-file"),btn_upload_file:r.querySelector("#btn-upload-send"),btn_editor:r.querySelector("#btn-editor"),images_list:r.querySelector("#upload-thumb"),grd_msg:r.querySelector(".fb-message"),grd_drag:r.querySelector(".fb-header"),grd_resize:r.querySelector(".fb-footer"),desc_btn_del_file:r.querySelector("#btn-del-file span"),desc_btn_editor:r.querySelector("#btn-editor span"),btn_close_grd:r.querySelector(".fb-header span.close")};for(var a in o)e.elements[a]=o[a];r.style.position="fixed",r.style.zIndex=e.$base.maxZIndex+10,r.style.display="none",document.body.appendChild(r),e.container=r},createAlert:function(){var n=e.lang[e.options.lang],i=['<div class="fb-icon fb-error" style="display:none;">','<span class="fb-x-mark">','<span class="fb-line fb-left"></span>','<span class="fb-line fb-right"></span>',"</span>","</div>",'<div class="fb-icon fb-warning" style="display:none;">','<span class="fb-body"></span>','<span class="fb-dot"></span>',"</div>",'<div class="fb-icon fb-info" style="display:none;"></div>','<h2 class="fb-title"></h2>','<div class="fb-text"></div>','<fieldset><input type="text" style="display:none;"></fieldset>','<div class="fb-error-container">','<div class="icon">!</div>','<div class="fb-error-text"></div>',"</div>",'<div class="fb-button-container">','<button class="button-filebrowser cancel">',n.alert.bt_cancel,"</button>",'<button class="button-filebrowser ok">',n.alert.bt_ok,"</button>","</div>"].join(""),r=document.createElement("div"),o=t.createElement(["div",{classname:e.constants.css.alert_container}],i),a={alert_overlay:r,alert_container:o,alert_title:o.querySelector(".fb-title"),alert_text:o.querySelector(".fb-text"),alert_input:o.querySelector('input[type="text"]'),alert_icon_error:o.querySelector(".fb-icon.fb-error"),alert_icon_warning:o.querySelector(".fb-icon.fb-warning"),alert_icon_info:o.querySelector(".fb-icon.fb-info"),alert_icon_success:o.querySelector(".fb-icon.fb-success"),alert_elem_error:o.querySelector(".fb-error-container"),alert_error_text:o.querySelector(".fb-error-text"),alert_ok:o.querySelector("button.ok"),alert_cancel:o.querySelector("button.cancel")};for(var s in a)e.elements[s]=a[s];return r.className=e.constants.css.alert_overlay,r.style.zIndex=e.$base.maxZIndex+11,o.style.zIndex=e.$base.maxZIndex+12,o.style.display="none",document.body.appendChild(r),document.body.appendChild(o),o}},e.DragAndResize=function(){var n,i,r,o,a,s,l={};return e.elements.drag_handle.addEventListener("mousedown",function(t){function c(t){r=parseInt(e.container.style.left,10)||0,o=parseInt(e.container.style.top,10)||0,a=r+(t.clientX-n),s=o+(t.clientY-i),l.dragging.call({target:e.container,x:a,y:s}),n=t.clientX,i=t.clientY}function d(){window.removeEventListener("mousemove",c,!1),window.removeEventListener("mouseup",d,!1),l.endDragging.call({target:e.container,x:a,y:s})}0===t.button&&(t.preventDefault(),n=t.clientX,i=t.clientY,l.startDragging.call({target:e.container}),window.addEventListener("mousemove",c,!1),window.addEventListener("mouseup",d,!1))},!1),e.elements.resize_handle.addEventListener("mousedown",function(n){function i(n){var i=t.offset(e.container);a=n.clientX-i.left,s=n.clientY-i.top,l.resizing.call({target:e.container,w:a,h:s})}function r(){window.removeEventListener("mousemove",i,!1),window.removeEventListener("mouseup",r,!1),l.endResizing.call({target:e.container,w:a,h:s})}n.preventDefault(),2!=n.which&&3!=n.which&&(window.addEventListener("mousemove",i,!1),window.addEventListener("mouseup",r,!1))},!1),{when:function(e){l={startDragging:e.startDragging,endDragging:e.endDragging,dragging:e.dragging,startResizing:e.startResizing,endResizing:e.endResizing,resizing:e.resizing}}}},e.Upload=function(){this.els=e.elements,this.files=[],this.index=0,this.active=!1,this.path_parents="",this.setListeners(),this.lang=e.lang[e.options.lang]},e.Upload.prototype={setListeners:function(){var n=this,i=function(t,n){return/^image/.test(t.type)?n.width>=e.options.image.min_width&&n.height>=e.options.image.min_height:!1};FileAPI.event.on(this.els.upload_input,"change",function(r){var o=FileAPI.getFiles(r);FileAPI.filterFiles(o,function(t,n){var r;return e.options.upload_types.forEach(function(o){o==e.constants.types.image&&(r=i(t,n))}),r},function(i,r){r&&r.length&&e.$tree.showHeaderMessage({msg:t.templateLang(n.lang.alert.image.not_min_size,[e.options.image.min_width,e.options.image.min_height]),duration:3500,type:"alert"}),i.length&&n.add(i)})})},choose:function(){t.fireClick(this.els.upload_input)},showPreview:function(){this.els.grd_preview.style.display="none",this.els.images_list.style.display="",t.removeClass(this.els.btn_upload_file,"hidden")},showTree:function(){this.els.grd_preview.style.display="",this.els.images_list.style.display="none",t.addClass(this.els.btn_upload_file,"hidden")},add:function(n){var i,r,o,a,s=this;this.showPreview(),e.$tree.emptyThumbSelected(),FileAPI.each(n,function(e){s.files.push(e),FileAPI.Image(e).preview(70).get(function(n,l){i={name:e.name,size:t.bytesToSize(e.size)},r=s.thumbTemplate(i),o=t.createElement("li",r),o.id="file-"+FileAPI.uid(e),s.els.images_list.appendChild(o),a=t.find(".fb-preview-left",o),a.appendChild(l)})}),window.setTimeout(function(){t.fireClick(s.els.btn_upload_file)},300)},thumbTemplate:function(e){var n=['<div class="fb-preview-left"></div>','<div class="fb-preview-right">','<div class="fb-preview-filename">',"<span>{name}</span><br/>","<span>tamanho: {size}</span>","</div>",'<div class="fb-preview-progress">','<div class="fb-progress-bar"></div>',"</div>","</div>"].join("");return t.template(n,e)},getFileById:function(e){for(var t=this.files.length;t--;)if(FileAPI.uid(this.files[t])==e)return this.files[t]},start:function(){var t=this.files.length;return this.path_parents=e.$tree.getFolderPath(e.$base.current_active),this.active?void e.$tree.showHeaderMessage({msg:this.lang.alert.upload.sending,duration:1500,type:"alert"}):0===t?void e.$tree.showHeaderMessage({msg:this.lang.alert.upload.none,duration:1500,type:"alert"}):t==this.index?void e.$tree.showHeaderMessage({msg:this.lang.alert.upload.sent,duration:1500,type:"alert"}):void this.start_()},start_:function(){!this.active&&(this.active=this.files.length>this.index)&&this.upload_(this.files[this.index])},abort:function(e){var t=this.getFileById(e);t.xhr&&t.xhr.abort()},getEl_:function(e,n){var i=t.$("file-"+FileAPI.uid(e));return n?t.find(n,i):i},upload_:function(t){var n=this,i=this.getEl_(t,".fb-progress-bar");t&&(t.xhr=FileAPI.upload({url:e.options.server_http,files:{file:t},data:{action:"upload",parents:this.path_parents.join()},imageOriginal:!1,imageTransform:{big:{maxWidth:800,maxHeight:600},medium:{maxWidth:320,maxHeight:240},small:{maxWidth:100,maxHeight:100}},filecomplete:function(e){e&&console.info(e)},progress:function(e){i.style.width=e.loaded/e.total*100+"%"},complete:function(t,i){if(n.index++,n.active=!1,n.start_(),n.files.length==n.index){var r=FileAPI.parseJSON(i.responseText);r.erro===!1&&(e.$tree.showHeaderMessage({msg:n.lang.alert.upload.sent,duration:2500,type:"success"}),window.setTimeout(function(){n.showTree(),e.$tree.renewTree(r.tree)},1500))}}}))}},e.Alert=function(){this.els=e.elements,this.setListeners(),this.opened=!1,this.options={}},e.Alert.prototype={show:function(){var e=this.els.alert_container,n=parseInt(this.els.container.style.zIndex);this.els.alert_title.textContent=this.options.html.title,this.els.alert_text.innerHTML=this.options.html.text,t.addClass(document.body,"filebrowser-fb-stop-scrolling"),t.fadeIn(this.els.alert_overlay),this.els.alert_overlay.style.zIndex=n+1,e.style.marginTop=t.getTopMargin(e),e.style.opacity="",e.style.zIndex=n+2,e.style.display="block",
t.addClass(e,"fb-alert-show"),t.removeClass(e,"fb-alert-hide"),window.previousActiveElement=document.activeElement,this.opened=!0,this.hideInputError()},close:function(){this.opened=!1,t.fadeOut(this.els.alert_overlay),t.fadeOut(this.els.alert_container),t.addClass(this.els.alert_container,"fb-alert-hide"),t.removeClass(this.els.alert_container,"fb-alert-show"),t.removeClass(document.body,"filebrowser-fb-stop-scrolling"),window.previousActiveElement},checkInput:function(e,t){13===e?this.options.submit.call(t):this.options.checkInput.call(t)},submit:function(){this.options.submit.call(this.els.alert_input.value)},prompt:function(e){this.options=e,this.show(),this.els.alert_icon_warning.style.display="none",this.els.alert_input.style.display="",this.els.alert_input.setAttribute("placeholder",e.placeholder),this.els.alert_input.focus()},confirm:function(e){this.options=e,this.show(),this.els.alert_icon_warning.style.display="",this.els.alert_input.style.display="none",this.els.alert_input.focus()},showInputError:function(e){t.addClass(this.els.alert_input,"invalid"),t.addClass(this.els.alert_elem_error,"show"),this.els.alert_error_text.innerHTML=e},hideInputError:function(){t.removeClass(this.els.alert_input,"invalid"),t.removeClass(this.els.alert_elem_error,"show")},setListeners:function(){var e=this,t=function(){this.blur(),e.submit()},n=function(){this.blur(),e.close()},i=function(t){e.checkInput(t.keyCode,this.value)},r=function(t){27===t.keyCode&&e.opened&&e.close()};this.els.alert_ok.addEventListener("click",t,!1),this.els.alert_cancel.addEventListener("click",n,!1),this.els.alert_input.addEventListener("keyup",i,!1),document.addEventListener("keydown",r,!1)}},e.Base}),!function e(t,n,i){function r(a,s){if(!n[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[a]={exports:{}};t[a][0].call(d.exports,function(e){var n=t[a][1][e];return r(n?n:e)},d,d.exports,e,t,n,i)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(e,t,n){var i=e("../main");"function"==typeof define&&define.amd?define(i):(window.PerfectScrollbar=i,"undefined"==typeof window.Ps&&(window.Ps=i))},{"../main":7}],2:[function(e,t,n){function i(e,t){var n=e.className.split(" ");n.indexOf(t)<0&&n.push(t),e.className=n.join(" ")}function r(e,t){var n=e.className.split(" "),i=n.indexOf(t);i>=0&&n.splice(i,1),e.className=n.join(" ")}n.add=function(e,t){e.classList?e.classList.add(t):i(e,t)},n.remove=function(e,t){e.classList?e.classList.remove(t):r(e,t)},n.list=function(e){return e.classList?Array.prototype.slice.apply(e.classList):e.className.split(" ")}},{}],3:[function(e,t,n){function i(e,t){return window.getComputedStyle(e)[t]}function r(e,t,n){return"number"==typeof n&&(n=n.toString()+"px"),e.style[t]=n,e}function o(e,t){for(var n in t){var i=t[n];"number"==typeof i&&(i=i.toString()+"px"),e.style[n]=i}return e}var a={};a.e=function(e,t){var n=document.createElement(e);return n.className=t,n},a.appendTo=function(e,t){return t.appendChild(e),e},a.css=function(e,t,n){return"object"==typeof t?o(e,t):"undefined"==typeof n?i(e,t):r(e,t,n)},a.matches=function(e,t){return"undefined"!=typeof e.matches?e.matches(t):"undefined"!=typeof e.matchesSelector?e.matchesSelector(t):"undefined"!=typeof e.webkitMatchesSelector?e.webkitMatchesSelector(t):"undefined"!=typeof e.mozMatchesSelector?e.mozMatchesSelector(t):"undefined"!=typeof e.msMatchesSelector?e.msMatchesSelector(t):void 0},a.remove=function(e){"undefined"!=typeof e.remove?e.remove():e.parentNode&&e.parentNode.removeChild(e)},a.queryChildren=function(e,t){return Array.prototype.filter.call(e.childNodes,function(e){return a.matches(e,t)})},t.exports=a},{}],4:[function(e,t,n){var i=function(e){this.element=e,this.events={}};i.prototype.bind=function(e,t){"undefined"==typeof this.events[e]&&(this.events[e]=[]),this.events[e].push(t),this.element.addEventListener(e,t,!1)},i.prototype.unbind=function(e,t){var n="undefined"!=typeof t;this.events[e]=this.events[e].filter(function(i){return n&&i!==t?!0:(this.element.removeEventListener(e,i,!1),!1)},this)},i.prototype.unbindAll=function(){for(var e in this.events)this.unbind(e)};var r=function(){this.eventElements=[]};r.prototype.eventElement=function(e){var t=this.eventElements.filter(function(t){return t.element===e})[0];return"undefined"==typeof t&&(t=new i(e),this.eventElements.push(t)),t},r.prototype.bind=function(e,t,n){this.eventElement(e).bind(t,n)},r.prototype.unbind=function(e,t,n){this.eventElement(e).unbind(t,n)},r.prototype.unbindAll=function(){for(var e=0;e<this.eventElements.length;e++)this.eventElements[e].unbindAll()},r.prototype.once=function(e,t,n){var i=this.eventElement(e),r=function(e){i.unbind(t,r),n(e)};i.bind(t,r)},t.exports=r},{}],5:[function(e,t,n){t.exports=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}}()},{}],6:[function(e,t,n){var i=e("./class"),r=e("./dom");n.toInt=function(e){return parseInt(e,10)||0},n.clone=function(e){if(null===e)return null;if("object"==typeof e){var t={};for(var n in e)t[n]=this.clone(e[n]);return t}return e},n.extend=function(e,t){var n=this.clone(e);for(var i in t)n[i]=this.clone(t[i]);return n},n.isEditable=function(e){return r.matches(e,"input,[contenteditable]")||r.matches(e,"select,[contenteditable]")||r.matches(e,"textarea,[contenteditable]")||r.matches(e,"button,[contenteditable]")},n.removePsClasses=function(e){for(var t=i.list(e),n=0;n<t.length;n++){var r=t[n];0===r.indexOf("ps-")&&i.remove(e,r)}},n.outerWidth=function(e){return this.toInt(r.css(e,"width"))+this.toInt(r.css(e,"paddingLeft"))+this.toInt(r.css(e,"paddingRight"))+this.toInt(r.css(e,"borderLeftWidth"))+this.toInt(r.css(e,"borderRightWidth"))},n.startScrolling=function(e,t){i.add(e,"ps-in-scrolling"),"undefined"!=typeof t?i.add(e,"ps-"+t):(i.add(e,"ps-x"),i.add(e,"ps-y"))},n.stopScrolling=function(e,t){i.remove(e,"ps-in-scrolling"),"undefined"!=typeof t?i.remove(e,"ps-"+t):(i.remove(e,"ps-x"),i.remove(e,"ps-y"))},n.env={isWebKit:"WebkitAppearance"in document.documentElement.style,supportsTouch:"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,supportsIePointer:null!==window.navigator.msMaxTouchPoints}},{"./class":2,"./dom":3}],7:[function(e,t,n){var i=e("./plugin/destroy"),r=e("./plugin/initialize"),o=e("./plugin/update");t.exports={initialize:r,update:o,destroy:i}},{"./plugin/destroy":9,"./plugin/initialize":17,"./plugin/update":21}],8:[function(e,t,n){t.exports={maxScrollbarLength:null,minScrollbarLength:null,scrollXMarginOffset:0,scrollYMarginOffset:0,stopPropagationOnClick:!0,suppressScrollX:!1,suppressScrollY:!1,swipePropagation:!0,useBothWheelAxes:!1,useKeyboard:!0,useSelectionScroll:!1,wheelPropagation:!1,wheelSpeed:1,theme:"default"}},{}],9:[function(e,t,n){var i=e("../lib/dom"),r=e("../lib/helper"),o=e("./instances");t.exports=function(e){var t=o.get(e);t&&(t.event.unbindAll(),i.remove(t.scrollbarX),i.remove(t.scrollbarY),i.remove(t.scrollbarXRail),i.remove(t.scrollbarYRail),r.removePsClasses(e),o.remove(e))}},{"../lib/dom":3,"../lib/helper":6,"./instances":18}],10:[function(e,t,n){function i(e,t){function n(e){return e.getBoundingClientRect()}var i=window.Event.prototype.stopPropagation.bind;t.settings.stopPropagationOnClick&&t.event.bind(t.scrollbarY,"click",i),t.event.bind(t.scrollbarYRail,"click",function(i){var o=r.toInt(t.scrollbarYHeight/2),l=t.railYRatio*(i.pageY-window.pageYOffset-n(t.scrollbarYRail).top-o),c=t.railYRatio*(t.railYHeight-t.scrollbarYHeight),d=l/c;0>d?d=0:d>1&&(d=1),s(e,"top",(t.contentHeight-t.containerHeight)*d),a(e),i.stopPropagation()}),t.settings.stopPropagationOnClick&&t.event.bind(t.scrollbarX,"click",i),t.event.bind(t.scrollbarXRail,"click",function(i){var o=r.toInt(t.scrollbarXWidth/2),l=t.railXRatio*(i.pageX-window.pageXOffset-n(t.scrollbarXRail).left-o),c=t.railXRatio*(t.railXWidth-t.scrollbarXWidth),d=l/c;0>d?d=0:d>1&&(d=1),s(e,"left",(t.contentWidth-t.containerWidth)*d-t.negativeScrollAdjustment),a(e),i.stopPropagation()})}var r=e("../../lib/helper"),o=e("../instances"),a=e("../update-geometry"),s=e("../update-scroll");t.exports=function(e){var t=o.get(e);i(e,t)}},{"../../lib/helper":6,"../instances":18,"../update-geometry":19,"../update-scroll":20}],11:[function(e,t,n){function i(e,t){function n(n){var r=i+n*t.railXRatio,o=Math.max(0,t.scrollbarXRail.getBoundingClientRect().left)+t.railXRatio*(t.railXWidth-t.scrollbarXWidth);0>r?t.scrollbarXLeft=0:r>o?t.scrollbarXLeft=o:t.scrollbarXLeft=r;var s=a.toInt(t.scrollbarXLeft*(t.contentWidth-t.containerWidth)/(t.containerWidth-t.railXRatio*t.scrollbarXWidth))-t.negativeScrollAdjustment;c(e,"left",s)}var i=null,r=null,s=function(t){n(t.pageX-r),l(e),t.stopPropagation(),t.preventDefault()},d=function(){a.stopScrolling(e,"x"),t.event.unbind(t.ownerDocument,"mousemove",s)};t.event.bind(t.scrollbarX,"mousedown",function(n){r=n.pageX,i=a.toInt(o.css(t.scrollbarX,"left"))*t.railXRatio,a.startScrolling(e,"x"),t.event.bind(t.ownerDocument,"mousemove",s),t.event.once(t.ownerDocument,"mouseup",d),n.stopPropagation(),n.preventDefault()})}function r(e,t){function n(n){var r=i+n*t.railYRatio,o=Math.max(0,t.scrollbarYRail.getBoundingClientRect().top)+t.railYRatio*(t.railYHeight-t.scrollbarYHeight);0>r?t.scrollbarYTop=0:r>o?t.scrollbarYTop=o:t.scrollbarYTop=r;var s=a.toInt(t.scrollbarYTop*(t.contentHeight-t.containerHeight)/(t.containerHeight-t.railYRatio*t.scrollbarYHeight));c(e,"top",s)}var i=null,r=null,s=function(t){n(t.pageY-r),l(e),t.stopPropagation(),t.preventDefault()},d=function(){a.stopScrolling(e,"y"),t.event.unbind(t.ownerDocument,"mousemove",s)};t.event.bind(t.scrollbarY,"mousedown",function(n){r=n.pageY,i=a.toInt(o.css(t.scrollbarY,"top"))*t.railYRatio,a.startScrolling(e,"y"),t.event.bind(t.ownerDocument,"mousemove",s),t.event.once(t.ownerDocument,"mouseup",d),n.stopPropagation(),n.preventDefault()})}var o=e("../../lib/dom"),a=e("../../lib/helper"),s=e("../instances"),l=e("../update-geometry"),c=e("../update-scroll");t.exports=function(e){var t=s.get(e);i(e,t),r(e,t)}},{"../../lib/dom":3,"../../lib/helper":6,"../instances":18,"../update-geometry":19,"../update-scroll":20}],12:[function(e,t,n){function i(e,t){function n(n,i){var r=e.scrollTop;if(0===n){if(!t.scrollbarYActive)return!1;if(0===r&&i>0||r>=t.contentHeight-t.containerHeight&&0>i)return!t.settings.wheelPropagation}var o=e.scrollLeft;if(0===i){if(!t.scrollbarXActive)return!1;if(0===o&&0>n||o>=t.contentWidth-t.containerWidth&&n>0)return!t.settings.wheelPropagation}return!0}var i=!1;t.event.bind(e,"mouseenter",function(){i=!0}),t.event.bind(e,"mouseleave",function(){i=!1});var a=!1;t.event.bind(t.ownerDocument,"keydown",function(c){if(!c.isDefaultPrevented||!c.isDefaultPrevented()){var d=o.matches(t.scrollbarX,":focus")||o.matches(t.scrollbarY,":focus");if(i||d){var u=document.activeElement?document.activeElement:t.ownerDocument.activeElement;if(u){for(;u.shadowRoot;)u=u.shadowRoot.activeElement;if(r.isEditable(u))return}var f=0,p=0;switch(c.which){case 37:f=-30;break;case 38:p=30;break;case 39:f=30;break;case 40:p=-30;break;case 33:p=90;break;case 32:p=c.shiftKey?90:-90;break;case 34:p=-90;break;case 35:p=c.ctrlKey?-t.contentHeight:-t.containerHeight;break;case 36:p=c.ctrlKey?e.scrollTop:t.containerHeight;break;default:return}l(e,"top",e.scrollTop-p),l(e,"left",e.scrollLeft+f),s(e),a=n(f,p),a&&c.preventDefault()}}})}var r=e("../../lib/helper"),o=e("../../lib/dom"),a=e("../instances"),s=e("../update-geometry"),l=e("../update-scroll");t.exports=function(e){var t=a.get(e);i(e,t)}},{"../../lib/dom":3,"../../lib/helper":6,"../instances":18,"../update-geometry":19,"../update-scroll":20}],13:[function(e,t,n){function i(e,t){function n(n,i){var r=e.scrollTop;if(0===n){if(!t.scrollbarYActive)return!1;if(0===r&&i>0||r>=t.contentHeight-t.containerHeight&&0>i)return!t.settings.wheelPropagation}var o=e.scrollLeft;if(0===i){if(!t.scrollbarXActive)return!1;if(0===o&&0>n||o>=t.contentWidth-t.containerWidth&&n>0)return!t.settings.wheelPropagation}return!0}function i(e){var t=e.deltaX,n=-1*e.deltaY;return("undefined"==typeof t||"undefined"==typeof n)&&(t=-1*e.wheelDeltaX/6,n=e.wheelDeltaY/6),e.deltaMode&&1===e.deltaMode&&(t*=10,n*=10),t!==t&&n!==n&&(t=0,n=e.wheelDelta),[t,n]}function r(t,n){var i=e.querySelector("textarea:hover");if(i){var r=i.scrollHeight-i.clientHeight;if(r>0&&!(0===i.scrollTop&&n>0||i.scrollTop===r&&0>n))return!0;var o=i.scrollLeft-i.clientWidth;if(o>0&&!(0===i.scrollLeft&&0>t||i.scrollLeft===o&&t>0))return!0}return!1}function s(s){var c=i(s),d=c[0],u=c[1];r(d,u)||(l=!1,t.settings.useBothWheelAxes?t.scrollbarYActive&&!t.scrollbarXActive?(u?a(e,"top",e.scrollTop-u*t.settings.wheelSpeed):a(e,"top",e.scrollTop+d*t.settings.wheelSpeed),l=!0):t.scrollbarXActive&&!t.scrollbarYActive&&(d?a(e,"left",e.scrollLeft+d*t.settings.wheelSpeed):a(e,"left",e.scrollLeft-u*t.settings.wheelSpeed),l=!0):(a(e,"top",e.scrollTop-u*t.settings.wheelSpeed),a(e,"left",e.scrollLeft+d*t.settings.wheelSpeed)),o(e),l=l||n(d,u),l&&(s.stopPropagation(),s.preventDefault()))}var l=!1;"undefined"!=typeof window.onwheel?t.event.bind(e,"wheel",s):"undefined"!=typeof window.onmousewheel&&t.event.bind(e,"mousewheel",s)}var r=e("../instances"),o=e("../update-geometry"),a=e("../update-scroll");t.exports=function(e){var t=r.get(e);i(e,t)}},{"../instances":18,"../update-geometry":19,"../update-scroll":20}],14:[function(e,t,n){function i(e,t){t.event.bind(e,"scroll",function(){o(e)})}var r=e("../instances"),o=e("../update-geometry");t.exports=function(e){var t=r.get(e);i(e,t)}},{"../instances":18,"../update-geometry":19}],15:[function(e,t,n){function i(e,t){function n(){var e=window.getSelection?window.getSelection():document.getSelection?document.getSelection():"";return 0===e.toString().length?null:e.getRangeAt(0).commonAncestorContainer}function i(){c||(c=setInterval(function(){return o.get(e)?(s(e,"top",e.scrollTop+d.top),s(e,"left",e.scrollLeft+d.left),void a(e)):void clearInterval(c)},50))}function l(){c&&(clearInterval(c),c=null),r.stopScrolling(e)}var c=null,d={top:0,left:0},u=!1;t.event.bind(t.ownerDocument,"selectionchange",function(){e.contains(n())?u=!0:(u=!1,l())}),t.event.bind(window,"mouseup",function(){u&&(u=!1,l())}),t.event.bind(window,"mousemove",function(t){if(u){var n={x:t.pageX,y:t.pageY},o={left:e.offsetLeft,right:e.offsetLeft+e.offsetWidth,top:e.offsetTop,bottom:e.offsetTop+e.offsetHeight};n.x<o.left+3?(d.left=-5,r.startScrolling(e,"x")):n.x>o.right-3?(d.left=5,r.startScrolling(e,"x")):d.left=0,n.y<o.top+3?(o.top+3-n.y<5?d.top=-5:d.top=-20,r.startScrolling(e,"y")):n.y>o.bottom-3?(n.y-o.bottom+3<5?d.top=5:d.top=20,r.startScrolling(e,"y")):d.top=0,0===d.top&&0===d.left?l():i()}})}var r=e("../../lib/helper"),o=e("../instances"),a=e("../update-geometry"),s=e("../update-scroll");t.exports=function(e){var t=o.get(e);i(e,t)}},{"../../lib/helper":6,"../instances":18,"../update-geometry":19,"../update-scroll":20}],16:[function(e,t,n){function i(e,t,n,i){function s(n,i){var r=e.scrollTop,o=e.scrollLeft,a=Math.abs(n),s=Math.abs(i);if(s>a){if(0>i&&r===t.contentHeight-t.containerHeight||i>0&&0===r)return!t.settings.swipePropagation}else if(a>s&&(0>n&&o===t.contentWidth-t.containerWidth||n>0&&0===o))return!t.settings.swipePropagation;return!0}function l(t,n){a(e,"top",e.scrollTop-n),a(e,"left",e.scrollLeft-t),o(e)}function c(){w=!0}function d(){w=!1}function u(e){return e.targetTouches?e.targetTouches[0]:e}function f(e){return e.targetTouches&&1===e.targetTouches.length?!0:!(!e.pointerType||"mouse"===e.pointerType||e.pointerType===e.MSPOINTER_TYPE_MOUSE)}function p(e){if(f(e)){_=!0;var t=u(e);m.pageX=t.pageX,m.pageY=t.pageY,v=(new Date).getTime(),null!==y&&clearInterval(y),e.stopPropagation()}}function h(e){if(!w&&_&&f(e)){var t=u(e),n={pageX:t.pageX,pageY:t.pageY},i=n.pageX-m.pageX,r=n.pageY-m.pageY;l(i,r),m=n;var o=(new Date).getTime(),a=o-v;a>0&&(b.x=i/a,b.y=r/a,v=o),s(i,r)&&(e.stopPropagation(),e.preventDefault())}}function g(){!w&&_&&(_=!1,clearInterval(y),y=setInterval(function(){return r.get(e)?Math.abs(b.x)<.01&&Math.abs(b.y)<.01?void clearInterval(y):(l(30*b.x,30*b.y),b.x*=.8,void(b.y*=.8)):void clearInterval(y)},10))}var m={},v=0,b={},y=null,w=!1,_=!1;n&&(t.event.bind(window,"touchstart",c),t.event.bind(window,"touchend",d),t.event.bind(e,"touchstart",p),t.event.bind(e,"touchmove",h),t.event.bind(e,"touchend",g)),i&&(window.PointerEvent?(t.event.bind(window,"pointerdown",c),t.event.bind(window,"pointerup",d),t.event.bind(e,"pointerdown",p),t.event.bind(e,"pointermove",h),t.event.bind(e,"pointerup",g)):window.MSPointerEvent&&(t.event.bind(window,"MSPointerDown",c),t.event.bind(window,"MSPointerUp",d),t.event.bind(e,"MSPointerDown",p),t.event.bind(e,"MSPointerMove",h),t.event.bind(e,"MSPointerUp",g)))}var r=e("../instances"),o=e("../update-geometry"),a=e("../update-scroll");t.exports=function(e,t,n){var o=r.get(e);i(e,o,t,n)}},{"../instances":18,"../update-geometry":19,"../update-scroll":20}],17:[function(e,t,n){var i=e("../lib/class"),r=e("../lib/helper"),o=e("./instances"),a=e("./update-geometry"),s=e("./handler/click-rail"),l=e("./handler/drag-scrollbar"),c=e("./handler/keyboard"),d=e("./handler/mouse-wheel"),u=e("./handler/native-scroll"),f=e("./handler/selection"),p=e("./handler/touch");t.exports=function(e,t){t="object"==typeof t?t:{},i.add(e,"ps-container");var n=o.add(e);n.settings=r.extend(n.settings,t),i.add(e,"ps-theme-"+n.settings.theme),s(e),l(e),d(e),u(e),n.settings.useSelectionScroll&&f(e),(r.env.supportsTouch||r.env.supportsIePointer)&&p(e,r.env.supportsTouch,r.env.supportsIePointer),n.settings.useKeyboard&&c(e),a(e)}},{"../lib/class":2,"../lib/helper":6,"./handler/click-rail":10,"./handler/drag-scrollbar":11,"./handler/keyboard":12,"./handler/mouse-wheel":13,"./handler/native-scroll":14,"./handler/selection":15,"./handler/touch":16,"./instances":18,"./update-geometry":19}],18:[function(e,t,n){function i(e){function t(){s.add(e,"ps-focus")}function n(){s.remove(e,"ps-focus")}var i=this;i.settings=f.clone(c),i.containerWidth=null,i.containerHeight=null,i.contentWidth=null,i.contentHeight=null,i.isRtl="rtl"===l.css(e,"direction"),i.isNegativeScroll=function(){var t=e.scrollLeft,n=null;return e.scrollLeft=-1,n=e.scrollLeft<0,e.scrollLeft=t,n}(),i.negativeScrollAdjustment=i.isNegativeScroll?e.scrollWidth-e.clientWidth:0,i.event=new d,i.ownerDocument=e.ownerDocument||document,i.scrollbarXRail=l.appendTo(l.e("div","ps-scrollbar-x-rail"),e),i.scrollbarX=l.appendTo(l.e("div","ps-scrollbar-x"),i.scrollbarXRail),i.scrollbarX.setAttribute("tabindex",0),i.event.bind(i.scrollbarX,"focus",t),i.event.bind(i.scrollbarX,"blur",n),i.scrollbarXActive=null,i.scrollbarXWidth=null,i.scrollbarXLeft=null,i.scrollbarXBottom=f.toInt(l.css(i.scrollbarXRail,"bottom")),i.isScrollbarXUsingBottom=i.scrollbarXBottom===i.scrollbarXBottom,i.scrollbarXTop=i.isScrollbarXUsingBottom?null:f.toInt(l.css(i.scrollbarXRail,"top")),i.railBorderXWidth=f.toInt(l.css(i.scrollbarXRail,"borderLeftWidth"))+f.toInt(l.css(i.scrollbarXRail,"borderRightWidth")),l.css(i.scrollbarXRail,"display","block"),i.railXMarginWidth=f.toInt(l.css(i.scrollbarXRail,"marginLeft"))+f.toInt(l.css(i.scrollbarXRail,"marginRight")),l.css(i.scrollbarXRail,"display",""),i.railXWidth=null,i.railXRatio=null,i.scrollbarYRail=l.appendTo(l.e("div","ps-scrollbar-y-rail"),e),i.scrollbarY=l.appendTo(l.e("div","ps-scrollbar-y"),i.scrollbarYRail),i.scrollbarY.setAttribute("tabindex",0),i.event.bind(i.scrollbarY,"focus",t),i.event.bind(i.scrollbarY,"blur",n),i.scrollbarYActive=null,i.scrollbarYHeight=null,i.scrollbarYTop=null,i.scrollbarYRight=f.toInt(l.css(i.scrollbarYRail,"right")),i.isScrollbarYUsingRight=i.scrollbarYRight===i.scrollbarYRight,i.scrollbarYLeft=i.isScrollbarYUsingRight?null:f.toInt(l.css(i.scrollbarYRail,"left")),i.scrollbarYOuterWidth=i.isRtl?f.outerWidth(i.scrollbarY):null,i.railBorderYWidth=f.toInt(l.css(i.scrollbarYRail,"borderTopWidth"))+f.toInt(l.css(i.scrollbarYRail,"borderBottomWidth")),l.css(i.scrollbarYRail,"display","block"),i.railYMarginHeight=f.toInt(l.css(i.scrollbarYRail,"marginTop"))+f.toInt(l.css(i.scrollbarYRail,"marginBottom")),l.css(i.scrollbarYRail,"display",""),i.railYHeight=null,i.railYRatio=null}function r(e){return"undefined"==typeof e.dataset?e.getAttribute("data-ps-id"):e.dataset.psId}function o(e,t){"undefined"==typeof e.dataset?e.setAttribute("data-ps-id",t):e.dataset.psId=t}function a(e){"undefined"==typeof e.dataset?e.removeAttribute("data-ps-id"):delete e.dataset.psId}var s=e("../lib/class"),l=e("../lib/dom"),c=e("./default-setting"),d=e("../lib/event-manager"),u=e("../lib/guid"),f=e("../lib/helper"),p={};n.add=function(e){var t=u();return o(e,t),p[t]=new i(e),p[t]},n.remove=function(e){delete p[r(e)],a(e)},n.get=function(e){return p[r(e)]}},{"../lib/class":2,"../lib/dom":3,"../lib/event-manager":4,"../lib/guid":5,"../lib/helper":6,"./default-setting":8}],19:[function(e,t,n){function i(e,t){return e.settings.minScrollbarLength&&(t=Math.max(t,e.settings.minScrollbarLength)),e.settings.maxScrollbarLength&&(t=Math.min(t,e.settings.maxScrollbarLength)),t}function r(e,t){var n={width:t.railXWidth};t.isRtl?n.left=t.negativeScrollAdjustment+e.scrollLeft+t.containerWidth-t.contentWidth:n.left=e.scrollLeft,t.isScrollbarXUsingBottom?n.bottom=t.scrollbarXBottom-e.scrollTop:n.top=t.scrollbarXTop+e.scrollTop,a.css(t.scrollbarXRail,n);var i={top:e.scrollTop,height:t.railYHeight};t.isScrollbarYUsingRight?t.isRtl?i.right=t.contentWidth-(t.negativeScrollAdjustment+e.scrollLeft)-t.scrollbarYRight-t.scrollbarYOuterWidth:i.right=t.scrollbarYRight-e.scrollLeft:t.isRtl?i.left=t.negativeScrollAdjustment+e.scrollLeft+2*t.containerWidth-t.contentWidth-t.scrollbarYLeft-t.scrollbarYOuterWidth:i.left=t.scrollbarYLeft+e.scrollLeft,a.css(t.scrollbarYRail,i),a.css(t.scrollbarX,{left:t.scrollbarXLeft,width:t.scrollbarXWidth-t.railBorderXWidth}),a.css(t.scrollbarY,{top:t.scrollbarYTop,height:t.scrollbarYHeight-t.railBorderYWidth})}var o=e("../lib/class"),a=e("../lib/dom"),s=e("../lib/helper"),l=e("./instances"),c=e("./update-scroll");t.exports=function(e){var t=l.get(e);t.containerWidth=e.clientWidth,t.containerHeight=e.clientHeight,t.contentWidth=e.scrollWidth,t.contentHeight=e.scrollHeight;var n;e.contains(t.scrollbarXRail)||(n=a.queryChildren(e,".ps-scrollbar-x-rail"),n.length>0&&n.forEach(function(e){a.remove(e)}),a.appendTo(t.scrollbarXRail,e)),e.contains(t.scrollbarYRail)||(n=a.queryChildren(e,".ps-scrollbar-y-rail"),n.length>0&&n.forEach(function(e){a.remove(e)}),a.appendTo(t.scrollbarYRail,e)),!t.settings.suppressScrollX&&t.containerWidth+t.settings.scrollXMarginOffset<t.contentWidth?(t.scrollbarXActive=!0,t.railXWidth=t.containerWidth-t.railXMarginWidth,t.railXRatio=t.containerWidth/t.railXWidth,t.scrollbarXWidth=i(t,s.toInt(t.railXWidth*t.containerWidth/t.contentWidth)),t.scrollbarXLeft=s.toInt((t.negativeScrollAdjustment+e.scrollLeft)*(t.railXWidth-t.scrollbarXWidth)/(t.contentWidth-t.containerWidth))):t.scrollbarXActive=!1,!t.settings.suppressScrollY&&t.containerHeight+t.settings.scrollYMarginOffset<t.contentHeight?(t.scrollbarYActive=!0,t.railYHeight=t.containerHeight-t.railYMarginHeight,t.railYRatio=t.containerHeight/t.railYHeight,t.scrollbarYHeight=i(t,s.toInt(t.railYHeight*t.containerHeight/t.contentHeight)),t.scrollbarYTop=s.toInt(e.scrollTop*(t.railYHeight-t.scrollbarYHeight)/(t.contentHeight-t.containerHeight))):t.scrollbarYActive=!1,t.scrollbarXLeft>=t.railXWidth-t.scrollbarXWidth&&(t.scrollbarXLeft=t.railXWidth-t.scrollbarXWidth),t.scrollbarYTop>=t.railYHeight-t.scrollbarYHeight&&(t.scrollbarYTop=t.railYHeight-t.scrollbarYHeight),r(e,t),t.scrollbarXActive?o.add(e,"ps-active-x"):(o.remove(e,"ps-active-x"),t.scrollbarXWidth=0,t.scrollbarXLeft=0,c(e,"left",0)),t.scrollbarYActive?o.add(e,"ps-active-y"):(o.remove(e,"ps-active-y"),t.scrollbarYHeight=0,t.scrollbarYTop=0,c(e,"top",0))}},{"../lib/class":2,"../lib/dom":3,"../lib/helper":6,"./instances":18,"./update-scroll":20}],20:[function(e,t,n){var i,r,o=e("./instances"),a=document.createEvent("Event"),s=document.createEvent("Event"),l=document.createEvent("Event"),c=document.createEvent("Event"),d=document.createEvent("Event"),u=document.createEvent("Event"),f=document.createEvent("Event"),p=document.createEvent("Event"),h=document.createEvent("Event"),g=document.createEvent("Event");a.initEvent("ps-scroll-up",!0,!0),s.initEvent("ps-scroll-down",!0,!0),l.initEvent("ps-scroll-left",!0,!0),c.initEvent("ps-scroll-right",!0,!0),d.initEvent("ps-scroll-y",!0,!0),u.initEvent("ps-scroll-x",!0,!0),f.initEvent("ps-x-reach-start",!0,!0),p.initEvent("ps-x-reach-end",!0,!0),h.initEvent("ps-y-reach-start",!0,!0),g.initEvent("ps-y-reach-end",!0,!0),t.exports=function(e,t,n){if("undefined"==typeof e)throw"You must provide an element to the update-scroll function";if("undefined"==typeof t)throw"You must provide an axis to the update-scroll function";if("undefined"==typeof n)throw"You must provide a value to the update-scroll function";"top"===t&&0>=n&&(e.scrollTop=n=0,e.dispatchEvent(h)),"left"===t&&0>=n&&(e.scrollLeft=n=0,e.dispatchEvent(f));var m=o.get(e);"top"===t&&n>=m.contentHeight-m.containerHeight&&(e.scrollTop=n=m.contentHeight-m.containerHeight,e.dispatchEvent(g)),"left"===t&&n>=m.contentWidth-m.containerWidth&&(e.scrollLeft=n=m.contentWidth-m.containerWidth,e.dispatchEvent(p)),i||(i=e.scrollTop),r||(r=e.scrollLeft),"top"===t&&i>n&&e.dispatchEvent(a),"top"===t&&n>i&&e.dispatchEvent(s),"left"===t&&r>n&&e.dispatchEvent(l),"left"===t&&n>r&&e.dispatchEvent(c),"top"===t&&(e.scrollTop=i=n,e.dispatchEvent(d)),"left"===t&&(e.scrollLeft=r=n,e.dispatchEvent(u))}},{"./instances":18}],21:[function(e,t,n){var i=e("../lib/dom"),r=e("../lib/helper"),o=e("./instances"),a=e("./update-geometry"),s=e("./update-scroll");t.exports=function(e){var t=o.get(e);t&&(t.negativeScrollAdjustment=t.isNegativeScroll?e.scrollWidth-e.clientWidth:0,i.css(t.scrollbarXRail,"display","block"),i.css(t.scrollbarYRail,"display","block"),t.railXMarginWidth=r.toInt(i.css(t.scrollbarXRail,"marginLeft"))+r.toInt(i.css(t.scrollbarXRail,"marginRight")),t.railYMarginHeight=r.toInt(i.css(t.scrollbarYRail,"marginTop"))+r.toInt(i.css(t.scrollbarYRail,"marginBottom")),i.css(t.scrollbarXRail,"display","none"),i.css(t.scrollbarYRail,"display","none"),a(e),s(e,"top",e.scrollTop),s(e,"left",e.scrollLeft),i.css(t.scrollbarXRail,"display",""),i.css(t.scrollbarYRail,"display",""))}},{"../lib/dom":3,"../lib/helper":6,"./instances":18,"./update-geometry":19,"./update-scroll":20}]},{},[1]),function(e){var t=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,n=e.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),i=n&&e.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),r=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,o=(n||r)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(e){var t,o,a,s,l,c;for(t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):decodeURIComponent(e.split(",")[1]),o=new ArrayBuffer(t.length),a=new Uint8Array(o),s=0;s<t.length;s+=1)a[s]=t.charCodeAt(s);return l=e.split(",")[0].split(":")[1].split(";")[0],n?new Blob([i?a:o],{type:l}):(c=new r,c.append(o),c.getBlob(l))};e.HTMLCanvasElement&&!t.toBlob&&(t.mozGetAsFile?t.toBlob=function(e,n,i){e(i&&t.toDataURL&&o?o(this.toDataURL(n,i)):this.mozGetAsFile("blob",n))}:t.toDataURL&&o&&(t.toBlob=function(e,t,n){e(o(this.toDataURL(t,n)))})),e.dataURLtoBlob=o}(window),function(e,t){function n(e,t,n,i,r){var o={type:n.type||n,target:e,result:i};J(o,r),t(o)}function i(e){return T&&!!T.prototype["readAs"+e]}function r(e,r,o,a){if(ne.isBlob(e)&&i(o)){var s=new T;Q(s,j,function t(i){var o=i.type;"progress"==o?n(e,r,i,i.target.result,{loaded:i.loaded,total:i.total}):"loadend"==o?(Z(s,j,t),s=null):n(e,r,i,i.target.result)});try{a?s["readAs"+o](e,a):s["readAs"+o](e)}catch(i){n(e,r,"error",t,{error:i.toString()})}}else n(e,r,"error",t,{error:"filreader_not_support_"+o})}function o(e,t){if(!e.type&&(w||e.size%4096===0&&e.size<=102400))if(T)try{var n=new T;V(n,j,function(e){var i="error"!=e.type;i?(null!=n.readyState&&n.readyState!==n.LOADING||n.abort(),t(i)):t(!1,n.error)}),n.readAsDataURL(e)}catch(e){t(!1,e)}else t(null,new Error("FileReader is not supported"));else t(!0)}function a(e){return e&&(e.isFile||e.isDirectory)}function s(e){var t;return e.getAsEntry?t=e.getAsEntry():e.webkitGetAsEntry&&(t=e.webkitGetAsEntry()),t}function l(e,t){if(e)if(e.isFile)e.file(function(n){n.fullPath=e.fullPath,t(!1,[n],[n])},function(n){e.error=n,t("FileError.code: "+n.code,[],[e])});else if(e.isDirectory){var n=e.createReader(),i=!0,r=[],o=[e],a=function(n){e.error=n,t("DirectoryError.code: "+n.code,r,o)},c=function s(c){i&&(i=!1,c.length||(e.error=new Error("directory is empty"))),c.length?ne.afor(c,function(e,t){l(t,function(t,i,l){t||(r=r.concat(i)),o=o.concat(l),e?e():n.readEntries(s,a)})}):t(!1,r,o)};n.readEntries(c,a)}else l(s(e),t);else{var d=new Error("invalid entry");e=new Object(e),e.error=d,t(d.message,[],[e])}}function c(e){var t={};return K(e,function(e,n){e&&"object"==typeof e&&void 0===e.nodeType&&(e=J({},e)),t[n]=e}),t}function d(e){return Y.test(e&&e.tagName)}function u(e){return(e.originalEvent||e||"").dataTransfer||{}}function f(e){var t;for(t in e)if(e.hasOwnProperty(t)&&!(e[t]instanceof Object||"overlay"===t||"filter"===t))return!0;return!1}var p,h,g=1,m=function(){},v=e.document,b=v.doctype||{},y=e.navigator.userAgent,w=/safari\//i.test(y)&&!/chrome\//i.test(y),_=/iemobile\//i.test(y),x=e.createObjectURL&&e||e.URL&&URL.revokeObjectURL&&URL||e.webkitURL&&webkitURL,A=e.Blob,E=e.File,T=e.FileReader,I=e.FormData,R=e.XMLHttpRequest,S=e.jQuery,C=!(!(E&&T&&(e.Uint8Array||I||R.prototype.sendAsBinary))||w&&/windows/i.test(y)&&!_),L=C&&"withCredentials"in new R,F=C&&!!A&&!!(A.prototype.webkitSlice||A.prototype.mozSlice||A.prototype.slice),k=(""+"".normalize).indexOf("[native code]")>0,X=e.dataURLtoBlob,H=/img/i,P=/canvas/i,D=/img|canvas/i,Y=/input/i,B=/^data:[^,]+,/,M={}.toString,W=e.Math,N=function(t){return t=new e.Number(W.pow(1024,t)),t.from=function(e){return W.round(e*this)},t},O={},z=[],j="abort progress error load loadend",q="status statusText readyState response responseXML responseText responseBody".split(" "),U="currentTarget",$="preventDefault",G=function(e){return e&&"length"in e},K=function(e,t,n){if(e)if(G(e))for(var i=0,r=e.length;r>i;i++)i in e&&t.call(n,e[i],i,e);else for(var o in e)e.hasOwnProperty(o)&&t.call(n,e[o],o,e)},J=function(e){for(var t=arguments,n=1,i=function(t,n){e[n]=t};n<t.length;n++)K(t[n],i);return e},Q=function(e,t,n){if(e){var i=ne.uid(e);O[i]||(O[i]={});var r=T&&e&&e instanceof T;K(t.split(/\s+/),function(t){S&&!r?S.event.add(e,t,n):(O[i][t]||(O[i][t]=[]),O[i][t].push(n),e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n)})}},Z=function(e,t,n){if(e){var i=ne.uid(e),r=O[i]||{},o=T&&e&&e instanceof T;K(t.split(/\s+/),function(t){if(S&&!o)S.event.remove(e,t,n);else{for(var i=r[t]||[],a=i.length;a--;)if(i[a]===n){i.splice(a,1);break}e.addEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=null}})}},V=function(e,t,n){Q(e,t,function i(r){Z(e,t,i),n(r)})},ee=function(t){return t.target||(t.target=e.event&&e.event.srcElement||v),3===t.target.nodeType&&(t.target=t.target.parentNode),t},te=function(e){var t=v.createElement("input");return t.setAttribute("type","file"),e in t},ne={version:"2.0.19",cors:!1,html5:!0,media:!1,formData:!0,multiPassResize:!0,debug:!1,pingUrl:!1,multiFlash:!1,flashAbortTimeout:0,withCredentials:!0,staticPath:"./dist/",flashUrl:0,flashImageUrl:0,postNameConcat:function(e,t){return e+(null!=t?"["+t+"]":"")},ext2mime:{jpg:"image/jpeg",tif:"image/tiff",txt:"text/plain"},accept:{"image/*":"art bm bmp dwg dxf cbr cbz fif fpx gif ico iefs jfif jpe jpeg jpg jps jut mcf nap nif pbm pcx pgm pict pm png pnm qif qtif ras rast rf rp svf tga tif tiff xbm xbm xpm xwd",
"audio/*":"m4a flac aac rm mpa wav wma ogg mp3 mp2 m3u mod amf dmf dsm far gdm imf it m15 med okt s3m stm sfx ult uni xm sid ac3 dts cue aif aiff wpl ape mac mpc mpp shn wv nsf spc gym adplug adx dsp adp ymf ast afc hps xs","video/*":"m4v 3gp nsv ts ty strm rm rmvb m3u ifo mov qt divx xvid bivx vob nrg img iso pva wmv asf asx ogm m2v avi bin dat dvr-ms mpg mpeg mp4 mkv avc vp3 svq3 nuv viv dv fli flv wpl"},uploadRetry:0,networkDownRetryTimeout:5e3,chunkSize:0,chunkUploadRetry:0,chunkNetworkDownRetryTimeout:2e3,KB:N(1),MB:N(2),GB:N(3),TB:N(4),EMPTY_PNG:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2NkAAIAAAoAAggA9GkAAAAASUVORK5CYII=",expando:"fileapi"+(new Date).getTime(),uid:function(e){return e?e[ne.expando]=e[ne.expando]||ne.uid():(++g,ne.expando+g)},log:function(){ne.debug&&p&&(h?console.log.apply(console,arguments):console.log([].join.call(arguments," ")))},newImage:function(e,t){var n=v.createElement("img");return t&&ne.event.one(n,"error load",function(e){t("error"==e.type,n),n=null}),n.src=e,n},getXHR:function(){var t;if(R)t=new R;else if(e.ActiveXObject)try{t=new ActiveXObject("MSXML2.XMLHttp.3.0")}catch(e){t=new ActiveXObject("Microsoft.XMLHTTP")}return t},isArray:G,support:{dnd:L&&"ondrop"in v.createElement("div"),cors:L,html5:C,chunked:F,dataURI:!0,accept:te("accept"),multiple:te("multiple")},event:{on:Q,off:Z,one:V,fix:ee},throttle:function(t,n){var i,r;return function(){r=arguments,i||(t.apply(e,r),i=setTimeout(function(){i=0,t.apply(e,r)},n))}},F:function(){},parseJSON:function(t){var n;return n=e.JSON&&JSON.parse?JSON.parse(t):new Function("return ("+t.replace(/([\r\n])/g,"\\$1")+");")()},trim:function(e){return e=String(e),e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},defer:function(){var e,n,i=[],r={resolve:function(t,o){for(r.resolve=m,n=t||!1,e=o;o=i.shift();)o(n,e)},then:function(r){n!==t?r(n,e):i.push(r)}};return r},queue:function(e){var t=0,n=0,i=!1,r=!1,o={inc:function(){n++},next:function(){t++,setTimeout(o.check,0)},check:function(){t>=n&&!i&&o.end()},isFail:function(){return i},fail:function(){!i&&e(i=!0)},end:function(){r||(r=!0,e())}};return o},each:K,afor:function(e,t){var n=0,i=e.length;G(e)&&i--?!function r(){t(i!=n&&r,e[n],n++)}():t(!1)},extend:J,isFile:function(e){return"[object File]"===M.call(e)},isBlob:function(e){return this.isFile(e)||"[object Blob]"===M.call(e)},isCanvas:function(e){return e&&P.test(e.nodeName)},getFilesFilter:function(e){return e="string"==typeof e?e:e.getAttribute&&e.getAttribute("accept")||"",e?new RegExp("("+e.replace(/\./g,"\\.").replace(/,/g,"|")+")$","i"):/./},readAsDataURL:function(e,t){ne.isCanvas(e)?n(e,t,"load",ne.toDataURL(e)):r(e,t,"DataURL")},readAsBinaryString:function(e,t){i("BinaryString")?r(e,t,"BinaryString"):r(e,function(e){if("load"==e.type)try{e.result=ne.toBinaryString(e.result)}catch(t){e.type="error",e.message=t.toString()}t(e)},"DataURL")},readAsArrayBuffer:function(e,t){r(e,t,"ArrayBuffer")},readAsText:function(e,t,n){n||(n=t,t="utf-8"),r(e,n,"Text",t)},toDataURL:function(e,t){return"string"==typeof e?e:e.toDataURL?e.toDataURL(t||"image/png"):void 0},toBinaryString:function(t){return e.atob(ne.toDataURL(t).replace(B,""))},readAsImage:function(e,i,r){if(ne.isBlob(e))if(x){var o=x.createObjectURL(e);o===t?n(e,i,"error"):ne.readAsImage(o,i,r)}else ne.readAsDataURL(e,function(t){"load"==t.type?ne.readAsImage(t.result,i,r):(r||"error"==t.type)&&n(e,i,t,null,{loaded:t.loaded,total:t.total})});else if(ne.isCanvas(e))n(e,i,"load",e);else if(H.test(e.nodeName))if(e.complete)n(e,i,"load",e);else{var a="error abort load";V(e,a,function t(r){"load"==r.type&&x&&x.revokeObjectURL(e.src),Z(e,a,t),n(e,i,r,e)})}else if(e.iframe)n(e,i,{type:"error"});else{var s=ne.newImage(e.dataURL||e);ne.readAsImage(s,i,r)}},checkFileObj:function(e){var t={},n=ne.accept;return"object"==typeof e?t=e:t.name=(e+"").split(/\\|\//g).pop(),null==t.type&&(t.type=t.name.split(".").pop()),K(n,function(e,n){e=new RegExp(e.replace(/\s/g,"|"),"i"),(e.test(t.type)||ne.ext2mime[t.type])&&(t.type=ne.ext2mime[t.type]||n.split("/")[0]+"/"+t.type)}),t},getDropFiles:function(e,t){var n,i=[],r=[],c=u(e),d=c.files,f=c.items,p=G(f)&&f[0]&&s(f[0]),h=ne.queue(function(){t(i,r)});if(p)if(k&&d){var g,m,v=d.length;for(n=new Array(v);v--;){g=d[v];try{m=s(f[v])}catch(e){ne.log("[err] getDropFiles: ",e),m=null}a(m)&&(m.isDirectory||m.isFile&&g.name==g.name.normalize("NFC"))?n[v]=m:n[v]=g}}else n=f;else n=d;K(n||[],function(e){h.inc();try{p&&a(e)?l(e,function(e,t,n){e?ne.log("[err] getDropFiles:",e):i.push.apply(i,t),r.push.apply(r,n),h.next()}):o(e,function(t,n){t?i.push(e):e.error=n,r.push(e),h.next()})}catch(e){h.next(),ne.log("[err] getDropFiles: ",e)}}),h.check()},getFiles:function(e,t,n){var i=[];return n?(ne.filterFiles(ne.getFiles(e),t,n),null):(e.jquery&&(e.each(function(){i=i.concat(ne.getFiles(this))}),e=i,i=[]),"string"==typeof t&&(t=ne.getFilesFilter(t)),e.originalEvent?e=ee(e.originalEvent):e.srcElement&&(e=ee(e)),e.dataTransfer?e=e.dataTransfer:e.target&&(e=e.target),e.files?(i=e.files,C||(i[0].blob=e,i[0].iframe=!0)):!C&&d(e)?ne.trim(e.value)&&(i=[ne.checkFileObj(e.value)],i[0].blob=e,i[0].iframe=!0):G(e)&&(i=e),ne.filter(i,function(e){return!t||t.test(e.name)}))},getTotalSize:function(e){for(var t=0,n=e&&e.length;n--;)t+=e[n].size;return t},getInfo:function(e,t){var n={},i=z.concat();ne.isBlob(e)?!function r(){var o=i.shift();o?o.test(e.type)?o(e,function(e,i){e?t(e):(J(n,i),r())}):r():t(!1,n)}():t("not_support_info",n)},addInfoReader:function(e,t){t.test=function(t){return e.test(t)},z.push(t)},filter:function(e,t){for(var n,i=[],r=0,o=e.length;o>r;r++)r in e&&(n=e[r],t.call(n,n,r,e)&&i.push(n));return i},filterFiles:function(e,t,n){if(e.length){var i,r=e.concat(),o=[],a=[];!function e(){r.length?(i=r.shift(),ne.getInfo(i,function(n,r){(t(i,n?!1:r)?o:a).push(i),e()})):n(o,a)}()}else n([],e)},upload:function(e){e=J({jsonp:"callback",prepare:ne.F,beforeupload:ne.F,upload:ne.F,fileupload:ne.F,fileprogress:ne.F,filecomplete:ne.F,progress:ne.F,complete:ne.F,pause:ne.F,imageOriginal:!0,chunkSize:ne.chunkSize,chunkUploadRetry:ne.chunkUploadRetry,uploadRetry:ne.uploadRetry},e),e.imageAutoOrientation&&!e.imageTransform&&(e.imageTransform={rotate:"auto"});var t,n=new ne.XHR(e),i=this._getFilesDataArray(e.files),r=this,o=0,a=0,s=!1;return K(i,function(e){o+=e.size}),n.files=[],K(i,function(e){n.files.push(e.file)}),n.total=o,n.loaded=0,n.filesLeft=i.length,e.beforeupload(n,e),t=function(){var l=i.shift(),d=l&&l.file,u=!1,f=c(e);if(n.filesLeft=i.length,d&&d.name===ne.expando&&(d=null,ne.log("[warn] FileAPI.upload() — called without files")),("abort"!=n.statusText||n.current)&&l){if(s=!1,n.currentFile=d,d&&e.prepare(d,f)===!1)return void t.call(r);f.file=d,r._getFormData(f,l,function(s){a||e.upload(n,e);var c=new ne.XHR(J({},f,{upload:d?function(){e.fileupload(d,c,f)}:m,progress:d?function(t){u||(u=t.loaded===t.total,e.fileprogress({type:"progress",total:l.total=t.total,loaded:l.loaded=t.loaded},d,c,f),e.progress({type:"progress",total:o,loaded:n.loaded=a+l.size*(t.loaded/t.total)||0},d,c,f))}:m,complete:function(i){K(q,function(e){n[e]=c[e]}),d&&(l.total=l.total||l.size,l.loaded=l.total,i||(this.progress(l),u=!0,a+=l.size,n.loaded=a),e.filecomplete(i,c,d,f)),setTimeout(function(){t.call(r)},0)}}));n.abort=function(e){e||(i.length=0),this.current=e,c.abort()},c.send(s)})}else{var p=200==n.status||201==n.status||204==n.status;e.complete(p?!1:n.statusText||"error",n,e),s=!0}},setTimeout(t,0),n.append=function(e,a){e=ne._getFilesDataArray([].concat(e)),K(e,function(e){o+=e.size,n.files.push(e.file),a?i.unshift(e):i.push(e)}),n.statusText="",s&&t.call(r)},n.remove=function(e){for(var t,n=i.length;n--;)i[n].file==e&&(t=i.splice(n,1),o-=t.size);return t},n},_getFilesDataArray:function(e){var t=[],n={};if(d(e)){var i=ne.getFiles(e);n[e.name||"file"]=null!==e.getAttribute("multiple")?i:i[0]}else G(e)&&d(e[0])?K(e,function(e){n[e.name||"file"]=ne.getFiles(e)}):n=e;return K(n,function e(n,i){G(n)?K(n,function(t){e(t,i)}):n&&(n.name||n.image)&&t.push({name:i,file:n,size:n.size,total:n.size,loaded:0})}),t.length||t.push({file:{name:ne.expando}}),t},_getFormData:function(e,t,n){var i=t.file,r=t.name,o=i.name,a=i.type,s=ne.support.transform&&e.imageTransform,l=new ne.Form,c=ne.queue(function(){n(l)}),d=s&&f(s),u=ne.postNameConcat;K(e.data,function e(t,n){"object"==typeof t?K(t,function(t,i){e(t,u(n,i))}):l.append(n,t)}),function t(n){n.image?(c.inc(),n.toData(function(e,i){n.file&&(i.type=n.file.type,i.quality=n.matrix.quality,o=n.file&&n.file.name),o=o||(new Date).getTime()+".png",t(i),c.next()})):ne.Image&&s&&(/^image/.test(n.type)||D.test(n.nodeName))?(c.inc(),d&&(s=[s]),ne.Image.transform(n,s,e.imageAutoOrientation,function(t,i){if(d&&!t)X||ne.flashEngine||(l.multipart=!0),l.append(r,i[0],o,s[0].type||a);else{var f=0;t||K(i,function(e,t){X||ne.flashEngine||(l.multipart=!0),s[t].postName||(f=1),l.append(s[t].postName||u(r,t),e,o,s[t].type||a)}),(t||e.imageOriginal)&&l.append(u(r,f?"original":null),n,o,a)}c.next()})):o!==ne.expando&&l.append(r,n,o)}(i),c.check()},reset:function(e,t){var n,i;return S?(i=S(e).clone(!0).insertBefore(e).val("")[0],t||S(e).remove()):(n=e.parentNode,i=n.insertBefore(e.cloneNode(!0),e),i.value="",t||n.removeChild(e),K(O[ne.uid(e)],function(t,n){K(t,function(t){Z(e,n,t),Q(i,n,t)})})),i},load:function(e,t){var n=ne.getXHR();return n?(n.open("GET",e,!0),n.overrideMimeType&&n.overrideMimeType("text/plain; charset=x-user-defined"),Q(n,"progress",function(e){e.lengthComputable&&t({type:e.type,loaded:e.loaded,total:e.total},n)}),n.onreadystatechange=function(){if(4==n.readyState)if(n.onreadystatechange=null,200==n.status){e=e.split("/");var i={name:e[e.length-1],size:n.getResponseHeader("Content-Length"),type:n.getResponseHeader("Content-Type")};i.dataURL="data:"+i.type+";base64,"+ne.encode64(n.responseBody||n.responseText),t({type:"load",result:i},n)}else t({type:"error"},n)},n.send(null)):t({type:"error"}),n},encode64:function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="",i=0;for("string"!=typeof e&&(e=String(e));i<e.length;){var r,o,a=255&e.charCodeAt(i++),s=255&e.charCodeAt(i++),l=255&e.charCodeAt(i++),c=a>>2,d=(3&a)<<4|s>>4;isNaN(s)?r=o=64:(r=(15&s)<<2|l>>6,o=isNaN(l)?64:63&l),n+=t.charAt(c)+t.charAt(d)+t.charAt(r)+t.charAt(o)}return n}};ne.addInfoReader(/^image/,function(e,t){if(!e.__dimensions){var n=e.__dimensions=ne.defer();ne.readAsImage(e,function(e){var t=e.target;n.resolve("load"==e.type?!1:"error",{width:t.width,height:t.height}),t.src=ne.EMPTY_PNG,t=null})}e.__dimensions.then(t)}),ne.event.dnd=function(e,t,n){var i,r;n||(n=t,t=ne.F),T?(Q(e,"dragenter dragleave dragover",t.ff=t.ff||function(e){for(var n=u(e).types,o=n&&n.length,a=!1;o--;)if(~n[o].indexOf("File")){e[$](),r!==e.type&&(r=e.type,"dragleave"!=r&&t.call(e[U],!0,e),a=!0);break}a&&(clearTimeout(i),i=setTimeout(function(){t.call(e[U],"dragleave"!=r,e)},50))}),Q(e,"drop",n.ff=n.ff||function(e){e[$](),r=0,t.call(e[U],!1,e),ne.getDropFiles(e,function(t,i){n.call(e[U],t,i,e)})})):ne.log("Drag'n'Drop -- not supported")},ne.event.dnd.off=function(e,t,n){Z(e,"dragenter dragleave dragover",t.ff),Z(e,"drop",n.ff)},S&&!S.fn.dnd&&(S.fn.dnd=function(e,t){return this.each(function(){ne.event.dnd(this,e,t)})},S.fn.offdnd=function(e,t){return this.each(function(){ne.event.dnd.off(this,e,t)})}),e.FileAPI=J(ne,e.FileAPI),ne.log("FileAPI: "+ne.version),ne.log("protocol: "+e.location.protocol),ne.log("doctype: ["+b.name+"] "+b.publicId+" "+b.systemId),K(v.getElementsByTagName("meta"),function(e){/x-ua-compatible/i.test(e.getAttribute("http-equiv"))&&ne.log("meta.http-equiv: "+e.getAttribute("content"))});try{p=!!console.log,h=!!console.log.apply}catch(e){}ne.flashUrl||(ne.flashUrl=ne.staticPath+"FileAPI.flash.swf"),ne.flashImageUrl||(ne.flashImageUrl=ne.staticPath+"FileAPI.flash.image.swf"),ne.flashWebcamUrl||(ne.flashWebcamUrl=ne.staticPath+"FileAPI.flash.camera.swf")}(window,void 0),function(e,t,n){function i(t){if(t instanceof i){var n=new i(t.file);return e.extend(n.matrix,t.matrix),n}return this instanceof i?(this.file=t,this.size=t.size||100,void(this.matrix={sx:0,sy:0,sw:0,sh:0,dx:0,dy:0,dw:0,dh:0,resize:0,deg:0,quality:1,filter:0})):new i(t)}var r=Math.min,o=Math.round,a=function(){return t.createElement("canvas")},s=!1,l={8:270,3:180,6:90,7:270,4:180,5:90};try{s=a().toDataURL("image/png").indexOf("data:image/png")>-1}catch(e){}i.prototype={image:!0,constructor:i,set:function(t){return e.extend(this.matrix,t),this},crop:function(e,t,i,r){return i===n&&(i=e,r=t,e=t=0),this.set({sx:e,sy:t,sw:i,sh:r||i})},resize:function(e,t,n){return/min|max|height|width/.test(t)&&(n=t,t=e),this.set({dw:e,dh:t||e,resize:n})},preview:function(e,t){return this.resize(e,t||e,"preview")},rotate:function(e){return this.set({deg:e})},filter:function(e){return this.set({filter:e})},overlay:function(e){return this.set({overlay:e})},clone:function(){return new i(this)},_load:function(t,n){var i=this;/img|video/i.test(t.nodeName)?n.call(i,null,t):e.readAsImage(t,function(e){n.call(i,"load"!=e.type,e.result)})},_apply:function(t,n){var o,s=a(),l=this.getMatrix(t),c=s.getContext("2d"),d=t.videoWidth||t.width,u=t.videoHeight||t.height,f=l.deg,p=l.dw,h=l.dh,g=d,m=u,v=l.filter,b=t,y=l.overlay,w=e.queue(function(){t.src=e.EMPTY_PNG,n(!1,s)}),_=e.renderImageToCanvas;for(f-=360*Math.floor(f/360),t._type=this.file.type;l.multipass&&r(g/p,m/h)>2;)g=g/2+.5|0,m=m/2+.5|0,o=a(),o.width=g,o.height=m,b!==t?(_(o,b,0,0,b.width,b.height,0,0,g,m),b=o):(b=o,_(b,t,l.sx,l.sy,l.sw,l.sh,0,0,g,m),l.sx=l.sy=l.sw=l.sh=0);s.width=f%180?h:p,s.height=f%180?p:h,s.type=l.type,s.quality=l.quality,c.rotate(f*Math.PI/180),_(c.canvas,b,l.sx,l.sy,l.sw||b.width,l.sh||b.height,180==f||270==f?-p:0,90==f||180==f?-h:0,p,h),p=s.width,h=s.height,y&&e.each([].concat(y),function(t){w.inc();var n=new window.Image,i=function(){var r=0|t.x,o=0|t.y,a=t.w||n.width,s=t.h||n.height,l=t.rel;r=1==l||4==l||7==l?(p-a+r)/2:2==l||5==l||8==l?p-(a+r):r,o=3==l||4==l||5==l?(h-s+o)/2:l>=6?h-(s+o):o,e.event.off(n,"error load abort",i);try{c.globalAlpha=t.opacity||1,c.drawImage(n,r,o,a,s)}catch(e){}w.next()};e.event.on(n,"error load abort",i),n.src=t.src,n.complete&&i()}),v&&(w.inc(),i.applyFilter(s,v,w.next)),w.check()},getMatrix:function(t){var n=e.extend({},this.matrix),i=n.sw=n.sw||t.videoWidth||t.naturalWidth||t.width,a=n.sh=n.sh||t.videoHeight||t.naturalHeight||t.height,s=n.dw=n.dw||i,l=n.dh=n.dh||a,c=i/a,d=s/l,u=n.resize;if("preview"==u){if(s!=i||l!=a){var f,p;d>=c?(f=i,p=f/d):(p=a,f=p*d),f==i&&p==a||(n.sx=~~((i-f)/2),n.sy=~~((a-p)/2),i=f,a=p)}}else"height"==u?s=l*c:"width"==u?l=s/c:u&&(i>s||a>l?"min"==u?(s=o(d>c?r(i,s):l*c),l=o(d>c?s/c:r(a,l))):(s=o(c>=d?r(i,s):l*c),l=o(c>=d?s/c:r(a,l))):(s=i,l=a));return n.sw=i,n.sh=a,n.dw=s,n.dh=l,n.multipass=e.multiPassResize,n},_trans:function(t){this._load(this.file,function(n,i){if(n)t(n);else try{this._apply(i,t)}catch(n){e.log("[err] FileAPI.Image.fn._apply:",n),t(n)}})},get:function(t){if(e.support.transform){var n=this,i=n.matrix;"auto"==i.deg?e.getInfo(n.file,function(e,r){i.deg=l[r&&r.exif&&r.exif.Orientation]||0,n._trans(t)}):n._trans(t)}else t("not_support_transform");return this},toData:function(e){return this.get(e)}},i.exifOrientation=l,i.transform=function(t,r,o,a){function s(s,l){var c={},d=e.queue(function(e){a(e,c)});s?d.fail():e.each(r,function(e,r){if(!d.isFail()){var a=new i(l.nodeType?l:t),s="function"==typeof e;if(s?e(l,a):e.width?a[e.preview?"preview":"resize"](e.width,e.height,e.strategy):e.maxWidth&&(l.width>e.maxWidth||l.height>e.maxHeight)&&a.resize(e.maxWidth,e.maxHeight,"max"),e.crop){var u=e.crop;a.crop(0|u.x,0|u.y,u.w||u.width,u.h||u.height)}e.rotate===n&&o&&(e.rotate="auto"),a.set({type:a.matrix.type||e.type||t.type||"image/png"}),s||a.set({deg:e.rotate,overlay:e.overlay,filter:e.filter,quality:e.quality||1}),d.inc(),a.toData(function(e,t){e?d.fail():(c[r]=t,d.next())})}})}t.width?s(!1,t):e.getInfo(t,s)},e.each(["TOP","CENTER","BOTTOM"],function(t,n){e.each(["LEFT","CENTER","RIGHT"],function(e,r){i[t+"_"+e]=3*n+r,i[e+"_"+t]=3*n+r})}),i.toCanvas=function(e){var n=t.createElement("canvas");return n.width=e.videoWidth||e.width,n.height=e.videoHeight||e.height,n.getContext("2d").drawImage(e,0,0),n},i.fromDataURL=function(t,n,i){var r=e.newImage(t);e.extend(r,n),i(r)},i.applyFilter=function(t,n,r){"function"==typeof n?n(t,r):window.Caman&&window.Caman("IMG"==t.tagName?i.toCanvas(t):t,function(){"string"==typeof n?this[n]():e.each(n,function(e,t){this[t](e)},this),this.render(r)})},e.renderImageToCanvas=function(t,n,i,r,o,a,s,l,c,d){try{return t.getContext("2d").drawImage(n,i,r,o,a,s,l,c,d)}catch(t){throw e.log("renderImageToCanvas failed"),t}},e.support.canvas=e.support.transform=s,e.Image=i}(FileAPI,document),function(e,t){function n(t,n,i){var r=t.blob,o=t.file;if(o){if(!r.toDataURL)return void e.readAsBinaryString(r,function(e){"load"==e.type&&n(t,e.result)});var a={"image/jpeg":".jpe?g","image/png":".png"},s=a[t.type]?t.type:"image/png",l=a[s]||".png",c=r.quality||1;o.match(new RegExp(l+"$","i"))||(o+=l.replace("?","")),t.file=o,t.type=s,!i&&r.toBlob?r.toBlob(function(e){n(t,e)},s,c):n(t,e.toBinaryString(r.toDataURL(s,c)))}else n(t,r)}var i=t.document,r=t.FormData,o=function(){this.items=[]},a=t.encodeURIComponent;o.prototype={append:function(e,t,n,i){this.items.push({name:e,blob:t&&t.blob||(void 0==t?"":t),file:t&&(n||t.name),type:t&&(i||t.type)})},each:function(e){for(var t=0,n=this.items.length;n>t;t++)e.call(this,this.items[t])},toData:function(t,n){n._chunked=e.support.chunked&&n.chunkSize>0&&1==e.filter(this.items,function(e){return e.file}).length,e.support.html5?e.formData&&!this.multipart&&r?n._chunked?(e.log("FileAPI.Form.toPlainData"),this.toPlainData(t)):(e.log("FileAPI.Form.toFormData"),this.toFormData(t)):(e.log("FileAPI.Form.toMultipartData"),this.toMultipartData(t)):(e.log("FileAPI.Form.toHtmlData"),this.toHtmlData(t))},_to:function(t,n,i,r){var o=e.queue(function(){n(t)});this.each(function(a){try{i(a,t,o,r)}catch(t){e.log("FileAPI.Form._to: "+t.message),n(t)}}),o.check()},toHtmlData:function(t){this._to(i.createDocumentFragment(),t,function(t,n){var r,o=t.blob;t.file?(e.reset(o,!0),o.name=t.name,o.disabled=!1,n.appendChild(o)):(r=i.createElement("input"),r.name=t.name,r.type="hidden",r.value=o,n.appendChild(r))})},toPlainData:function(e){this._to({},e,function(e,t,i){e.file&&(t.type=e.file),e.blob.toBlob?(i.inc(),n(e,function(e,n){t.name=e.name,t.file=n,t.size=n.length,t.type=e.type,i.next()})):e.file?(t.name=e.blob.name,t.file=e.blob,t.size=e.blob.size,t.type=e.type):(t.params||(t.params=[]),t.params.push(a(e.name)+"="+a(e.blob))),t.start=-1,t.end=t.file&&t.file.FileAPIReadPosition||-1,t.retry=0})},toFormData:function(e){this._to(new r,e,function(e,t,i){e.blob&&e.blob.toBlob?(i.inc(),n(e,function(e,n){t.append(e.name,n,e.file),i.next()})):e.file?t.append(e.name,e.blob,e.file):t.append(e.name,e.blob),e.file&&t.append("_"+e.name,e.file)})},toMultipartData:function(t){this._to([],t,function(e,t,i,r){i.inc(),n(e,function(e,n){t.push("--_"+r+('\r\nContent-Disposition: form-data; name="'+e.name+'"'+(e.file?'; filename="'+a(e.file)+'"':"")+(e.file?"\r\nContent-Type: "+(e.type||"application/octet-stream"):"")+"\r\n\r\n"+(e.file?n:a(n))+"\r\n")),i.next()},!0)},e.expando)}},e.Form=o}(FileAPI,window),function(e,t){var n=function(){},i=e.document,r=function(e){this.uid=t.uid(),this.xhr={abort:n,getResponseHeader:n,getAllResponseHeaders:n},this.options=e},o={"":1,XML:1,Text:1,Body:1};r.prototype={status:0,statusText:"",constructor:r,getResponseHeader:function(e){return this.xhr.getResponseHeader(e)},getAllResponseHeaders:function(){return this.xhr.getAllResponseHeaders()||{}},end:function(i,r){var o=this,a=o.options;o.end=o.abort=n,o.status=i,r&&(o.statusText=r),t.log("xhr.end:",i,r),a.complete(200==i||201==i?!1:o.statusText||"unknown",o),o.xhr&&o.xhr.node&&setTimeout(function(){var t=o.xhr.node;try{t.parentNode.removeChild(t)}catch(e){}try{delete e[o.uid]}catch(e){}e[o.uid]=o.xhr.node=null},9)},abort:function(){this.end(0,"abort"),this.xhr&&(this.xhr.aborted=!0,this.xhr.abort())},send:function(e){var t=this,n=this.options;e.toData(function(e){e instanceof Error?t.end(0,e.message):(n.upload(n,t),t._send.call(t,n,e))},n)},_send:function(n,r){var a,s=this,l=s.uid,c=s.uid+"Load",d=n.url;if(t.log("XHR._send:",r),n.cache||(d+=(~d.indexOf("?")?"&":"?")+t.uid()),r.nodeName){var u=n.jsonp;d=d.replace(/([a-z]+)=(\?)/i,"$1="+l),n.upload(n,s);var f=function(e){if(~d.indexOf(e.origin))try{var n=t.parseJSON(e.data);n.id==l&&p(n.status,n.statusText,n.response)}catch(e){p(0,e.message)}},p=e[l]=function(n,i,r){s.readyState=4,s.responseText=r,s.end(n,i),t.event.off(e,"message",f),e[l]=a=g=e[c]=null};s.xhr.abort=function(){try{g.stop?g.stop():g.contentWindow.stop?g.contentWindow.stop():g.contentWindow.document.execCommand("Stop")}catch(e){}p(0,"abort")},t.event.on(e,"message",f),e[c]=function(){try{var e=g.contentWindow,n=e.document,i=e.result||t.parseJSON(n.body.innerHTML);p(i.status,i.statusText,i.response)}catch(e){t.log("[transport.onload]",e)}},a=i.createElement("div"),a.innerHTML='<form target="'+l+'" action="'+d+'" method="POST" enctype="multipart/form-data" style="position: absolute; top: -1000px; overflow: hidden; width: 1px; height: 1px;"><iframe name="'+l+'" src="javascript:false;" onload="window.'+c+" && "+c+'();"></iframe>'+(u&&n.url.indexOf("=?")<0?'<input value="'+l+'" name="'+u+'" type="hidden"/>':"")+"</form>";var h=a.getElementsByTagName("form")[0],g=a.getElementsByTagName("iframe")[0];h.appendChild(r),t.log(h.parentNode.innerHTML),i.body.appendChild(a),s.xhr.node=a,s.readyState=2;try{h.submit()}catch(e){t.log("iframe.error: "+e)}h=null}else{if(d=d.replace(/([a-z]+)=(\?)&?/i,""),this.xhr&&this.xhr.aborted)return void t.log("Error: already aborted");if(a=s.xhr=t.getXHR(),r.params&&(d+=(d.indexOf("?")<0?"?":"&")+r.params.join("&")),a.open("POST",d,!0),t.withCredentials&&(a.withCredentials="true"),n.headers&&n.headers["X-Requested-With"]||a.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.each(n.headers,function(e,t){a.setRequestHeader(t,e)}),n._chunked){a.upload&&a.upload.addEventListener("progress",t.throttle(function(e){r.retry||n.progress({type:e.type,total:r.size,loaded:r.start+e.loaded,totalSize:r.size},s,n)},100),!1),a.onreadystatechange=function(){var e=parseInt(a.getResponseHeader("X-Last-Known-Byte"),10);if(s.status=a.status,s.statusText=a.statusText,s.readyState=a.readyState,4==a.readyState){for(var i in o)s["response"+i]=a["response"+i];if(a.onreadystatechange=null,!a.status||a.status-201>0)if(t.log("Error: "+a.status),(!a.status&&!a.aborted||500==a.status||416==a.status)&&++r.retry<=n.chunkUploadRetry){var l=a.status?0:t.chunkNetworkDownRetryTimeout;n.pause(r.file,n),t.log("X-Last-Known-Byte: "+e),e?r.end=e:(r.end=r.start-1,416==a.status&&(r.end=r.end-n.chunkSize)),setTimeout(function(){s._send(n,r)},l)}else s.end(a.status);else r.retry=0,r.end==r.size-1?s.end(a.status):(t.log("X-Last-Known-Byte: "+e),e&&(r.end=e),r.file.FileAPIReadPosition=r.end,setTimeout(function(){s._send(n,r)},0));a=null}},r.start=r.end+1,r.end=Math.max(Math.min(r.start+n.chunkSize,r.size)-1,r.start);var m=r.file,v=(m.slice||m.mozSlice||m.webkitSlice).call(m,r.start,r.end+1);r.size&&!v.size?setTimeout(function(){s.end(-1)}):(a.setRequestHeader("Content-Range","bytes "+r.start+"-"+r.end+"/"+r.size),a.setRequestHeader("Content-Disposition","attachment; filename="+encodeURIComponent(r.name)),a.setRequestHeader("Content-Type",r.type||"application/octet-stream"),a.send(v)),m=v=null}else if(a.upload&&a.upload.addEventListener("progress",t.throttle(function(e){n.progress(e,s,n)},100),!1),a.onreadystatechange=function(){if(s.status=a.status,s.statusText=a.statusText,s.readyState=a.readyState,4==a.readyState){for(var e in o)s["response"+e]=a["response"+e];if(a.onreadystatechange=null,!a.status||a.status>201)if(t.log("Error: "+a.status),(!a.status&&!a.aborted||500==a.status)&&(n.retry||0)<n.uploadRetry){n.retry=(n.retry||0)+1;var i=t.networkDownRetryTimeout;n.pause(n.file,n),setTimeout(function(){s._send(n,r)},i)}else s.end(a.status);else s.end(a.status);a=null}},t.isArray(r)){a.setRequestHeader("Content-Type","multipart/form-data; boundary=_"+t.expando);var b=r.join("")+"--_"+t.expando+"--";if(a.sendAsBinary)a.sendAsBinary(b);else{var y=Array.prototype.map.call(b,function(e){return 255&e.charCodeAt(0)});a.send(new Uint8Array(y).buffer)}}else a.send(r)}}},t.XHR=r}(window,FileAPI),function(e,t,n){var i=e.document,r=e.location,o=e.navigator,a=n.each;n.support.flash=function(){var t=o.mimeTypes,i=!1;if(o.plugins&&"object"==typeof o.plugins["Shockwave Flash"])i=o.plugins["Shockwave Flash"].description&&!(t&&t["application/x-shockwave-flash"]&&!t["application/x-shockwave-flash"].enabledPlugin);else try{i=!(!e.ActiveXObject||!new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(e){n.log("Flash -- does not supported.")}return i&&/^file:/i.test(r)&&n.log("[warn] Flash does not work on `file:` protocol."),i}(),n.support.flash&&(!n.html5||!n.support.html5||n.cors&&!n.support.cors||n.media&&!n.support.media)&&function(){function s(e){return('<object id="#id#" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+(e.width||"100%")+'" height="'+(e.height||"100%")+'"><param name="movie" value="#src#" /><param name="flashvars" value="#flashvars#" /><param name="swliveconnect" value="true" /><param name="allowscriptaccess" value="always" /><param name="allownetworking" value="all" /><param name="menu" value="false" /><param name="wmode" value="#wmode#" /><embed flashvars="#flashvars#" swliveconnect="true" allownetworking="all" allowscriptaccess="always" name="#id#" src="#src#" width="'+(e.width||"100%")+'" height="'+(e.height||"100%")+'" menu="false" wmode="transparent" type="application/x-shockwave-flash"></embed></object>').replace(/#(\w+)#/gi,function(t,n){return e[n]})}function l(e,t){if(e&&e.style){var n,i;for(n in t){i=t[n],"number"==typeof i&&(i+="px");try{e.style[n]=i}catch(e){}}}}function c(e,t){a(t,function(t,n){var i=e[n];e[n]=function(){return this.parent=i,t.apply(this,arguments)}})}function d(e){return e&&!e.flashId}function u(e){var t=e.wid=n.uid();return _._fn[t]=e,"FileAPI.Flash._fn."+t}function f(e){try{_._fn[e.wid]=null,delete _._fn[e.wid]}catch(e){}}function p(e,t){if(!w.test(e)){if(/^\.\//.test(e)||"/"!=e.charAt(0)){var n=r.pathname;n=n.substr(0,n.lastIndexOf("/")),e=(n+"/"+e).replace("/./","/")}"//"!=e.substr(0,2)&&(e="//"+r.host+e),w.test(e)||(e=r.protocol+e)}return t&&(e+=(/\?/.test(e)?"&":"?")+t),e}function h(e,t,r){function o(){try{var e=_.get(c);e.setImage(t)}catch(e){n.log('[err] FlashAPI.Preview.setImage -- can not set "base64":',e)}}var a,c=n.uid(),d=i.createElement("div"),h=10;for(a in e)d.setAttribute(a,e[a]),d[a]=e[a];l(d,e),e.width="100%",e.height="100%",d.innerHTML=s(n.extend({id:c,src:p(n.flashImageUrl,"r="+n.uid()),wmode:"opaque",flashvars:"scale="+e.scale+"&callback="+u(function e(){return f(e),--h>0&&o(),!0})},e)),r(!1,d),d=null}function g(e){return{id:e.id,name:e.name,matrix:e.matrix,flashId:e.flashId}}function m(t){var n=t.getBoundingClientRect(),r=i.body,o=(t&&t.ownerDocument).documentElement;return{top:n.top+(e.pageYOffset||o.scrollTop)-(o.clientTop||r.clientTop||0),left:n.left+(e.pageXOffset||o.scrollLeft)-(o.clientLeft||r.clientLeft||0),width:n.right-n.left,height:n.bottom-n.top}}var v=n.uid(),b=0,y={},w=/^https?:/i,_={_fn:{},init:function(){var e=i.body&&i.body.firstChild;if(e)do if(1==e.nodeType){n.log("FlashAPI.state: awaiting");var t=i.createElement("div");return t.id="_"+v,l(t,{top:1,right:1,width:5,height:5,position:"absolute",zIndex:"2147483647"}),e.parentNode.insertBefore(t,e),void _.publish(t,v)}while(e=e.nextSibling);10>b&&setTimeout(_.init,50*++b)},publish:function(e,t,i){i=i||{},e.innerHTML=s({id:t,src:p(n.flashUrl,"r="+n.version),wmode:i.camera?"":"transparent",flashvars:"callback="+(i.onEvent||"FileAPI.Flash.onEvent")+"&flashId="+t+"&storeKey="+o.userAgent.match(/\d/gi).join("")+"_"+n.version+(_.isReady||(n.pingUrl?"&ping="+n.pingUrl:""))+"&timeout="+n.flashAbortTimeout+(i.camera?"&useCamera="+p(n.flashWebcamUrl):"")+"&debug="+(n.debug?"1":"")},i)},ready:function(){n.log("FlashAPI.state: ready"),_.ready=n.F,_.isReady=!0,_.patch(),_.patchCamera&&_.patchCamera(),n.event.on(i,"mouseover",_.mouseover),n.event.on(i,"click",function(e){_.mouseover(e)&&(e.preventDefault?e.preventDefault():e.returnValue=!0)})},getEl:function(){return i.getElementById("_"+v)},getWrapper:function(e){do if(/js-fileapi-wrapper/.test(e.className))return e;while((e=e.parentNode)&&e!==i.body)},mouseover:function(e){var t=n.event.fix(e).target;if(/input/i.test(t.nodeName)&&"file"==t.type&&!t.disabled){var r=t.getAttribute(v),o=_.getWrapper(t);if(n.multiFlash){if("i"==r||"r"==r)return!1;if("p"!=r){t.setAttribute(v,"i");var a=i.createElement("div");if(!o)return void n.log("[err] FlashAPI.mouseover: js-fileapi-wrapper not found");l(a,{top:0,left:0,width:t.offsetWidth,height:t.offsetHeight,zIndex:"2147483647",position:"absolute"}),o.appendChild(a),_.publish(a,n.uid()),t.setAttribute(v,"p")}return!0}if(o){var s=m(o);l(_.getEl(),s),_.curInp=t}}else/object|embed/i.test(t.nodeName)||l(_.getEl(),{top:1,left:1,width:5,height:5})},onEvent:function(e){var t=e.type;if("ready"==t){try{_.getInput(e.flashId).setAttribute(v,"r")}catch(e){}return _.ready(),setTimeout(function(){_.mouseenter(e)},50),!0}"ping"===t?n.log("(flash -> js).ping:",[e.status,e.savedStatus],e.error):"log"===t?n.log("(flash -> js).log:",e.target):t in _&&setTimeout(function(){n.log("FlashAPI.event."+e.type+":",e),_[t](e)},1)},mouseenter:function(e){var t=_.getInput(e.flashId);if(t){_.cmd(e,"multiple",null!=t.getAttribute("multiple"));var i=[],r={};a((t.getAttribute("accept")||"").split(/,\s*/),function(e){n.accept[e]&&a(n.accept[e].split(" "),function(e){r[e]=1})}),a(r,function(e,t){i.push(t)}),_.cmd(e,"accept",i.length?i.join(",")+","+i.join(",").toUpperCase():"*")}},get:function(t){return i[t]||e[t]||i.embeds[t]},getInput:function(e){if(!n.multiFlash)return _.curInp;try{var t=_.getWrapper(_.get(e));if(t)return t.getElementsByTagName("input")[0]}catch(t){n.log('[err] Can not find "input" by flashId:',e,t)}},select:function(e){var r,o=_.getInput(e.flashId),s=n.uid(o),l=e.target.files;a(l,function(e){n.checkFileObj(e)}),y[s]=l,i.createEvent?(r=i.createEvent("Event"),r.files=l,r.initEvent("change",!0,!0),o.dispatchEvent(r)):t?t(o).trigger({type:"change",files:l}):(r=i.createEventObject(),r.files=l,o.fireEvent("onchange",r))},cmd:function(e,t,i,r){try{return n.log("(js -> flash)."+t+":",i),_.get(e.flashId||e).cmd(t,i)}catch(o){n.log("(js -> flash).onError:",o.toString()),r||setTimeout(function(){_.cmd(e,t,i,!0)},50)}},patch:function(){n.flashEngine=!0,c(n,{getFiles:function(e,t,i){if(i)return n.filterFiles(n.getFiles(e),t,i),null;var r=n.isArray(e)?e:y[n.uid(e.target||e.srcElement||e)];return r?(t&&(t=n.getFilesFilter(t),r=n.filter(r,function(e){return t.test(e.name)})),r):this.parent.apply(this,arguments)},getInfo:function(e,t){if(d(e))this.parent.apply(this,arguments);else if(e.isShot)t(null,e.info={width:e.width,height:e.height});else{if(!e.__info){var i=e.__info=n.defer();_.cmd(e,"getFileInfo",{id:e.id,callback:u(function t(n,r){f(t),i.resolve(n,e.info=r)})})}e.__info.then(t)}}}),n.support.transform=!0,n.Image&&c(n.Image.prototype,{get:function(e,t){return this.set({scaleMode:t||"noScale"}),this.parent(e)},_load:function(e,t){if(n.log("FlashAPI.Image._load:",e),d(e))this.parent.apply(this,arguments);else{var i=this;n.getInfo(e,function(n){t.call(i,n,e)})}},_apply:function(e,t){if(n.log("FlashAPI.Image._apply:",e),d(e))this.parent.apply(this,arguments);else{var i=this.getMatrix(e.info),r=t;_.cmd(e,"imageTransform",{id:e.id,matrix:i,callback:u(function o(a,s){n.log("FlashAPI.Image._apply.callback:",a),f(o),a?r(a):n.support.html5||n.support.dataURI&&!(s.length>3e4)?(i.filter&&(r=function(e,r){e?t(e):n.Image.applyFilter(r,i.filter,function(){t(e,this.canvas)})}),n.newImage("data:"+e.type+";base64,"+s,r)):h({
width:i.deg%180?i.dh:i.dw,height:i.deg%180?i.dw:i.dh,scale:i.scaleMode},s,r)})})}},toData:function(e){var t=this.file,i=t.info,r=this.getMatrix(i);n.log("FlashAPI.Image.toData"),d(t)?this.parent.apply(this,arguments):("auto"==r.deg&&(r.deg=n.Image.exifOrientation[i&&i.exif&&i.exif.Orientation]||0),e.call(this,!t.info,{id:t.id,flashId:t.flashId,name:t.name,type:t.type,matrix:r}))}}),n.Image&&c(n.Image,{fromDataURL:function(e,t,i){!n.support.dataURI||e.length>3e4?h(n.extend({scale:"exactFit"},t),e.replace(/^data:[^,]+,/,""),function(e,t){i(t)}):this.parent(e,t,i)}}),c(n.Form.prototype,{toData:function(e){for(var t=this.items,i=t.length;i--;)if(t[i].file&&d(t[i].blob))return this.parent.apply(this,arguments);n.log("FlashAPI.Form.toData"),e(t)}}),c(n.XHR.prototype,{_send:function(e,t){if(t.nodeName||t.append&&n.support.html5||n.isArray(t)&&"string"==typeof t[0])return this.parent.apply(this,arguments);var i,r,o={},s={},l=this;if(a(t,function(e){e.file?(s[e.name]=e=g(e.blob),r=e.id,i=e.flashId):o[e.name]=e.blob}),r||(i=v),!i)return n.log("[err] FlashAPI._send: flashId -- undefined"),this.parent.apply(this,arguments);n.log("FlashAPI.XHR._send: "+i+" -> "+r),l.xhr={headers:{},abort:function(){_.cmd(i,"abort",{id:r})},getResponseHeader:function(e){return this.headers[e]},getAllResponseHeaders:function(){return this.headers}};var c=n.queue(function(){_.cmd(i,"upload",{url:p(e.url.replace(/([a-z]+)=(\?)&?/i,"")),data:o,files:r?s:null,headers:e.headers||{},callback:u(function t(i){var r=i.type,o=i.result;n.log("FlashAPI.upload."+r),"progress"==r?(i.loaded=Math.min(i.loaded,i.total),i.lengthComputable=!0,e.progress(i)):"complete"==r?(f(t),"string"==typeof o&&(l.responseText=o.replace(/%22/g,'"').replace(/%5c/g,"\\").replace(/%26/g,"&").replace(/%25/g,"%")),l.end(i.status||200)):"abort"!=r&&"error"!=r||(l.end(i.status||0,i.message),f(t))})})});a(s,function(e){c.inc(),n.getInfo(e,c.next)}),c.check()}})}};n.Flash=_,n.newImage("data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",function(e,t){n.support.dataURI=!(1!=t.width||1!=t.height),_.init()})}()}(window,window.jQuery,FileAPI);
