// A multi-purpose filebrowser.
// https://github.com/jonataswalker/FileBrowser
// Version: v1.2.0
// Built: 2016-04-04T16:03:43-0300

"use strict";!function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define([],t):e.FileBrowser=t()}(this,function(){var e={},t={whiteSpaceRegex:/\s+/,toQueryString:function(e){return Object.keys(e).reduce(function(n,i){return n.push("object"==typeof e[i]?t.toQueryString(e[i]):encodeURIComponent(i)+"="+encodeURIComponent(e[i])),n},[]).join("&")},encodeUrlXhr:function(e,n){if(n&&"object"==typeof n){var i=t.toQueryString(n);e+=(/\?/.test(e)?"&":"?")+i}return e},json:function(e,n){var i=new XMLHttpRequest,a={},r=function(){200===i.status?a.ready.call(void 0,JSON.parse(i.response)):console.info("Status code was "+i.status)},o=function(){console.info("Can't XHR "+JSON.stringify(e))},s=function(){};return e=t.encodeUrlXhr(e,n),i.open("GET",e,!0),i.setRequestHeader("Accept","application/json"),i.onload=r,i.onerror=o,i.onprogress=s,i.send(null),{when:function(e){a.ready=e.ready}}},post:function(e,n){var i=new XMLHttpRequest,a={},r=function(){200===i.status?a.ready.call(void 0,JSON.parse(i.response)):console.info("Status code was "+i.status)},o=function(){console.info("Can't XHR "+JSON.stringify(e))},s=function(){};return n=t.toQueryString(n),i.open("POST",e,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.onload=r,i.onerror=o,i.onprogress=s,i.send(n),{when:function(e){a.ready=e.ready}}},getPath:function(){var e=window.location.pathname.split("/");return e.shift(),e.pop(),"/"+e.join("/")+"/"},stopEventPropagation:function(e){"function"==typeof e.stopPropagation?(e.stopPropagation(),e.preventDefault()):window.event&&window.event.hasOwnProperty("cancelBubble")&&(window.event.cancelBubble=!0)},fireClick:function(e){if("function"==typeof MouseEvent){var t=new MouseEvent("click",{view:window,bubbles:!1,cancelable:!0});e.dispatchEvent(t)}else if(document.createEvent){var n=document.createEvent("MouseEvents");n.initEvent("click",!1,!1),e.dispatchEvent(n)}else document.createEventObject?e.fireEvent("onclick"):"function"==typeof e.onclick&&e.onclick()},classRegex:function(e){return new RegExp("(^|\\s+)"+e+"(\\s+|$)")},_addClass:function(e,n,i){e.classList?e.classList.add(n):e.className=(e.className+" "+n).trim(),i&&t.isNumeric(i)&&window.setTimeout(function(){t._removeClass(e,n)},i)},addClass:function(e,n,i){if(Array.isArray(e))return void e.forEach(function(e){t.addClass(e,n)});for(var a=Array.isArray(n)?n:n.split(t.whiteSpaceRegex),r=a.length;r--;)t.hasClass(e,a[r])||t._addClass(e,a[r],i)},_removeClass:function(e,n){e.classList?e.classList.remove(n):e.className=e.className.replace(t.classReg(n)," ").trim()},removeClass:function(e,n){if(Array.isArray(e))return void e.forEach(function(e){t.removeClass(e,n)});for(var i=Array.isArray(n)?n:n.split(t.whiteSpaceRegex),a=i.length;a--;)t.hasClass(e,i[a])&&t._removeClass(e,i[a])},hasClass:function(e,n){return e.classList?e.classList.contains(n):t.classReg(n).test(e.className)},toggleClass:function(e,n){return Array.isArray(e)?void e.forEach(function(e){t.toggleClass(e,n)}):void(e.classList?e.classList.toggle(n):t.hasClass(e,n)?t._removeClass(e,n):t._addClass(e,n))},$:function(e){return e="#"===e[0]?e.substr(1,e.length):e,document.getElementById(e)},isElement:function(e){return"HTMLElement"in window?!!e&&e instanceof HTMLElement:!!e&&"object"==typeof e&&1===e.nodeType&&!!e.nodeName},find:function(e,n,i){var a=/^(#?[\w-]+|\.[\w-.]+)$/,r=/\./g,o=[].slice,s=[];if(a.test(e))switch(e[0]){case"#":s=[t.$(e.substr(1))];break;case".":s=o.call(n.getElementsByClassName(e.substr(1).replace(r," ")));break;default:s=o.call(n.getElementsByTagName(e))}else s=o.call(n.querySelectorAll(e));return i?s:s[0]},getAllChildren:function(e,t){return[].slice.call(e.getElementsByTagName(t))},getSiblings:function(e,t){return Array.prototype.filter.call(e.parentNode.children,function(n){return t?t.toUpperCase()==n.tagName?n!==e:void 0:n!==e})},emptyArray:function(e){for(;e.length;)e.pop()},removeAllChildren:function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},removeAll:function(e){for(var t;t=e[0];)t.parentNode.removeChild(t)},getChildren:function(e,t){return[].filter.call(e.childNodes,function(e){return t?1==e.nodeType&&e.tagName.toLowerCase()==t:1==e.nodeType})},templateLang:function(e,t){return e.replace(/(%\d)/g,function(e,n){var i=n.match(/\d+$/)[0];return t[i-1]})},template:function(e,t){var n=this;return e.replace(/\{ *([\w_-]+) *\}/g,function(e,i){var a=void 0===t[i]?"":t[i];return n.htmlEscape(a)})},htmlEscape:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},getMaxZIndex:function(){for(var e,n=0,i=t.find("*",document,!0),a=i.length,r=-1;++r<a;)e=parseInt(window.getComputedStyle(i[r]).zIndex,10),n=e?Math.max(n,e):n;return n},deepExtend:function(e,n){var i,a;for(i in n)n.hasOwnProperty(i)&&(a=n[i],void 0!==a&&null!==a&&void 0!==a.constructor&&a.constructor===Object?(e[i]=e[i]||{},t.deepExtend(e[i],a)):e[i]=a);return e},createElement:function(e,t){var n;if(Array.isArray(e)){if(n=document.createElement(e[0]),e[1].id&&(n.id=e[1].id),e[1].classname&&(n.className=e[1].classname),e[1].attr){var i=e[1].attr;if(Array.isArray(i))for(var a=-1;++a<i.length;)n.setAttribute(i[a].name,i[a].value);else n.setAttribute(i.name,i.value)}}else n=document.createElement(e);n.innerHTML=t;for(var r=document.createDocumentFragment();n.childNodes[0];)r.appendChild(n.childNodes[0]);return n.appendChild(r),n},setCenter:function(e,n){n=n||window;var i=t.getSize(n),a=t.getSize(e),r=n==window?window.pageXOffset:n.scrollLeft,o=n==window?window.pageYOffset:n.scrollTop,s=Math.max(0,(i.height-a.height)/2+o),l=Math.max(0,(i.width-a.width)/2+r);e.style.position="absolute",e.style.top=s+"px",e.style.left=l+"px"},getSize:function(e){return e==window||e==document?t.getWindowSize():{width:e.offsetWidth,height:e.offsetHeight}},getWindowSize:function(){return{width:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,height:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}},fadeIn:function(e,t){if(+e.style.opacity<1){t=t||16,e.style.opacity=0,e.style.display="block";var n=+new Date,i=function(){e.style.opacity=+e.style.opacity+(new Date-n)/100,n=+new Date,+e.style.opacity<1&&setTimeout(i,t)};i()}e.style.display="block"},fadeOut:function(e,t){t=t||16,e.style.opacity=1;var n=+new Date,i=function(){e.style.opacity=+e.style.opacity-(new Date-n)/100,n=+new Date,+e.style.opacity>0?setTimeout(i,t):e.style.display="none"};i()},getTopMargin:function(e){e.style.left="-9999px",e.style.display="block";var t,n=e.clientHeight;return t="undefined"!=typeof getComputedStyle?parseInt(getComputedStyle(e).paddingTop,10):parseInt(e.currentStyle.padding),e.style.left="",e.style.display="none","-"+parseInt((n+t)/2)+"px"},toType:function(e){return e==window&&e.document&&e.location?"window":e==document?"htmldocument":"string"==typeof e?"string":t.isElement(e)?"element":void 0},typeOf:function(e){return{}.toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},removeArrayEntry:function(e,t){var n=e.indexOf(t);n>-1&&e.splice(n,1)},bytesToSize:function(e){if(0===e)return"0 Byte";var t=1e3,n=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],i=Math.floor(Math.log(e)/Math.log(t));return(e/Math.pow(t,i)).toPrecision(3)+" "+n[i]}};return e.Base=function(n){var i=t.deepExtend({},e.defaultOptions);e.options=t.deepExtend(i,n),e.$base=this,e.$html=new e.Html,e.$html.createBrowser(),e.$html.createAlert(),e.$drag=new e.Drag,e.$tree=new e.Tree,e.$alert=new e.Alert,e.$upload=new e.Upload,this.current_active=e.elements.folder_tree_root,this.root_event_added=!1,this.thumbs_root=[],this.thumbs_selected=[],this.path=t.getPath(),e.$tree.build(),this.setListeners(),e.$drag.when({start:function(){t.addClass(e.container,"dragging")},move:function(){e.container.style.left=this.x+"px",e.container.style.top=this.y+"px"},end:function(){t.removeClass(e.container,"dragging"),this.y<0&&(e.container.style.top=0)}})},e.Base.prototype={show:function(){e.container.style.zIndex=t.getMaxZIndex()+10,e.container.style.display="block",t.setCenter(e.container)},setEditor:function(t){e.options.editor=t},setListeners:function(){var t=e.elements,n=function(){this.blur(),e.$tree.newFolder()},i=function(){this.blur(),e.$tree.removeFolder()},a=function(){this.blur(),e.$tree.removeFile()},r=function(){this.blur(),e.$tree.sendEditor()},o=function(){this.blur(),e.$tree.closeBrowser()},s=function(){this.blur(),e.$upload.choose()},l=function(){this.blur(),e.$upload.start()};t.btn_new_folder.addEventListener("click",n,!1),t.btn_del_folder.addEventListener("click",i,!1),t.btn_upload_choose.addEventListener("click",s,!1),t.btn_upload_file.addEventListener("click",l,!1),t.btn_del_file.addEventListener("click",a,!1),t.btn_editor.addEventListener("click",r,!1),t.btn_close_grd.addEventListener("click",o,!1)}},e.constants={css:{container:"filebrowser-fb fb-container",alert_overlay:"filebrowser-fb fb-alert-overlay",alert_container:"filebrowser-fb fb-alert"},types:{image:"image"},actions:{upload:"upload",new_folder:"new-folder",delete_folder:"del-folder",delete_file:"del-file",get_thumbs:"get-thumbs"},suffix_small:"small",suffix_medium:"medium",thumb_path:"data-path",thumb_sel:"selected",li_key:"data-key"},e.defaultOptions={mode:"plugin",lang:"en",root_http:"/",server_http:"browser.php",regex_folder:/^[a-zA-Z0-9-_.]{1,10}$/,upload_types:[e.constants.types.image],image:{min_width:120,min_height:120}},e.elements={},e.lang={},e.lang["pt-br"]={title:"Image Browser",root_folder:"Root Folder",preview:"Sending Preview",send_to_editor:"Send to Editor",toolbar:{bt_choose:"Escolha",bt_send:"Envie",bt_del_file:"Remover Arquivo",bt_new_folder:"Nova Pasta",bt_del_folder:"Remover Pasta",bt_send_editor:"Enviar para o Editor"},file:{total:"Total de Arquivos:",del:"Remover Arquivo",dels:"Remover Arquivos"},folder:{new_:"Nova Pasta",del:"Remover Pasta",creation:"Esta pasta será criada em:",minimum:["<p>Preenchimento mínimo: 1 - máximo: 10",'<br>Apenas <span class="strong">letras</span>, ','<span class="strong">números</span>',' e os seguintes caracteres: <span class="highlight">. - _</span></p>'].join(""),deletion:['<p class="folder-path">Esta pasta <span>%1</span>'," será removida juntamente com todo seu conteúdo: </p>",'<p>Total de Arquivos: <span class="destaque">%2</span>',' &mdash; Total de Sub-Pastas: <span class="destaque">%3</span></p>'].join("")},alert:{bt_ok:"OK",bt_cancel:"Cancelar",image:{not_min_size:"Apenas imagens com no mínimo %1 x %2!"},upload:{sending:"Um envio já está em andamento!",none:"Nenhum arquivo foi selecionado!",sent:"Todos os arquivos já foram enviados!"}}},e.lang.en={title:"Image Browser",root_folder:"Root Folder",preview:"Sending Preview",send_to_editor:"Send to Editor",toolbar:{bt_choose:"Choose",bt_send:"Send",bt_del_file:"Delete File",bt_new_folder:"New Folder",bt_del_folder:"Delete Folder",bt_send_editor:"Send to Editor"},file:{total:"Total Files:",del:"Delete File",dels:"Delete Files"},folder:{new_:"New Folder",del:"Delete Folder",creation:"This folder will be created inside:",minimum:["<p>Min-length: 1 - Max-length: 10",'<br>Only <span class="strong">letters</span>, ','<span class="strong">numbers</span> ','and the following characters: <span class="highlight">. - _</span></p>'].join(""),deletion:['<p class="folder-path">This folder <span>%1</span>'," will be removed with all its contents: </p>",'<p>Total Files: <span class="destaque">%2</span>',' &mdash; Total Subfolders: <span class="destaque">%3</span></p>'].join("")},alert:{bt_ok:"OK",bt_cancel:"Cancel",image:{not_min_size:"Only images with minimum %1 x %2!"},upload:{sending:"An upload is already in progress!",none:"No file!",sent:"All done!"}}},e.Tree=function(){this.els=e.elements,this.options=e.options,this.lang=e.lang[e.options.lang]},e.Tree.prototype={get:function(){t.addClass(this.els.grd_preview,"mapeando-spinner");var n={},i=this;return t.json(this.options.server_http,{action:e.constants.actions.get_thumbs,lang:e.options.lang}).when({ready:function(a){t.removeClass(i.els.grd_preview,"mapeando-spinner"),"files"in a.tree&&(e.$base.thumbs_root=a.tree.files,i.loadThumbs(e.$base.thumbs_root)),"dirs"in a.tree&&n.ready.call(void 0,{dirs:a.tree.dirs}),i.updateCountFolder()}}),{when:function(e){n.ready=e.ready}}},build:function(){var e=this;this.get().when({ready:function(t){e.buildTree(t.dirs),e.treeEvents(t.dirs)}})},buildTree:function(e){for(var n,i,a,r,o=this,s=function(e,n,i,a){var r={folder:e,"n-files":n.files,"n-files-all":n["files-all"],"n-folders":n.folders,last:a},s=o.folderTemplate(r),l=t.createElement(["ol",{classname:"collapse"}],s),d=i.appendChild(l);return d},l=function(e,t){for(var n,i,a,r,o=Object.keys(e),d=o.length,c=-1,u={};++c<d;)n=o[c],i=e[n],r=i.last===!0?1:0,u={files:i.files?i.files.length:0,"files-all":i["c-files"],folders:i["c-folders"]},a=s(n,u,t,r),i.dirs&&l(i.dirs,a.firstChild)},d=Object.keys(e),c=d.length,u=-1,f={};++u<c;)n=d[u],i=e[n],r=i.last===!0?1:0,f={files:i.files?i.files.length:0,"files-all":i["c-files"],folders:i["c-folders"]},a=s(n,f,this.els.folder_tree_root,r),i.dirs&&l(i.dirs,a.firstChild)},showHeaderMessage:function(e){var n=this;this.els.grd_msg.textContent=e.msg,t.addClass(this.els.grd_msg,["show",e.type]),window.setTimeout(function(){t.removeClass(n.els.grd_msg,["show",e.type])},e.duration)},renewTree:function(n){return this.removeTree(),this.emptyThumbSelected(),this.removeThumbs(),t.emptyArray(e.$base.thumbs_root),e.$base.current_active=!1,Array.isArray(n)&&0===n.length?(this.updateCountFolder(),void t.fireClick(this.els.folder_tree_root)):("files"in n&&(e.$base.thumbs_root=n.files,this.loadThumbs(e.$base.thumbs_root)),"dirs"in n&&(this.buildTree(n.dirs),this.treeEvents(n.dirs)),this.updateCountFolder(),void this.setFolderActive())},newFolder:function(){var t=this,n=this.options.regex_folder,i=function(){n.test(this)?e.$alert.hideInputError():e.$alert.showInputError(t.lang.folder.minimum)},a=function(){return n.test(this)?void t.submitFolder(this,e.constants.actions.new_folder).when({ready:function(n){n.erro===!1?(t.renewTree(n.tree),e.$alert.close()):e.$alert.showInputError(n.msg)}}):void e.$alert.showInputError(t.lang.folder.minimum)},r=this.getFolderPath(e.$base.current_active),o=r.length,s="<span>"+this.lang.root_folder+"</span>";for(r.reverse();o--;)s+="&nbsp;&rarr;&nbsp;<span>"+r[o]+"</span>";var l="<p>"+this.lang.folder.creation+'</p><p class="folder-path">'+s+"</p>",d={title:this.lang.folder.new_,text:l};e.$alert.prompt({placeholder:this.lang.folder.new_,html:d,checkInput:i,submit:a})},submitFolder:function(n,i){var a=i==e.constants.actions.delete_folder?this.getFolderPath(e.$base.current_active,!0):this.getFolderPath(e.$base.current_active),r={};return t.post(this.options.server_http,{action:i,folder:n,parents:a.join(),lang:e.options.lang}).when({ready:function(e){r.ready.call(void 0,e)}}),{when:function(e){r.ready=e.ready}}},removeFolder:function(){var n=this,i=e.$base.current_active,a=i.getAttribute("data-key"),r=i.getAttribute("data-files-all"),o=i.getAttribute("data-folders"),s=function(){n.submitFolder(a,e.constants.actions.delete_folder).when({ready:function(t){t.erro===!1?(n.renewTree(t.tree),e.$alert.close()):e.$alert.showInputError(t.msg)}})},l=t.templateLang(this.lang.folder.deletion,[a,r,o]),d={title:this.lang.folder.del,text:l};e.$alert.confirm({html:d,submit:s})},removeFile:function(){var n=this,i=function(){t.post(n.options.server_http,{action:e.constants.actions.delete_file,files:e.$base.thumbs_selected.join(),lang:e.options.lang}).when({ready:function(t){n.renewTree(t.tree),e.$alert.close()}})},a=["<p>",this.lang.file.total,'<span class="highlight">',e.$base.thumbs_selected.length,"</span></p>"].join(""),r={title:this.lang.file.del,text:a};e.$alert.confirm({html:r,submit:i})},setFolderActive:function(){for(var e,n,i=this,a=t.find("li",this.els.folder_tree_root,!0),r=a.length,o=!1,s=-1,l=function(e){for(var n,a=e.parentNode,r=!0;r;)a?a==i.els.folder_tree_root?r=!1:"OL"==a.tagName&&(n=t.getSiblings(a,"ol"),t.removeClass(n,"collapse"),t.removeClass(a,"collapse")):r=!1,a=a.parentNode;t.fireClick(e)};++s<r;)if(e=a[s],n=e.getAttribute("data-last"),1==n){o=!0,l(e);break}o&&0!==r||t.fireClick(this.els.folder_tree_root)},getFolderPath:function(e,t){var n=[];for(t&&(e=e.parentNode);e&&e!==this.els.folder_tree_root;)"LI"==e.tagName&&n.unshift(e.getAttribute("data-key")),e=e.parentNode;return n},getFolderParent:function(e){e=e.parentNode;for(var t,n=!0;e&&n;)"LI"==e.tagName&&(t=e,n=!1),e=e.parentNode;return t},treeEvents:function(n){var i=this,a=t.find("li",this.els.folder_tree,!0),r=a.length;if(0!==r)for(var o=function(e){var n=!0;for(e=e.parentNode;e&&n;)"LI"==e.tagName&&(t.addClass(e,"open"),e==i.els.folder_tree_root&&(n=!1)),e=e.parentNode},s=function(n){var i=t.hasClass(n,"open"),a=t.hasClass(n,"active"),r=t.getChildren(n,"ol"),o=t.getAllChildren(n,"ol"),s=t.getAllChildren(n,"li");i&&a?(t.addClass(o,"collapse"),t.removeClass(s,"open"),t.removeClass(n,"open")):i?(t.addClass(o,"collapse"),t.removeClass(s,"open"),t.removeClass(n,"open")):(t.removeClass(r,"collapse"),t.addClass(n,"open")),e.$base.current_active=n,t.addClass(n,"active")},l=(function(e,t,n){var a,r,o=e.length;n=n||1;for(a in t)if(a==e[n-1])if(n==o){if(r=t[a],r&&"files"in r){i.loadThumbs(r.files);break}}else++n,l(e,t[a].dirs,n);return!1}),d=function(t,n){if(t==i.els.folder_tree_root)return void i.loadThumbs(e.$base.thumbs_root);for(var a=[];t&&t!==i.els.folder_tree_root;)"LI"==t.tagName&&a.unshift(t.getAttribute("data-key")),t=t.parentNode;l(a,n)},c=function(a){a.stopPropagation(),e.$upload.showTree(),this!=e.$base.current_active&&(i.removeThumbs(),d(this,n)),e.$base.current_active=e.$base.current_active||i.els.folder_tree_root,t.removeClass(e.$base.current_active,"active"),o(this),s(this),this==i.els.folder_tree_root?i.els.btn_del_folder.style.display="none":i.els.btn_del_folder.style.display=""},u=-1;++u<r;)!function(n){var r=a[n];if(0===n){var o=t.getChildren(r,"ol");o.length>0&&t.removeClass(o,"collapse")}r==i.els.folder_tree_root?e.$base.root_event_added||(r.addEventListener("click",c,!1),e.$base.root_event_added=!0):r.addEventListener("click",c,!1)}(u)},emptyThumbSelected:function(){var n=t.find("li",this.els.grd_preview,!0);t.emptyArray(e.$base.thumbs_selected),t.removeClass(n,e.constants.thumb_sel),this.buttonThumbRemoveHandler()},buttonThumbRemoveHandler:function(){var n=e.$base.thumbs_selected.length,i=n>1?this.lang.file.dels:this.lang.file.del;n>0?(t.removeClass(this.els.btn_editor,"hidden"),t.removeClass(this.els.btn_del_file,"hidden"),this.els.desc_btn_del_file.textContent=i+" ("+n+")",this.els.desc_btn_editor.textContent=this.lang.send_to_editor+" ("+n+")"):(t.addClass(this.els.btn_editor,"hidden"),t.addClass(this.els.btn_del_file,"hidden"))},updateCountFolder:function(){this.els.folder_root_desc.textContent=this.lang.root_folder+" ("+e.$base.thumbs_root.length+")"},removeThumbs:function(){t.removeAllChildren(this.els.grd_preview)},loadThumbs:function(n){for(var i,a,r,o,s,l,d=this,c=-1,u=this.options.root_http,f=n.length,p=function(){t.toggleClass(this,e.constants.thumb_sel);var n=t.hasClass(this,e.constants.thumb_sel),i=this.getAttribute(e.constants.thumb_path);n?e.$base.thumbs_selected.push(i):t.removeArrayEntry(e.$base.thumbs_selected,i),d.buttonThumbRemoveHandler()};++c<f;)o=n[c],s=o.relative_path+o.filename,l=e.$base.thumbs_selected.indexOf(s)>-1,i={filename:o.filename,date:o.date,filesize:o.filesize,url:u+s},a=this.thumbTemplate(i),r=t.createElement(["li",{classname:l?e.constants.thumb_sel:"",attr:[{name:e.constants.thumb_path,value:s}]}],a),this.els.grd_preview.appendChild(r),r.addEventListener("click",p,!1)},sendEditor:function(){for(var t,n=this.options.editor,i=e.$base.thumbs_selected.length,a=-1;++a<i;)t=e.$base.thumbs_selected[a].replace(e.constants.suffix_small,e.constants.suffix_medium),n.insertHtml('<img src="'+this.options.root_http+t+'">');this.emptyThumbSelected(),this.closeBrowser()},closeBrowser:function(){this.els.container.style.display="none"},removeTree:function(){var e=this.els.folder_tree_root.getElementsByTagName("ol");t.removeAll(e)},thumbTemplate:function(e){var n=['<a class="brankic-checked" style="background-image:url({url})">','<span class="fb-fileinfo">','<span class="fb-fileinfo-center">',"<span>{filename}</span>","<span>{date}<br>{filesize}</span>","</span>","</span>","</a>"].join("");return t.template(n,e)},folderTemplate:function(e){var n=['<li data-key="{folder}" data-last="{last}" ','data-files-all="{n-files-all}" data-folders="{n-folders}"><a>','<i class="icomoon-folder"></i>',"<span>{folder} ({n-files})</span>","</a></li>"].join("");return t.template(n,e)}},e.Html=function(){},e.Html.prototype={createBrowser:function(){var n=e.lang[e.options.lang],i=['<div class="fb-header unselectable">',"<span>",n.title,"</span>",'<span class="close"></span>',"</div>",'<h5 class="fb-message"></h5>','<div class="fb-toolbar">','<div class="fb-toolbar-items">','<button id="btn-upload-choose" class="button-filebrowser">','<i class="brankic-attachment"></i>',"<span>",n.toolbar.bt_choose,"</span>","</button>",'<button class="button-filebrowser hidden" id="btn-upload-send">','<i class="brankic-upload"></i>',"<span>",n.toolbar.bt_send,"</span>","</button>",'<button class="button-filebrowser hidden" id="btn-del-file">','<i class="brankic-trashcan"></i>',"<span>",n.toolbar.bt_del_file,"</span>","</button>",'<button class="button-filebrowser" id="btn-new-folder">','<i class="icomoon-folder-plus"></i>',"<span>",n.toolbar.bt_new_folder,"</span>","</button>",'<button class="button-filebrowser" id="btn-del-folder" ','style="display:none">','<i class="icomoon-folder-minus"></i>',"<span>",n.toolbar.bt_del_folder,"</span>","</button>",'<button class="button-filebrowser hidden" id="btn-editor">','<i class="brankic-edit"></i>',"<span>",n.toolbar.bt_send_editor,"</span>","</button>","</div>","</div>",'<div class="fb-body clearfix">','<div class="fb-tree-container">','<ol id="fb-tree">','<li id="fb-tree-folder-root" class="active open">',"<a>",'<i class="icomoon-folder"></i>','<span id="folder-root-desc">',n.root_folder,"</span>","</a>","</li>","</ol>","</div>",'<div id="" class="fb-thumb-container">','<ul id="fb-thumb" class="fb-thumb"></ul>','<div class="js-fileapi-wrapper">','<input id="upload-input" class="input-file" name="files" ','type="file" multiple />',"</div>",'<ul id="upload-thumb" class="fb-upload-thumb" data-label="',n.preview,'"></ul>',"</div>","</div>",'<div class="fb-footer">',"<span></span><span></span>","</div>"].join(""),a=t.createElement(["div",{classname:e.constants.css.container}],i),r={container:a,drag_handle:a.querySelector(".fb-header"),grd_preview:a.querySelector("#fb-thumb"),folder_tree:a.querySelector("#fb-tree"),folder_tree_root:a.querySelector("#fb-tree-folder-root"),folder_root_desc:a.querySelector("#folder-root-desc"),upload_input:a.querySelector("#upload-input"),btn_upload_choose:a.querySelector("#btn-upload-choose"),btn_new_folder:a.querySelector("#btn-new-folder"),btn_del_folder:a.querySelector("#btn-del-folder"),btn_del_file:a.querySelector("#btn-del-file"),btn_upload_file:a.querySelector("#btn-upload-send"),btn_editor:a.querySelector("#btn-editor"),images_list:a.querySelector("#upload-thumb"),grd_msg:a.querySelector(".fb-message"),grd_drag:a.querySelector(".fb-header"),grd_resize:a.querySelector(".fb-footer"),desc_btn_del_file:a.querySelector("#btn-del-file span"),desc_btn_editor:a.querySelector("#btn-editor span"),btn_close_grd:a.querySelector(".fb-header span.close")};for(var o in r)e.elements[o]=r[o];a.style.zIndex=e.$base.maxZIndex+10,a.style.display="none",document.body.appendChild(a),e.container=a},createAlert:function(){var n=e.lang[e.options.lang],i=['<div class="fb-icon fb-error" style="display:none;">','<span class="fb-x-mark">','<span class="fb-line fb-left"></span>','<span class="fb-line fb-right"></span>',"</span>","</div>",'<div class="fb-icon fb-warning" style="display:none;">','<span class="fb-body"></span>','<span class="fb-dot"></span>',"</div>",'<div class="fb-icon fb-info" style="display:none;"></div>','<h2 class="fb-title"></h2>','<div class="fb-text"></div>','<fieldset><input type="text" style="display:none;"></fieldset>','<div class="fb-error-container">','<div class="icon">!</div>','<div class="fb-error-text"></div>',"</div>",'<div class="fb-button-container">','<button class="button-filebrowser cancel">',n.alert.bt_cancel,"</button>",'<button class="button-filebrowser ok">',n.alert.bt_ok,"</button>","</div>"].join(""),a=document.createElement("div"),r=t.createElement(["div",{classname:e.constants.css.alert_container}],i),o={alert_overlay:a,alert_container:r,alert_title:r.querySelector(".fb-title"),alert_text:r.querySelector(".fb-text"),alert_input:r.querySelector('input[type="text"]'),alert_icon_error:r.querySelector(".fb-icon.fb-error"),alert_icon_warning:r.querySelector(".fb-icon.fb-warning"),alert_icon_info:r.querySelector(".fb-icon.fb-info"),alert_icon_success:r.querySelector(".fb-icon.fb-success"),alert_elem_error:r.querySelector(".fb-error-container"),alert_error_text:r.querySelector(".fb-error-text"),alert_ok:r.querySelector("button.ok"),alert_cancel:r.querySelector("button.cancel")};for(var s in o)e.elements[s]=o[s];return a.className=e.constants.css.alert_overlay,a.style.zIndex=e.$base.maxZIndex+11,r.style.zIndex=e.$base.maxZIndex+12,r.style.display="none",document.body.appendChild(a),document.body.appendChild(r),r}},e.Drag=function(){var t,n,i,a,r,o,s=e.elements.drag_handle||e.container,l={},d=function(s){s.preventDefault&&s.preventDefault(),i=parseInt(e.container.style.left,10)||0,a=parseInt(e.container.style.top,10)||0,r=i+(s.clientX-t),o=a+(s.clientY-n),l.move.call({target:e.container,x:r,y:o}),t=s.clientX,n=s.clientY},c=function(){document.removeEventListener("mousemove",d,!1),document.removeEventListener("mouseup",c,!1),l.end.call({target:e.container,x:r,y:o})},u=function(i){0===i.button&&(t=i.clientX,n=i.clientY,l.start.call({target:e.container}),document.addEventListener("mousemove",d,!1),document.addEventListener("mouseup",c,!1))};return s.addEventListener("mousedown",u,!1),{when:function(e){l.start=e.start,l.move=e.move,l.end=e.end}}},e.Upload=function(){this.els=e.elements,this.files=[],this.index=0,this.active=!1,this.path_parents="",this.setListeners(),this.lang=e.lang[e.options.lang]},e.Upload.prototype={setListeners:function(){var n=this,i=function(t,n){return/^image/.test(t.type)?n.width>=e.options.image.min_width&&n.height>=e.options.image.min_height:!1};FileAPI.event.on(this.els.upload_input,"change",function(a){var r=FileAPI.getFiles(a);FileAPI.filterFiles(r,function(t,n){var a;return e.options.upload_types.forEach(function(r){r==e.constants.types.image&&(a=i(t,n))}),a},function(i,a){a&&a.length&&e.$tree.showHeaderMessage({msg:t.templateLang(n.lang.alert.image.not_min_size,[e.options.image.min_width,e.options.image.min_height]),duration:3500,type:"alert"}),i.length&&n.add(i)})})},choose:function(){t.fireClick(this.els.upload_input)},showPreview:function(){this.els.grd_preview.style.display="none",this.els.images_list.style.display="",t.removeClass(this.els.btn_upload_file,"hidden")},showTree:function(){this.els.grd_preview.style.display="",this.els.images_list.style.display="none",t.addClass(this.els.btn_upload_file,"hidden")},add:function(n){var i,a,r,o,s=this;this.showPreview(),e.$tree.emptyThumbSelected(),FileAPI.each(n,function(e){s.files.push(e),FileAPI.Image(e).preview(70).get(function(n,l){i={name:e.name,size:t.bytesToSize(e.size)},a=s.thumbTemplate(i),r=t.createElement("li",a),r.id="file-"+FileAPI.uid(e),s.els.images_list.appendChild(r),o=t.find(".fb-preview-left",r),o.appendChild(l)})}),window.setTimeout(function(){t.fireClick(s.els.btn_upload_file)},300)},thumbTemplate:function(e){var n=['<div class="fb-preview-left"></div>','<div class="fb-preview-right">','<div class="fb-preview-filename">',"<span>{name}</span><br/>","<span>tamanho: {size}</span>","</div>",'<div class="fb-preview-progress">','<div class="fb-progress-bar"></div>',"</div>","</div>"].join("");return t.template(n,e)},getFileById:function(e){for(var t=this.files.length;t--;)if(FileAPI.uid(this.files[t])==e)return this.files[t]},start:function(){var t=this.files.length;return this.path_parents=e.$tree.getFolderPath(e.$base.current_active),this.active?void e.$tree.showHeaderMessage({msg:this.lang.alert.upload.sending,duration:1500,type:"alert"}):0===t?void e.$tree.showHeaderMessage({msg:this.lang.alert.upload.none,duration:1500,type:"alert"}):t==this.index?void e.$tree.showHeaderMessage({msg:this.lang.alert.upload.sent,duration:1500,type:"alert"}):void this.start_()},start_:function(){!this.active&&(this.active=this.files.length>this.index)&&this.upload_(this.files[this.index])},abort:function(e){var t=this.getFileById(e);t.xhr&&t.xhr.abort()},getEl_:function(e,n){var i=t.$("file-"+FileAPI.uid(e));return n?t.find(n,i):i},upload_:function(t){var n=this,i=this.getEl_(t,".fb-progress-bar");t&&(t.xhr=FileAPI.upload({url:e.options.server_http,files:{file:t},data:{action:"upload",parents:this.path_parents.join()},imageOriginal:!1,imageTransform:{big:{maxWidth:800,maxHeight:600},medium:{maxWidth:320,maxHeight:240},small:{maxWidth:100,maxHeight:100}},filecomplete:function(e){e&&console.info(e)},progress:function(e){i.style.width=e.loaded/e.total*100+"%"},complete:function(t,i){if(n.index++,n.active=!1,n.start_(),n.files.length==n.index){var a=FileAPI.parseJSON(i.responseText);a.erro===!1&&(e.$tree.showHeaderMessage({msg:n.lang.alert.upload.sent,duration:2500,type:"success"}),window.setTimeout(function(){n.showTree(),e.$tree.renewTree(a.tree)},1500))}}}))}},e.Alert=function(){this.els=e.elements,this.setListeners(),this.opened=!1,this.options={}},e.Alert.prototype={show:function(){var e=this.els.alert_container,n=parseInt(this.els.container.style.zIndex);this.els.alert_title.textContent=this.options.html.title,this.els.alert_text.innerHTML=this.options.html.text,t.addClass(document.body,"filebrowser-fb-stop-scrolling"),t.fadeIn(this.els.alert_overlay),this.els.alert_overlay.style.zIndex=n+1,e.style.marginTop=t.getTopMargin(e),e.style.opacity="",e.style.zIndex=n+2,e.style.display="block",t.addClass(e,"fb-alert-show"),t.removeClass(e,"fb-alert-hide"),window.previousActiveElement=document.activeElement,this.opened=!0,this.hideInputError()},close:function(){this.opened=!1,t.fadeOut(this.els.alert_overlay),t.fadeOut(this.els.alert_container),t.addClass(this.els.alert_container,"fb-alert-hide"),t.removeClass(this.els.alert_container,"fb-alert-show"),t.removeClass(document.body,"filebrowser-fb-stop-scrolling"),window.previousActiveElement},checkInput:function(e,t){13===e?this.options.submit.call(t):this.options.checkInput.call(t)},submit:function(){this.options.submit.call(this.els.alert_input.value)},prompt:function(e){this.options=e,this.show(),this.els.alert_icon_warning.style.display="none",this.els.alert_input.style.display="",this.els.alert_input.setAttribute("placeholder",e.placeholder),this.els.alert_input.focus()},confirm:function(e){this.options=e,this.show(),this.els.alert_icon_warning.style.display="",this.els.alert_input.style.display="none",this.els.alert_input.focus()},showInputError:function(e){t.addClass(this.els.alert_input,"invalid"),t.addClass(this.els.alert_elem_error,"show"),this.els.alert_error_text.innerHTML=e},hideInputError:function(){t.removeClass(this.els.alert_input,"invalid"),t.removeClass(this.els.alert_elem_error,"show")},setListeners:function(){var e=this,t=function(){this.blur(),e.submit()},n=function(){this.blur(),e.close()},i=function(t){e.checkInput(t.keyCode,this.value)},a=function(t){27===t.keyCode&&e.opened&&e.close()};this.els.alert_ok.addEventListener("click",t,!1),this.els.alert_cancel.addEventListener("click",n,!1),this.els.alert_input.addEventListener("keyup",i,!1),document.addEventListener("keydown",a,!1)}},e.Base}),function(e){var t=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,n=e.Blob&&function(){
try{return Boolean(new Blob)}catch(e){return!1}}(),i=n&&e.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),a=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,r=(n||a)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(e){var t,r,o,s,l,d;for(t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):decodeURIComponent(e.split(",")[1]),r=new ArrayBuffer(t.length),o=new Uint8Array(r),s=0;s<t.length;s+=1)o[s]=t.charCodeAt(s);return l=e.split(",")[0].split(":")[1].split(";")[0],n?new Blob([i?o:r],{type:l}):(d=new a,d.append(r),d.getBlob(l))};e.HTMLCanvasElement&&!t.toBlob&&(t.mozGetAsFile?t.toBlob=function(e,n,i){e(i&&t.toDataURL&&r?r(this.toDataURL(n,i)):this.mozGetAsFile("blob",n))}:t.toDataURL&&r&&(t.toBlob=function(e,t,n){e(r(this.toDataURL(t,n)))})),e.dataURLtoBlob=r}(window),function(e,t){function n(e,t,n,i,a){var r={type:n.type||n,target:e,result:i};Y(r,a),t(r)}function i(e){return C&&!!C.prototype["readAs"+e]}function a(e,a,r,o){if(ne.isBlob(e)&&i(r)){var s=new C;Q(s,M,function t(i){var r=i.type;"progress"==r?n(e,a,i,i.target.result,{loaded:i.loaded,total:i.total}):"loadend"==r?(Z(s,M,t),s=null):n(e,a,i,i.target.result)});try{o?s["readAs"+r](e,o):s["readAs"+r](e)}catch(i){n(e,a,"error",t,{error:i.toString()})}}else n(e,a,"error",t,{error:"filreader_not_support_"+r})}function r(e,t){if(!e.type&&(w||e.size%4096===0&&e.size<=102400))if(C)try{var n=new C;V(n,M,function(e){var i="error"!=e.type;i?(null!=n.readyState&&n.readyState!==n.LOADING||n.abort(),t(i)):t(!1,n.error)}),n.readAsDataURL(e)}catch(e){t(!1,e)}else t(null,new Error("FileReader is not supported"));else t(!0)}function o(e){return e&&(e.isFile||e.isDirectory)}function s(e){var t;return e.getAsEntry?t=e.getAsEntry():e.webkitGetAsEntry&&(t=e.webkitGetAsEntry()),t}function l(e,t){if(e)if(e.isFile)e.file(function(n){n.fullPath=e.fullPath,t(!1,[n],[n])},function(n){e.error=n,t("FileError.code: "+n.code,[],[e])});else if(e.isDirectory){var n=e.createReader(),i=!0,a=[],r=[e],o=function(n){e.error=n,t("DirectoryError.code: "+n.code,a,r)},d=function s(d){i&&(i=!1,d.length||(e.error=new Error("directory is empty"))),d.length?ne.afor(d,function(e,t){l(t,function(t,i,l){t||(a=a.concat(i)),r=r.concat(l),e?e():n.readEntries(s,o)})}):t(!1,a,r)};n.readEntries(d,o)}else l(s(e),t);else{var c=new Error("invalid entry");e=new Object(e),e.error=c,t(c.message,[],[e])}}function d(e){var t={};return K(e,function(e,n){e&&"object"==typeof e&&void 0===e.nodeType&&(e=Y({},e)),t[n]=e}),t}function c(e){return j.test(e&&e.tagName)}function u(e){return(e.originalEvent||e||"").dataTransfer||{}}function f(e){var t;for(t in e)if(e.hasOwnProperty(t)&&!(e[t]instanceof Object||"overlay"===t||"filter"===t))return!0;return!1}var p,h,m=1,g=function(){},v=e.document,b=v.doctype||{},y=e.navigator.userAgent,w=/safari\//i.test(y)&&!/chrome\//i.test(y),_=/iemobile\//i.test(y),x=e.createObjectURL&&e||e.URL&&URL.revokeObjectURL&&URL||e.webkitURL&&webkitURL,A=e.Blob,I=e.File,C=e.FileReader,E=e.FormData,F=e.XMLHttpRequest,T=e.jQuery,S=!(!(I&&C&&(e.Uint8Array||E||F.prototype.sendAsBinary))||w&&/windows/i.test(y)&&!_),k=S&&"withCredentials"in new F,R=S&&!!A&&!!(A.prototype.webkitSlice||A.prototype.mozSlice||A.prototype.slice),L=(""+"".normalize).indexOf("[native code]")>0,P=e.dataURLtoBlob,B=/img/i,D=/canvas/i,N=/img|canvas/i,j=/input/i,z=/^data:[^,]+,/,H={}.toString,O=e.Math,q=function(t){return t=new e.Number(O.pow(1024,t)),t.from=function(e){return O.round(e*this)},t},$={},U=[],M="abort progress error load loadend",X="status statusText readyState response responseXML responseText responseBody".split(" "),W="currentTarget",G="preventDefault",J=function(e){return e&&"length"in e},K=function(e,t,n){if(e)if(J(e))for(var i=0,a=e.length;a>i;i++)i in e&&t.call(n,e[i],i,e);else for(var r in e)e.hasOwnProperty(r)&&t.call(n,e[r],r,e)},Y=function(e){for(var t=arguments,n=1,i=function(t,n){e[n]=t};n<t.length;n++)K(t[n],i);return e},Q=function(e,t,n){if(e){var i=ne.uid(e);$[i]||($[i]={});var a=C&&e&&e instanceof C;K(t.split(/\s+/),function(t){T&&!a?T.event.add(e,t,n):($[i][t]||($[i][t]=[]),$[i][t].push(n),e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n)})}},Z=function(e,t,n){if(e){var i=ne.uid(e),a=$[i]||{},r=C&&e&&e instanceof C;K(t.split(/\s+/),function(t){if(T&&!r)T.event.remove(e,t,n);else{for(var i=a[t]||[],o=i.length;o--;)if(i[o]===n){i.splice(o,1);break}e.addEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=null}})}},V=function(e,t,n){Q(e,t,function i(a){Z(e,t,i),n(a)})},ee=function(t){return t.target||(t.target=e.event&&e.event.srcElement||v),3===t.target.nodeType&&(t.target=t.target.parentNode),t},te=function(e){var t=v.createElement("input");return t.setAttribute("type","file"),e in t},ne={version:"2.0.19",cors:!1,html5:!0,media:!1,formData:!0,multiPassResize:!0,debug:!1,pingUrl:!1,multiFlash:!1,flashAbortTimeout:0,withCredentials:!0,staticPath:"./dist/",flashUrl:0,flashImageUrl:0,postNameConcat:function(e,t){return e+(null!=t?"["+t+"]":"")},ext2mime:{jpg:"image/jpeg",tif:"image/tiff",txt:"text/plain"},accept:{"image/*":"art bm bmp dwg dxf cbr cbz fif fpx gif ico iefs jfif jpe jpeg jpg jps jut mcf nap nif pbm pcx pgm pict pm png pnm qif qtif ras rast rf rp svf tga tif tiff xbm xbm xpm xwd","audio/*":"m4a flac aac rm mpa wav wma ogg mp3 mp2 m3u mod amf dmf dsm far gdm imf it m15 med okt s3m stm sfx ult uni xm sid ac3 dts cue aif aiff wpl ape mac mpc mpp shn wv nsf spc gym adplug adx dsp adp ymf ast afc hps xs","video/*":"m4v 3gp nsv ts ty strm rm rmvb m3u ifo mov qt divx xvid bivx vob nrg img iso pva wmv asf asx ogm m2v avi bin dat dvr-ms mpg mpeg mp4 mkv avc vp3 svq3 nuv viv dv fli flv wpl"},uploadRetry:0,networkDownRetryTimeout:5e3,chunkSize:0,chunkUploadRetry:0,chunkNetworkDownRetryTimeout:2e3,KB:q(1),MB:q(2),GB:q(3),TB:q(4),EMPTY_PNG:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2NkAAIAAAoAAggA9GkAAAAASUVORK5CYII=",expando:"fileapi"+(new Date).getTime(),uid:function(e){return e?e[ne.expando]=e[ne.expando]||ne.uid():(++m,ne.expando+m)},log:function(){ne.debug&&p&&(h?console.log.apply(console,arguments):console.log([].join.call(arguments," ")))},newImage:function(e,t){var n=v.createElement("img");return t&&ne.event.one(n,"error load",function(e){t("error"==e.type,n),n=null}),n.src=e,n},getXHR:function(){var t;if(F)t=new F;else if(e.ActiveXObject)try{t=new ActiveXObject("MSXML2.XMLHttp.3.0")}catch(e){t=new ActiveXObject("Microsoft.XMLHTTP")}return t},isArray:J,support:{dnd:k&&"ondrop"in v.createElement("div"),cors:k,html5:S,chunked:R,dataURI:!0,accept:te("accept"),multiple:te("multiple")},event:{on:Q,off:Z,one:V,fix:ee},throttle:function(t,n){var i,a;return function(){a=arguments,i||(t.apply(e,a),i=setTimeout(function(){i=0,t.apply(e,a)},n))}},F:function(){},parseJSON:function(t){var n;return n=e.JSON&&JSON.parse?JSON.parse(t):new Function("return ("+t.replace(/([\r\n])/g,"\\$1")+");")()},trim:function(e){return e=String(e),e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},defer:function(){var e,n,i=[],a={resolve:function(t,r){for(a.resolve=g,n=t||!1,e=r;r=i.shift();)r(n,e)},then:function(a){n!==t?a(n,e):i.push(a)}};return a},queue:function(e){var t=0,n=0,i=!1,a=!1,r={inc:function(){n++},next:function(){t++,setTimeout(r.check,0)},check:function(){t>=n&&!i&&r.end()},isFail:function(){return i},fail:function(){!i&&e(i=!0)},end:function(){a||(a=!0,e())}};return r},each:K,afor:function(e,t){var n=0,i=e.length;J(e)&&i--?!function a(){t(i!=n&&a,e[n],n++)}():t(!1)},extend:Y,isFile:function(e){return"[object File]"===H.call(e)},isBlob:function(e){return this.isFile(e)||"[object Blob]"===H.call(e)},isCanvas:function(e){return e&&D.test(e.nodeName)},getFilesFilter:function(e){return e="string"==typeof e?e:e.getAttribute&&e.getAttribute("accept")||"",e?new RegExp("("+e.replace(/\./g,"\\.").replace(/,/g,"|")+")$","i"):/./},readAsDataURL:function(e,t){ne.isCanvas(e)?n(e,t,"load",ne.toDataURL(e)):a(e,t,"DataURL")},readAsBinaryString:function(e,t){i("BinaryString")?a(e,t,"BinaryString"):a(e,function(e){if("load"==e.type)try{e.result=ne.toBinaryString(e.result)}catch(t){e.type="error",e.message=t.toString()}t(e)},"DataURL")},readAsArrayBuffer:function(e,t){a(e,t,"ArrayBuffer")},readAsText:function(e,t,n){n||(n=t,t="utf-8"),a(e,n,"Text",t)},toDataURL:function(e,t){return"string"==typeof e?e:e.toDataURL?e.toDataURL(t||"image/png"):void 0},toBinaryString:function(t){return e.atob(ne.toDataURL(t).replace(z,""))},readAsImage:function(e,i,a){if(ne.isBlob(e))if(x){var r=x.createObjectURL(e);r===t?n(e,i,"error"):ne.readAsImage(r,i,a)}else ne.readAsDataURL(e,function(t){"load"==t.type?ne.readAsImage(t.result,i,a):(a||"error"==t.type)&&n(e,i,t,null,{loaded:t.loaded,total:t.total})});else if(ne.isCanvas(e))n(e,i,"load",e);else if(B.test(e.nodeName))if(e.complete)n(e,i,"load",e);else{var o="error abort load";V(e,o,function t(a){"load"==a.type&&x&&x.revokeObjectURL(e.src),Z(e,o,t),n(e,i,a,e)})}else if(e.iframe)n(e,i,{type:"error"});else{var s=ne.newImage(e.dataURL||e);ne.readAsImage(s,i,a)}},checkFileObj:function(e){var t={},n=ne.accept;return"object"==typeof e?t=e:t.name=(e+"").split(/\\|\//g).pop(),null==t.type&&(t.type=t.name.split(".").pop()),K(n,function(e,n){e=new RegExp(e.replace(/\s/g,"|"),"i"),(e.test(t.type)||ne.ext2mime[t.type])&&(t.type=ne.ext2mime[t.type]||n.split("/")[0]+"/"+t.type)}),t},getDropFiles:function(e,t){var n,i=[],a=[],d=u(e),c=d.files,f=d.items,p=J(f)&&f[0]&&s(f[0]),h=ne.queue(function(){t(i,a)});if(p)if(L&&c){var m,g,v=c.length;for(n=new Array(v);v--;){m=c[v];try{g=s(f[v])}catch(e){ne.log("[err] getDropFiles: ",e),g=null}o(g)&&(g.isDirectory||g.isFile&&m.name==m.name.normalize("NFC"))?n[v]=g:n[v]=m}}else n=f;else n=c;K(n||[],function(e){h.inc();try{p&&o(e)?l(e,function(e,t,n){e?ne.log("[err] getDropFiles:",e):i.push.apply(i,t),a.push.apply(a,n),h.next()}):r(e,function(t,n){t?i.push(e):e.error=n,a.push(e),h.next()})}catch(e){h.next(),ne.log("[err] getDropFiles: ",e)}}),h.check()},getFiles:function(e,t,n){var i=[];return n?(ne.filterFiles(ne.getFiles(e),t,n),null):(e.jquery&&(e.each(function(){i=i.concat(ne.getFiles(this))}),e=i,i=[]),"string"==typeof t&&(t=ne.getFilesFilter(t)),e.originalEvent?e=ee(e.originalEvent):e.srcElement&&(e=ee(e)),e.dataTransfer?e=e.dataTransfer:e.target&&(e=e.target),e.files?(i=e.files,S||(i[0].blob=e,i[0].iframe=!0)):!S&&c(e)?ne.trim(e.value)&&(i=[ne.checkFileObj(e.value)],i[0].blob=e,i[0].iframe=!0):J(e)&&(i=e),ne.filter(i,function(e){return!t||t.test(e.name)}))},getTotalSize:function(e){for(var t=0,n=e&&e.length;n--;)t+=e[n].size;return t},getInfo:function(e,t){var n={},i=U.concat();ne.isBlob(e)?!function a(){var r=i.shift();r?r.test(e.type)?r(e,function(e,i){e?t(e):(Y(n,i),a())}):a():t(!1,n)}():t("not_support_info",n)},addInfoReader:function(e,t){t.test=function(t){return e.test(t)},U.push(t)},filter:function(e,t){for(var n,i=[],a=0,r=e.length;r>a;a++)a in e&&(n=e[a],t.call(n,n,a,e)&&i.push(n));return i},filterFiles:function(e,t,n){if(e.length){var i,a=e.concat(),r=[],o=[];!function e(){a.length?(i=a.shift(),ne.getInfo(i,function(n,a){(t(i,n?!1:a)?r:o).push(i),e()})):n(r,o)}()}else n([],e)},upload:function(e){e=Y({jsonp:"callback",prepare:ne.F,beforeupload:ne.F,upload:ne.F,fileupload:ne.F,fileprogress:ne.F,filecomplete:ne.F,progress:ne.F,complete:ne.F,pause:ne.F,imageOriginal:!0,chunkSize:ne.chunkSize,chunkUploadRetry:ne.chunkUploadRetry,uploadRetry:ne.uploadRetry},e),e.imageAutoOrientation&&!e.imageTransform&&(e.imageTransform={rotate:"auto"});var t,n=new ne.XHR(e),i=this._getFilesDataArray(e.files),a=this,r=0,o=0,s=!1;return K(i,function(e){r+=e.size}),n.files=[],K(i,function(e){n.files.push(e.file)}),n.total=r,n.loaded=0,n.filesLeft=i.length,e.beforeupload(n,e),t=function(){var l=i.shift(),c=l&&l.file,u=!1,f=d(e);if(n.filesLeft=i.length,c&&c.name===ne.expando&&(c=null,ne.log("[warn] FileAPI.upload() — called without files")),("abort"!=n.statusText||n.current)&&l){if(s=!1,n.currentFile=c,c&&e.prepare(c,f)===!1)return void t.call(a);f.file=c,a._getFormData(f,l,function(s){o||e.upload(n,e);var d=new ne.XHR(Y({},f,{upload:c?function(){e.fileupload(c,d,f)}:g,progress:c?function(t){u||(u=t.loaded===t.total,e.fileprogress({type:"progress",total:l.total=t.total,loaded:l.loaded=t.loaded},c,d,f),e.progress({type:"progress",total:r,loaded:n.loaded=o+l.size*(t.loaded/t.total)||0},c,d,f))}:g,complete:function(i){K(X,function(e){n[e]=d[e]}),c&&(l.total=l.total||l.size,l.loaded=l.total,i||(this.progress(l),u=!0,o+=l.size,n.loaded=o),e.filecomplete(i,d,c,f)),setTimeout(function(){t.call(a)},0)}}));n.abort=function(e){e||(i.length=0),this.current=e,d.abort()},d.send(s)})}else{var p=200==n.status||201==n.status||204==n.status;e.complete(p?!1:n.statusText||"error",n,e),s=!0}},setTimeout(t,0),n.append=function(e,o){e=ne._getFilesDataArray([].concat(e)),K(e,function(e){r+=e.size,n.files.push(e.file),o?i.unshift(e):i.push(e)}),n.statusText="",s&&t.call(a)},n.remove=function(e){for(var t,n=i.length;n--;)i[n].file==e&&(t=i.splice(n,1),r-=t.size);return t},n},_getFilesDataArray:function(e){var t=[],n={};if(c(e)){var i=ne.getFiles(e);n[e.name||"file"]=null!==e.getAttribute("multiple")?i:i[0]}else J(e)&&c(e[0])?K(e,function(e){n[e.name||"file"]=ne.getFiles(e)}):n=e;return K(n,function e(n,i){J(n)?K(n,function(t){e(t,i)}):n&&(n.name||n.image)&&t.push({name:i,file:n,size:n.size,total:n.size,loaded:0})}),t.length||t.push({file:{name:ne.expando}}),t},_getFormData:function(e,t,n){var i=t.file,a=t.name,r=i.name,o=i.type,s=ne.support.transform&&e.imageTransform,l=new ne.Form,d=ne.queue(function(){n(l)}),c=s&&f(s),u=ne.postNameConcat;K(e.data,function e(t,n){"object"==typeof t?K(t,function(t,i){e(t,u(n,i))}):l.append(n,t)}),function t(n){n.image?(d.inc(),n.toData(function(e,i){n.file&&(i.type=n.file.type,i.quality=n.matrix.quality,r=n.file&&n.file.name),r=r||(new Date).getTime()+".png",t(i),d.next()})):ne.Image&&s&&(/^image/.test(n.type)||N.test(n.nodeName))?(d.inc(),c&&(s=[s]),ne.Image.transform(n,s,e.imageAutoOrientation,function(t,i){if(c&&!t)P||ne.flashEngine||(l.multipart=!0),l.append(a,i[0],r,s[0].type||o);else{var f=0;t||K(i,function(e,t){P||ne.flashEngine||(l.multipart=!0),s[t].postName||(f=1),l.append(s[t].postName||u(a,t),e,r,s[t].type||o)}),(t||e.imageOriginal)&&l.append(u(a,f?"original":null),n,r,o)}d.next()})):r!==ne.expando&&l.append(a,n,r)}(i),d.check()},reset:function(e,t){var n,i;return T?(i=T(e).clone(!0).insertBefore(e).val("")[0],t||T(e).remove()):(n=e.parentNode,i=n.insertBefore(e.cloneNode(!0),e),i.value="",t||n.removeChild(e),K($[ne.uid(e)],function(t,n){K(t,function(t){Z(e,n,t),Q(i,n,t)})})),i},load:function(e,t){var n=ne.getXHR();return n?(n.open("GET",e,!0),n.overrideMimeType&&n.overrideMimeType("text/plain; charset=x-user-defined"),Q(n,"progress",function(e){e.lengthComputable&&t({type:e.type,loaded:e.loaded,total:e.total},n)}),n.onreadystatechange=function(){if(4==n.readyState)if(n.onreadystatechange=null,200==n.status){e=e.split("/");var i={name:e[e.length-1],size:n.getResponseHeader("Content-Length"),type:n.getResponseHeader("Content-Type")};i.dataURL="data:"+i.type+";base64,"+ne.encode64(n.responseBody||n.responseText),t({type:"load",result:i},n)}else t({type:"error"},n)},n.send(null)):t({type:"error"}),n},encode64:function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="",i=0;for("string"!=typeof e&&(e=String(e));i<e.length;){var a,r,o=255&e.charCodeAt(i++),s=255&e.charCodeAt(i++),l=255&e.charCodeAt(i++),d=o>>2,c=(3&o)<<4|s>>4;isNaN(s)?a=r=64:(a=(15&s)<<2|l>>6,r=isNaN(l)?64:63&l),n+=t.charAt(d)+t.charAt(c)+t.charAt(a)+t.charAt(r)}return n}};ne.addInfoReader(/^image/,function(e,t){if(!e.__dimensions){var n=e.__dimensions=ne.defer();ne.readAsImage(e,function(e){var t=e.target;n.resolve("load"==e.type?!1:"error",{width:t.width,height:t.height}),t.src=ne.EMPTY_PNG,t=null})}e.__dimensions.then(t)}),ne.event.dnd=function(e,t,n){var i,a;n||(n=t,t=ne.F),C?(Q(e,"dragenter dragleave dragover",t.ff=t.ff||function(e){for(var n=u(e).types,r=n&&n.length,o=!1;r--;)if(~n[r].indexOf("File")){e[G](),a!==e.type&&(a=e.type,"dragleave"!=a&&t.call(e[W],!0,e),o=!0);break}o&&(clearTimeout(i),i=setTimeout(function(){t.call(e[W],"dragleave"!=a,e)},50))}),Q(e,"drop",n.ff=n.ff||function(e){e[G](),a=0,t.call(e[W],!1,e),ne.getDropFiles(e,function(t,i){n.call(e[W],t,i,e)})})):ne.log("Drag'n'Drop -- not supported")},ne.event.dnd.off=function(e,t,n){Z(e,"dragenter dragleave dragover",t.ff),Z(e,"drop",n.ff)},T&&!T.fn.dnd&&(T.fn.dnd=function(e,t){return this.each(function(){ne.event.dnd(this,e,t)})},T.fn.offdnd=function(e,t){return this.each(function(){ne.event.dnd.off(this,e,t)})}),e.FileAPI=Y(ne,e.FileAPI),ne.log("FileAPI: "+ne.version),ne.log("protocol: "+e.location.protocol),ne.log("doctype: ["+b.name+"] "+b.publicId+" "+b.systemId),K(v.getElementsByTagName("meta"),function(e){/x-ua-compatible/i.test(e.getAttribute("http-equiv"))&&ne.log("meta.http-equiv: "+e.getAttribute("content"))});try{p=!!console.log,h=!!console.log.apply}catch(e){}ne.flashUrl||(ne.flashUrl=ne.staticPath+"FileAPI.flash.swf"),ne.flashImageUrl||(ne.flashImageUrl=ne.staticPath+"FileAPI.flash.image.swf"),ne.flashWebcamUrl||(ne.flashWebcamUrl=ne.staticPath+"FileAPI.flash.camera.swf")}(window,void 0),function(e,t,n){function i(t){if(t instanceof i){var n=new i(t.file);return e.extend(n.matrix,t.matrix),n}return this instanceof i?(this.file=t,this.size=t.size||100,void(this.matrix={sx:0,sy:0,sw:0,sh:0,dx:0,dy:0,dw:0,dh:0,resize:0,deg:0,quality:1,filter:0})):new i(t)}var a=Math.min,r=Math.round,o=function(){return t.createElement("canvas")},s=!1,l={8:270,3:180,6:90,7:270,4:180,5:90};try{s=o().toDataURL("image/png").indexOf("data:image/png")>-1}catch(e){}i.prototype={image:!0,constructor:i,set:function(t){return e.extend(this.matrix,t),this},crop:function(e,t,i,a){return i===n&&(i=e,a=t,e=t=0),this.set({sx:e,sy:t,sw:i,sh:a||i})},resize:function(e,t,n){return/min|max|height|width/.test(t)&&(n=t,t=e),this.set({dw:e,dh:t||e,resize:n})},preview:function(e,t){return this.resize(e,t||e,"preview")},rotate:function(e){return this.set({deg:e})},filter:function(e){return this.set({filter:e})},overlay:function(e){return this.set({overlay:e})},clone:function(){return new i(this)},_load:function(t,n){var i=this;/img|video/i.test(t.nodeName)?n.call(i,null,t):e.readAsImage(t,function(e){n.call(i,"load"!=e.type,e.result)})},_apply:function(t,n){var r,s=o(),l=this.getMatrix(t),d=s.getContext("2d"),c=t.videoWidth||t.width,u=t.videoHeight||t.height,f=l.deg,p=l.dw,h=l.dh,m=c,g=u,v=l.filter,b=t,y=l.overlay,w=e.queue(function(){t.src=e.EMPTY_PNG,n(!1,s)}),_=e.renderImageToCanvas;for(f-=360*Math.floor(f/360),t._type=this.file.type;l.multipass&&a(m/p,g/h)>2;)m=m/2+.5|0,g=g/2+.5|0,r=o(),r.width=m,r.height=g,b!==t?(_(r,b,0,0,b.width,b.height,0,0,m,g),b=r):(b=r,_(b,t,l.sx,l.sy,l.sw,l.sh,0,0,m,g),l.sx=l.sy=l.sw=l.sh=0);s.width=f%180?h:p,s.height=f%180?p:h,s.type=l.type,s.quality=l.quality,d.rotate(f*Math.PI/180),_(d.canvas,b,l.sx,l.sy,l.sw||b.width,l.sh||b.height,180==f||270==f?-p:0,90==f||180==f?-h:0,p,h),p=s.width,h=s.height,y&&e.each([].concat(y),function(t){w.inc();var n=new window.Image,i=function(){var a=0|t.x,r=0|t.y,o=t.w||n.width,s=t.h||n.height,l=t.rel;a=1==l||4==l||7==l?(p-o+a)/2:2==l||5==l||8==l?p-(o+a):a,r=3==l||4==l||5==l?(h-s+r)/2:l>=6?h-(s+r):r,e.event.off(n,"error load abort",i);try{d.globalAlpha=t.opacity||1,d.drawImage(n,a,r,o,s)}catch(e){}w.next()};e.event.on(n,"error load abort",i),n.src=t.src,n.complete&&i()}),v&&(w.inc(),i.applyFilter(s,v,w.next)),w.check()},getMatrix:function(t){var n=e.extend({},this.matrix),i=n.sw=n.sw||t.videoWidth||t.naturalWidth||t.width,o=n.sh=n.sh||t.videoHeight||t.naturalHeight||t.height,s=n.dw=n.dw||i,l=n.dh=n.dh||o,d=i/o,c=s/l,u=n.resize;if("preview"==u){if(s!=i||l!=o){var f,p;c>=d?(f=i,p=f/c):(p=o,f=p*c),f==i&&p==o||(n.sx=~~((i-f)/2),n.sy=~~((o-p)/2),i=f,o=p)}}else"height"==u?s=l*d:"width"==u?l=s/d:u&&(i>s||o>l?"min"==u?(s=r(c>d?a(i,s):l*d),l=r(c>d?s/d:a(o,l))):(s=r(d>=c?a(i,s):l*d),l=r(d>=c?s/d:a(o,l))):(s=i,l=o));return n.sw=i,n.sh=o,n.dw=s,n.dh=l,n.multipass=e.multiPassResize,n},_trans:function(t){this._load(this.file,function(n,i){if(n)t(n);else try{this._apply(i,t)}catch(n){e.log("[err] FileAPI.Image.fn._apply:",n),t(n)}})},get:function(t){if(e.support.transform){var n=this,i=n.matrix;"auto"==i.deg?e.getInfo(n.file,function(e,a){i.deg=l[a&&a.exif&&a.exif.Orientation]||0,n._trans(t)}):n._trans(t)}else t("not_support_transform");return this},toData:function(e){return this.get(e)}},i.exifOrientation=l,i.transform=function(t,a,r,o){function s(s,l){var d={},c=e.queue(function(e){o(e,d)});s?c.fail():e.each(a,function(e,a){if(!c.isFail()){var o=new i(l.nodeType?l:t),s="function"==typeof e;if(s?e(l,o):e.width?o[e.preview?"preview":"resize"](e.width,e.height,e.strategy):e.maxWidth&&(l.width>e.maxWidth||l.height>e.maxHeight)&&o.resize(e.maxWidth,e.maxHeight,"max"),e.crop){var u=e.crop;o.crop(0|u.x,0|u.y,u.w||u.width,u.h||u.height)}e.rotate===n&&r&&(e.rotate="auto"),o.set({type:o.matrix.type||e.type||t.type||"image/png"}),s||o.set({deg:e.rotate,overlay:e.overlay,filter:e.filter,quality:e.quality||1}),c.inc(),o.toData(function(e,t){e?c.fail():(d[a]=t,c.next())})}})}t.width?s(!1,t):e.getInfo(t,s)},e.each(["TOP","CENTER","BOTTOM"],function(t,n){e.each(["LEFT","CENTER","RIGHT"],function(e,a){i[t+"_"+e]=3*n+a,i[e+"_"+t]=3*n+a})}),i.toCanvas=function(e){var n=t.createElement("canvas");return n.width=e.videoWidth||e.width,n.height=e.videoHeight||e.height,n.getContext("2d").drawImage(e,0,0),n},i.fromDataURL=function(t,n,i){var a=e.newImage(t);e.extend(a,n),i(a)},i.applyFilter=function(t,n,a){"function"==typeof n?n(t,a):window.Caman&&window.Caman("IMG"==t.tagName?i.toCanvas(t):t,function(){"string"==typeof n?this[n]():e.each(n,function(e,t){this[t](e)},this),this.render(a)})},e.renderImageToCanvas=function(t,n,i,a,r,o,s,l,d,c){try{return t.getContext("2d").drawImage(n,i,a,r,o,s,l,d,c)}catch(t){throw e.log("renderImageToCanvas failed"),t}},e.support.canvas=e.support.transform=s,e.Image=i}(FileAPI,document),function(e,t){function n(t,n,i){var a=t.blob,r=t.file;if(r){if(!a.toDataURL)return void e.readAsBinaryString(a,function(e){"load"==e.type&&n(t,e.result)});var o={"image/jpeg":".jpe?g","image/png":".png"},s=o[t.type]?t.type:"image/png",l=o[s]||".png",d=a.quality||1;r.match(new RegExp(l+"$","i"))||(r+=l.replace("?","")),t.file=r,t.type=s,!i&&a.toBlob?a.toBlob(function(e){n(t,e)},s,d):n(t,e.toBinaryString(a.toDataURL(s,d)))}else n(t,a)}var i=t.document,a=t.FormData,r=function(){this.items=[]},o=t.encodeURIComponent;r.prototype={append:function(e,t,n,i){this.items.push({name:e,blob:t&&t.blob||(void 0==t?"":t),file:t&&(n||t.name),type:t&&(i||t.type)})},each:function(e){for(var t=0,n=this.items.length;n>t;t++)e.call(this,this.items[t])},toData:function(t,n){n._chunked=e.support.chunked&&n.chunkSize>0&&1==e.filter(this.items,function(e){return e.file}).length,e.support.html5?e.formData&&!this.multipart&&a?n._chunked?(e.log("FileAPI.Form.toPlainData"),this.toPlainData(t)):(e.log("FileAPI.Form.toFormData"),this.toFormData(t)):(e.log("FileAPI.Form.toMultipartData"),this.toMultipartData(t)):(e.log("FileAPI.Form.toHtmlData"),this.toHtmlData(t))},_to:function(t,n,i,a){var r=e.queue(function(){n(t)});this.each(function(o){try{i(o,t,r,a)}catch(t){e.log("FileAPI.Form._to: "+t.message),n(t)}}),r.check()},toHtmlData:function(t){this._to(i.createDocumentFragment(),t,function(t,n){var a,r=t.blob;t.file?(e.reset(r,!0),r.name=t.name,r.disabled=!1,n.appendChild(r)):(a=i.createElement("input"),a.name=t.name,a.type="hidden",a.value=r,n.appendChild(a))})},toPlainData:function(e){this._to({},e,function(e,t,i){e.file&&(t.type=e.file),e.blob.toBlob?(i.inc(),n(e,function(e,n){t.name=e.name,t.file=n,t.size=n.length,t.type=e.type,i.next()})):e.file?(t.name=e.blob.name,t.file=e.blob,t.size=e.blob.size,t.type=e.type):(t.params||(t.params=[]),t.params.push(o(e.name)+"="+o(e.blob))),t.start=-1,t.end=t.file&&t.file.FileAPIReadPosition||-1,t.retry=0})},toFormData:function(e){this._to(new a,e,function(e,t,i){e.blob&&e.blob.toBlob?(i.inc(),n(e,function(e,n){t.append(e.name,n,e.file),i.next()})):e.file?t.append(e.name,e.blob,e.file):t.append(e.name,e.blob),e.file&&t.append("_"+e.name,e.file)})},toMultipartData:function(t){this._to([],t,function(e,t,i,a){i.inc(),n(e,function(e,n){t.push("--_"+a+('\r\nContent-Disposition: form-data; name="'+e.name+'"'+(e.file?'; filename="'+o(e.file)+'"':"")+(e.file?"\r\nContent-Type: "+(e.type||"application/octet-stream"):"")+"\r\n\r\n"+(e.file?n:o(n))+"\r\n")),i.next()},!0)},e.expando)}},e.Form=r}(FileAPI,window),function(e,t){var n=function(){},i=e.document,a=function(e){this.uid=t.uid(),this.xhr={abort:n,getResponseHeader:n,getAllResponseHeaders:n},this.options=e},r={"":1,XML:1,Text:1,Body:1};a.prototype={status:0,statusText:"",constructor:a,getResponseHeader:function(e){return this.xhr.getResponseHeader(e)},getAllResponseHeaders:function(){return this.xhr.getAllResponseHeaders()||{}},end:function(i,a){var r=this,o=r.options;r.end=r.abort=n,r.status=i,a&&(r.statusText=a),t.log("xhr.end:",i,a),o.complete(200==i||201==i?!1:r.statusText||"unknown",r),r.xhr&&r.xhr.node&&setTimeout(function(){var t=r.xhr.node;try{t.parentNode.removeChild(t)}catch(e){}try{delete e[r.uid]}catch(e){}e[r.uid]=r.xhr.node=null},9)},abort:function(){this.end(0,"abort"),this.xhr&&(this.xhr.aborted=!0,this.xhr.abort())},send:function(e){var t=this,n=this.options;e.toData(function(e){e instanceof Error?t.end(0,e.message):(n.upload(n,t),t._send.call(t,n,e))},n)},_send:function(n,a){var o,s=this,l=s.uid,d=s.uid+"Load",c=n.url;if(t.log("XHR._send:",a),n.cache||(c+=(~c.indexOf("?")?"&":"?")+t.uid()),a.nodeName){var u=n.jsonp;c=c.replace(/([a-z]+)=(\?)/i,"$1="+l),n.upload(n,s);var f=function(e){if(~c.indexOf(e.origin))try{var n=t.parseJSON(e.data);n.id==l&&p(n.status,n.statusText,n.response)}catch(e){p(0,e.message)}},p=e[l]=function(n,i,a){s.readyState=4,s.responseText=a,s.end(n,i),t.event.off(e,"message",f),e[l]=o=m=e[d]=null};s.xhr.abort=function(){try{m.stop?m.stop():m.contentWindow.stop?m.contentWindow.stop():m.contentWindow.document.execCommand("Stop")}catch(e){}p(0,"abort")},t.event.on(e,"message",f),e[d]=function(){try{var e=m.contentWindow,n=e.document,i=e.result||t.parseJSON(n.body.innerHTML);p(i.status,i.statusText,i.response)}catch(e){t.log("[transport.onload]",e)}},o=i.createElement("div"),o.innerHTML='<form target="'+l+'" action="'+c+'" method="POST" enctype="multipart/form-data" style="position: absolute; top: -1000px; overflow: hidden; width: 1px; height: 1px;"><iframe name="'+l+'" src="javascript:false;" onload="window.'+d+" && "+d+'();"></iframe>'+(u&&n.url.indexOf("=?")<0?'<input value="'+l+'" name="'+u+'" type="hidden"/>':"")+"</form>";var h=o.getElementsByTagName("form")[0],m=o.getElementsByTagName("iframe")[0];h.appendChild(a),t.log(h.parentNode.innerHTML),i.body.appendChild(o),s.xhr.node=o,s.readyState=2;try{h.submit()}catch(e){t.log("iframe.error: "+e)}h=null}else{if(c=c.replace(/([a-z]+)=(\?)&?/i,""),this.xhr&&this.xhr.aborted)return void t.log("Error: already aborted");if(o=s.xhr=t.getXHR(),a.params&&(c+=(c.indexOf("?")<0?"?":"&")+a.params.join("&")),o.open("POST",c,!0),t.withCredentials&&(o.withCredentials="true"),n.headers&&n.headers["X-Requested-With"]||o.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.each(n.headers,function(e,t){o.setRequestHeader(t,e)}),n._chunked){o.upload&&o.upload.addEventListener("progress",t.throttle(function(e){a.retry||n.progress({type:e.type,total:a.size,loaded:a.start+e.loaded,totalSize:a.size},s,n)},100),!1),o.onreadystatechange=function(){var e=parseInt(o.getResponseHeader("X-Last-Known-Byte"),10);if(s.status=o.status,s.statusText=o.statusText,s.readyState=o.readyState,4==o.readyState){for(var i in r)s["response"+i]=o["response"+i];if(o.onreadystatechange=null,!o.status||o.status-201>0)if(t.log("Error: "+o.status),(!o.status&&!o.aborted||500==o.status||416==o.status)&&++a.retry<=n.chunkUploadRetry){var l=o.status?0:t.chunkNetworkDownRetryTimeout;n.pause(a.file,n),t.log("X-Last-Known-Byte: "+e),e?a.end=e:(a.end=a.start-1,416==o.status&&(a.end=a.end-n.chunkSize)),setTimeout(function(){s._send(n,a)},l)}else s.end(o.status);else a.retry=0,a.end==a.size-1?s.end(o.status):(t.log("X-Last-Known-Byte: "+e),e&&(a.end=e),a.file.FileAPIReadPosition=a.end,setTimeout(function(){s._send(n,a)},0));o=null}},a.start=a.end+1,a.end=Math.max(Math.min(a.start+n.chunkSize,a.size)-1,a.start);var g=a.file,v=(g.slice||g.mozSlice||g.webkitSlice).call(g,a.start,a.end+1);a.size&&!v.size?setTimeout(function(){s.end(-1)}):(o.setRequestHeader("Content-Range","bytes "+a.start+"-"+a.end+"/"+a.size),o.setRequestHeader("Content-Disposition","attachment; filename="+encodeURIComponent(a.name)),o.setRequestHeader("Content-Type",a.type||"application/octet-stream"),o.send(v)),g=v=null}else if(o.upload&&o.upload.addEventListener("progress",t.throttle(function(e){n.progress(e,s,n)},100),!1),o.onreadystatechange=function(){if(s.status=o.status,s.statusText=o.statusText,s.readyState=o.readyState,4==o.readyState){for(var e in r)s["response"+e]=o["response"+e];if(o.onreadystatechange=null,!o.status||o.status>201)if(t.log("Error: "+o.status),(!o.status&&!o.aborted||500==o.status)&&(n.retry||0)<n.uploadRetry){n.retry=(n.retry||0)+1;var i=t.networkDownRetryTimeout;n.pause(n.file,n),setTimeout(function(){s._send(n,a)},i)}else s.end(o.status);else s.end(o.status);o=null}},t.isArray(a)){o.setRequestHeader("Content-Type","multipart/form-data; boundary=_"+t.expando);var b=a.join("")+"--_"+t.expando+"--";if(o.sendAsBinary)o.sendAsBinary(b);else{var y=Array.prototype.map.call(b,function(e){return 255&e.charCodeAt(0)});o.send(new Uint8Array(y).buffer)}}else o.send(a)}}},t.XHR=a}(window,FileAPI),function(e,t,n){var i=e.document,a=e.location,r=e.navigator,o=n.each;n.support.flash=function(){var t=r.mimeTypes,i=!1;if(r.plugins&&"object"==typeof r.plugins["Shockwave Flash"])i=r.plugins["Shockwave Flash"].description&&!(t&&t["application/x-shockwave-flash"]&&!t["application/x-shockwave-flash"].enabledPlugin);else try{i=!(!e.ActiveXObject||!new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(e){n.log("Flash -- does not supported.")}return i&&/^file:/i.test(a)&&n.log("[warn] Flash does not work on `file:` protocol."),i}(),n.support.flash&&(!n.html5||!n.support.html5||n.cors&&!n.support.cors||n.media&&!n.support.media)&&function(){function s(e){return('<object id="#id#" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+(e.width||"100%")+'" height="'+(e.height||"100%")+'"><param name="movie" value="#src#" /><param name="flashvars" value="#flashvars#" /><param name="swliveconnect" value="true" /><param name="allowscriptaccess" value="always" /><param name="allownetworking" value="all" /><param name="menu" value="false" /><param name="wmode" value="#wmode#" /><embed flashvars="#flashvars#" swliveconnect="true" allownetworking="all" allowscriptaccess="always" name="#id#" src="#src#" width="'+(e.width||"100%")+'" height="'+(e.height||"100%")+'" menu="false" wmode="transparent" type="application/x-shockwave-flash"></embed></object>').replace(/#(\w+)#/gi,function(t,n){return e[n]})}function l(e,t){if(e&&e.style){var n,i;for(n in t){i=t[n],"number"==typeof i&&(i+="px");try{e.style[n]=i}catch(e){}}}}function d(e,t){o(t,function(t,n){var i=e[n];e[n]=function(){return this.parent=i,t.apply(this,arguments)}})}function c(e){return e&&!e.flashId}function u(e){var t=e.wid=n.uid();return _._fn[t]=e,"FileAPI.Flash._fn."+t}function f(e){try{_._fn[e.wid]=null,delete _._fn[e.wid]}catch(e){}}function p(e,t){if(!w.test(e)){if(/^\.\//.test(e)||"/"!=e.charAt(0)){var n=a.pathname;n=n.substr(0,n.lastIndexOf("/")),e=(n+"/"+e).replace("/./","/")}"//"!=e.substr(0,2)&&(e="//"+a.host+e),w.test(e)||(e=a.protocol+e)}return t&&(e+=(/\?/.test(e)?"&":"?")+t),e}function h(e,t,a){function r(){try{var e=_.get(d);e.setImage(t)}catch(e){n.log('[err] FlashAPI.Preview.setImage -- can not set "base64":',e);
}}var o,d=n.uid(),c=i.createElement("div"),h=10;for(o in e)c.setAttribute(o,e[o]),c[o]=e[o];l(c,e),e.width="100%",e.height="100%",c.innerHTML=s(n.extend({id:d,src:p(n.flashImageUrl,"r="+n.uid()),wmode:"opaque",flashvars:"scale="+e.scale+"&callback="+u(function e(){return f(e),--h>0&&r(),!0})},e)),a(!1,c),c=null}function m(e){return{id:e.id,name:e.name,matrix:e.matrix,flashId:e.flashId}}function g(t){var n=t.getBoundingClientRect(),a=i.body,r=(t&&t.ownerDocument).documentElement;return{top:n.top+(e.pageYOffset||r.scrollTop)-(r.clientTop||a.clientTop||0),left:n.left+(e.pageXOffset||r.scrollLeft)-(r.clientLeft||a.clientLeft||0),width:n.right-n.left,height:n.bottom-n.top}}var v=n.uid(),b=0,y={},w=/^https?:/i,_={_fn:{},init:function(){var e=i.body&&i.body.firstChild;if(e)do if(1==e.nodeType){n.log("FlashAPI.state: awaiting");var t=i.createElement("div");return t.id="_"+v,l(t,{top:1,right:1,width:5,height:5,position:"absolute",zIndex:"2147483647"}),e.parentNode.insertBefore(t,e),void _.publish(t,v)}while(e=e.nextSibling);10>b&&setTimeout(_.init,50*++b)},publish:function(e,t,i){i=i||{},e.innerHTML=s({id:t,src:p(n.flashUrl,"r="+n.version),wmode:i.camera?"":"transparent",flashvars:"callback="+(i.onEvent||"FileAPI.Flash.onEvent")+"&flashId="+t+"&storeKey="+r.userAgent.match(/\d/gi).join("")+"_"+n.version+(_.isReady||(n.pingUrl?"&ping="+n.pingUrl:""))+"&timeout="+n.flashAbortTimeout+(i.camera?"&useCamera="+p(n.flashWebcamUrl):"")+"&debug="+(n.debug?"1":"")},i)},ready:function(){n.log("FlashAPI.state: ready"),_.ready=n.F,_.isReady=!0,_.patch(),_.patchCamera&&_.patchCamera(),n.event.on(i,"mouseover",_.mouseover),n.event.on(i,"click",function(e){_.mouseover(e)&&(e.preventDefault?e.preventDefault():e.returnValue=!0)})},getEl:function(){return i.getElementById("_"+v)},getWrapper:function(e){do if(/js-fileapi-wrapper/.test(e.className))return e;while((e=e.parentNode)&&e!==i.body)},mouseover:function(e){var t=n.event.fix(e).target;if(/input/i.test(t.nodeName)&&"file"==t.type&&!t.disabled){var a=t.getAttribute(v),r=_.getWrapper(t);if(n.multiFlash){if("i"==a||"r"==a)return!1;if("p"!=a){t.setAttribute(v,"i");var o=i.createElement("div");if(!r)return void n.log("[err] FlashAPI.mouseover: js-fileapi-wrapper not found");l(o,{top:0,left:0,width:t.offsetWidth,height:t.offsetHeight,zIndex:"2147483647",position:"absolute"}),r.appendChild(o),_.publish(o,n.uid()),t.setAttribute(v,"p")}return!0}if(r){var s=g(r);l(_.getEl(),s),_.curInp=t}}else/object|embed/i.test(t.nodeName)||l(_.getEl(),{top:1,left:1,width:5,height:5})},onEvent:function(e){var t=e.type;if("ready"==t){try{_.getInput(e.flashId).setAttribute(v,"r")}catch(e){}return _.ready(),setTimeout(function(){_.mouseenter(e)},50),!0}"ping"===t?n.log("(flash -> js).ping:",[e.status,e.savedStatus],e.error):"log"===t?n.log("(flash -> js).log:",e.target):t in _&&setTimeout(function(){n.log("FlashAPI.event."+e.type+":",e),_[t](e)},1)},mouseenter:function(e){var t=_.getInput(e.flashId);if(t){_.cmd(e,"multiple",null!=t.getAttribute("multiple"));var i=[],a={};o((t.getAttribute("accept")||"").split(/,\s*/),function(e){n.accept[e]&&o(n.accept[e].split(" "),function(e){a[e]=1})}),o(a,function(e,t){i.push(t)}),_.cmd(e,"accept",i.length?i.join(",")+","+i.join(",").toUpperCase():"*")}},get:function(t){return i[t]||e[t]||i.embeds[t]},getInput:function(e){if(!n.multiFlash)return _.curInp;try{var t=_.getWrapper(_.get(e));if(t)return t.getElementsByTagName("input")[0]}catch(t){n.log('[err] Can not find "input" by flashId:',e,t)}},select:function(e){var a,r=_.getInput(e.flashId),s=n.uid(r),l=e.target.files;o(l,function(e){n.checkFileObj(e)}),y[s]=l,i.createEvent?(a=i.createEvent("Event"),a.files=l,a.initEvent("change",!0,!0),r.dispatchEvent(a)):t?t(r).trigger({type:"change",files:l}):(a=i.createEventObject(),a.files=l,r.fireEvent("onchange",a))},cmd:function(e,t,i,a){try{return n.log("(js -> flash)."+t+":",i),_.get(e.flashId||e).cmd(t,i)}catch(r){n.log("(js -> flash).onError:",r.toString()),a||setTimeout(function(){_.cmd(e,t,i,!0)},50)}},patch:function(){n.flashEngine=!0,d(n,{getFiles:function(e,t,i){if(i)return n.filterFiles(n.getFiles(e),t,i),null;var a=n.isArray(e)?e:y[n.uid(e.target||e.srcElement||e)];return a?(t&&(t=n.getFilesFilter(t),a=n.filter(a,function(e){return t.test(e.name)})),a):this.parent.apply(this,arguments)},getInfo:function(e,t){if(c(e))this.parent.apply(this,arguments);else if(e.isShot)t(null,e.info={width:e.width,height:e.height});else{if(!e.__info){var i=e.__info=n.defer();_.cmd(e,"getFileInfo",{id:e.id,callback:u(function t(n,a){f(t),i.resolve(n,e.info=a)})})}e.__info.then(t)}}}),n.support.transform=!0,n.Image&&d(n.Image.prototype,{get:function(e,t){return this.set({scaleMode:t||"noScale"}),this.parent(e)},_load:function(e,t){if(n.log("FlashAPI.Image._load:",e),c(e))this.parent.apply(this,arguments);else{var i=this;n.getInfo(e,function(n){t.call(i,n,e)})}},_apply:function(e,t){if(n.log("FlashAPI.Image._apply:",e),c(e))this.parent.apply(this,arguments);else{var i=this.getMatrix(e.info),a=t;_.cmd(e,"imageTransform",{id:e.id,matrix:i,callback:u(function r(o,s){n.log("FlashAPI.Image._apply.callback:",o),f(r),o?a(o):n.support.html5||n.support.dataURI&&!(s.length>3e4)?(i.filter&&(a=function(e,a){e?t(e):n.Image.applyFilter(a,i.filter,function(){t(e,this.canvas)})}),n.newImage("data:"+e.type+";base64,"+s,a)):h({width:i.deg%180?i.dh:i.dw,height:i.deg%180?i.dw:i.dh,scale:i.scaleMode},s,a)})})}},toData:function(e){var t=this.file,i=t.info,a=this.getMatrix(i);n.log("FlashAPI.Image.toData"),c(t)?this.parent.apply(this,arguments):("auto"==a.deg&&(a.deg=n.Image.exifOrientation[i&&i.exif&&i.exif.Orientation]||0),e.call(this,!t.info,{id:t.id,flashId:t.flashId,name:t.name,type:t.type,matrix:a}))}}),n.Image&&d(n.Image,{fromDataURL:function(e,t,i){!n.support.dataURI||e.length>3e4?h(n.extend({scale:"exactFit"},t),e.replace(/^data:[^,]+,/,""),function(e,t){i(t)}):this.parent(e,t,i)}}),d(n.Form.prototype,{toData:function(e){for(var t=this.items,i=t.length;i--;)if(t[i].file&&c(t[i].blob))return this.parent.apply(this,arguments);n.log("FlashAPI.Form.toData"),e(t)}}),d(n.XHR.prototype,{_send:function(e,t){if(t.nodeName||t.append&&n.support.html5||n.isArray(t)&&"string"==typeof t[0])return this.parent.apply(this,arguments);var i,a,r={},s={},l=this;if(o(t,function(e){e.file?(s[e.name]=e=m(e.blob),a=e.id,i=e.flashId):r[e.name]=e.blob}),a||(i=v),!i)return n.log("[err] FlashAPI._send: flashId -- undefined"),this.parent.apply(this,arguments);n.log("FlashAPI.XHR._send: "+i+" -> "+a),l.xhr={headers:{},abort:function(){_.cmd(i,"abort",{id:a})},getResponseHeader:function(e){return this.headers[e]},getAllResponseHeaders:function(){return this.headers}};var d=n.queue(function(){_.cmd(i,"upload",{url:p(e.url.replace(/([a-z]+)=(\?)&?/i,"")),data:r,files:a?s:null,headers:e.headers||{},callback:u(function t(i){var a=i.type,r=i.result;n.log("FlashAPI.upload."+a),"progress"==a?(i.loaded=Math.min(i.loaded,i.total),i.lengthComputable=!0,e.progress(i)):"complete"==a?(f(t),"string"==typeof r&&(l.responseText=r.replace(/%22/g,'"').replace(/%5c/g,"\\").replace(/%26/g,"&").replace(/%25/g,"%")),l.end(i.status||200)):"abort"!=a&&"error"!=a||(l.end(i.status||0,i.message),f(t))})})});o(s,function(e){d.inc(),n.getInfo(e,d.next)}),d.check()}})}};n.Flash=_,n.newImage("data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",function(e,t){n.support.dataURI=!(1!=t.width||1!=t.height),_.init()})}()}(window,window.jQuery,FileAPI);
